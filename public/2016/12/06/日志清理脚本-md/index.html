<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="三唐"><meta name="description" content="日志过多，crontabtotherescue!清理X天前的日志:1logs_dir=&amp;#34;/path/to/logs&amp;#34;&amp;#10;&amp;#10;#default7+1dayago&amp;#10;days_ago=1&amp;#10;&amp;#10;if[!-z&amp;#3"><meta name="keywords" content="shell"><title>日志清理脚本 · 三唐</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://yoursite.com/2016/12/06/日志清理脚本-md/"><link rel="alternative" href="/atom.xml" title="三唐" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css"></head><body><div id="main"><header><a href="/." class="logo">三唐</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/categories/" target="_self">Categories</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">日志清理脚本</h1><span class="post-time">Dec 6, 2016</span><div class="post-content"><p>日志过多，crontab to the rescue!</p>
<p>清理X天前的日志:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logs_dir=&#34;/path/to/logs&#34;&#10;&#10;# default 7+1 day ago&#10;days_ago=1&#10;&#10;if [ ! -z &#34;$1&#34; ]; then&#10;    echo &#34;delete logs $1 days ago&#34;&#10;    days_ago=$1&#10;else&#10;   echo &#34;delete logs $days_ago days ago&#34;&#10;fi&#10;# &#26085;&#24535;&#25991;&#20214;&#21517;&#26684;&#24335;:datacenter.2016-12-02.25.log&#10;# &#21462;&#20986;&#26085;&#26399;&#10;recent_date=$(ls -t $logs_dir | head -10 | grep  -Eo &#34;[[:digit:]]&#123;4&#125;-[[:digit:]]+-[[:digit:]]+&#34; | head -1)&#10;# delete logs older than 7 days&#10;recent_date=$(date -d &#34;$recent_date -7days&#34; +%F)&#10;for (( d=1; d&#60;=$days_ago; d++))&#10;do&#10;    xdaysago=$(date -d &#34;$recent_date -$d days&#34; +%F)&#10;    file_pattern=&#34;$logs_dir/datacenter.$xdaysago.*&#34;&#10;    echo &#34;rm $file_pattern&#34;&#10;    $(rm $file_pattern)&#10;done&#10;echo &#34;done!&#34;</span><br></pre></td></tr></table></figure>
<p>Then add a cron job:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e&#10;@weekly sh /opt/ruoshui/bin/clear_logs.sh 8</span><br></pre></td></tr></table></figure>
</div></article><div class="tags"><a href="/tags/shell/">shell</a></div><div class="paginator"><a href="/2016/12/06/wkhtmltopdf折腾记/" class="prev"><i class="iconfont icon-left"></i><span> Prev</span></a><a href="/2016/11/23/Dubbo学习-理解动态代理/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://yoursite.com/2016/12/06/日志清理脚本-md/';
    this.page.identifier = '2016/12/06/日志清理脚本-md/';
    this.page.title = '日志清理脚本';
};
(function() {
var d = document, s = d.createElement('script');

s.src = '//santang.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></section><footer><div class="social"><a href="mailto:daveztong@gmail.com" title="email" class="iconfont icon-email"></a><a href="http://stackoverflow.com/users/1388881/daveztong" title="stack-overflow" class="iconfont icon-stack-overflow"></a><a href="/atom.xml" title="rss" class="iconfont icon-rss"></a></div><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">三唐</span></p></div><div id="back2top"><i class="iconfont icon-up"></i></div></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>