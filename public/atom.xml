<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ä¸‰å”</title>
  <subtitle>Success requires experimentation!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2016-12-06T05:49:54.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>ä¸‰å”</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>wkhtmltopdfæŠ˜è…¾è®°</title>
    <link href="http://yoursite.com/2016/12/06/wkhtmltopdf%E6%8A%98%E8%85%BE%E8%AE%B0/"/>
    <id>http://yoursite.com/2016/12/06/wkhtmltopdfæŠ˜è…¾è®°/</id>
    <published>2016-12-06T03:46:58.000Z</published>
    <updated>2016-12-06T05:49:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="What_for_3F"><a href="#What_for_3F" class="headerlink" title="What for?"></a>What for?</h2><p>PRD: æ‰“å°æ¡æ¬¾ä»¥ä¾›ç”¨æˆ·ä¸‹è½½ã€‚</p>
<p>After googling around,there are two possiable options:</p>
<ul>
<li><p><a href="http://itextpdf.com/" target="_blank" rel="external">iText</a>. ä»¥å‰ä¸€èˆ¬éƒ½ç”¨è¿™ä¸ªæ¥åšPDFçš„ç”Ÿæˆï¼Œä½†è¯•ç”¨äº†ä¸€ä¸‹æ„Ÿè§‰å¾ˆæ˜¯éš¾ç”¨ï¼ </p>
</li>
<li><p><a href="http://wkhtmltopdf.org/" target="_blank" rel="external">wkhtmltopdf</a>. ä¸€ä¸ªå•ç‹¬çš„ç¨‹åºï¼Œå‘½ä»¤è¡Œå¯ç›´æ¥ä½¿ç”¨ç”¨ï¼Œç›¸å¯¹(ä¹Ÿæœ‰ä¸€äº›å‘)æ¥è¯´ç®€å•æ˜“ç”¨ã€‚å®˜æ–¹ä»‹ç»:</p>
<blockquote>
<p><code>wkhtmltopdf</code> and <code>wkhtmltoimage</code> are open source (LGPLv3) command line tools to render HTML into PDF and various image formats using the Qt WebKit rendering engine. These run entirely â€œheadlessâ€ and do not require a display or display service.</p>
</blockquote>
</li>
</ul>
<a id="more"></a>
<h2 id="u5F00_u59CB_u6363_u9F13"><a href="#u5F00_u59CB_u6363_u9F13" class="headerlink" title="å¼€å§‹æ£é¼“"></a>å¼€å§‹æ£é¼“</h2><h3 id="u672C_u5730_u73AF_u5883"><a href="#u672C_u5730_u73AF_u5883" class="headerlink" title="æœ¬åœ°ç¯å¢ƒ"></a>æœ¬åœ°ç¯å¢ƒ</h3><p>æœ¬åœ°mac,å®˜ç½‘ä¸‹äº†ä¸€ä¸ªpkgåŒ…ï¼Œå®‰è£…åç»ˆç«¯ç›´æ¥:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wkhtmltopdf http://baidu.com baidu.pdf</span><br></pre></td></tr></table></figure>
<p>yeah,it works! ä¸é”™ï¼Œä»¥ä¸ºå°±è¡Œäº†ï¼Œç»“æœå„ç§é—®é¢˜ï¼Œå­—ä½“å¤ªå°ï¼Œé¡µé¢ä¹Ÿæ„Ÿè§‰ç¼©å°äº†å¾ˆå¤šï¼Œèµ·åˆä»¥ä¸ºCSSçš„é—®é¢˜ï¼Œè°ƒäº†ä¸€ä¸‹æ²¡ä»€ä¹ˆåµç”¨ã€‚äºæ˜¯å†æ¬¡GoogleåŠå¤©ï¼Œå‘ç°äº†è¿™ä¹ˆä¸€ç¯‡æ–‡ç« :<a href="http://blog.gluga.com/2012/05/wkhtmltopdf-font-and-sizing-issues.html" target="_blank" rel="external">wkhtmltopdf-font-and-sizing-issues</a>, ä½¿ç”¨äº†è¯¥æ–‡ç« ä¸­æ‰€è¯´çš„<code>--disable-smart-shrinking</code> é¡µé¢ç¼©å°çš„é—®é¢˜å¾—åˆ°è§£å†³ã€‚ ä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé¡µé¢æœªåˆ†é¡µï¼Œæ•´ä¸ªè¯ºè¾¾çš„HTMLé¡µé¢å®Œå…¨æ‰“æˆäº†ä¸€é¡µï¼ŒSOä¸Šçœ‹åˆ°æœ‰äººè¯´ä»¥ä¸‹æ–¹æ³•å¯ä»¥è§£å†³:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">div</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">page-break-before</span>:<span class="value"> always</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">body</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">1em</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">text-rendering</span>:<span class="value"> geometricPrecision</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>åŠ å…¥styleä¹‹åæ•ˆæœå¾—ä»¥ç¼“è§£ã€‚ä»¥ä¸ºè‡³æ­¤å°±ç®—æŠ˜è…¾å®Œäº†ï¼Œno way, ç»§ç»­ã€‚</p>
<h3 id="u670D_u52A1_u5668_u73AF_u5883"><a href="#u670D_u52A1_u5668_u73AF_u5883" class="headerlink" title="æœåŠ¡å™¨ç¯å¢ƒ"></a>æœåŠ¡å™¨ç¯å¢ƒ</h3><p>æœåŠ¡å™¨centos, yum:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install wkhtmltopdf</span><br></pre></td></tr></table></figure>
<p>å…´é«˜é‡‡çƒˆåœ°è¯•ä¸€æŠŠ:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wkhtmltopdf http://baidu.com baidu.pdf</span><br></pre></td></tr></table></figure>
<p>oops, error: <code>can not connect to X server</code>.</p>
<p>å°è¯•Googleå¤§æ³•ï¼ŒSOæœ‰ä¸ªå›ç­”ï¼š<a href="http://stackoverflow.com/a/9685072/1388881ï¼Œ" target="_blank" rel="external">http://stackoverflow.com/a/9685072/1388881ï¼Œ</a> ç…§ç€è¯•äº†ä¸€ä¸‹ï¼Œç»“æœè¿˜æ˜¯æ— æœã€‚ åˆGoogleäº†å¤§åŠå¤©å‘ç°å¾ˆå¤šç›´æ¥ä¸‹è½½å®˜ç½‘çš„å®‰è£…åŒ…å°±æ²¡æœ‰é—®é¢˜ï¼Œäºæ˜¯ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.gna.org/wkhtmltopdf/0.12/0.12.4/wkhtmltox-0.12.4_linux-generic-amd64.tar.xz&#10;tar xf wkhtmltox-0.12.4_linux-generic-amd64.tar.xz&#10;cd wkhtmltox/bin&#10;cp wkhtmltopdf /bin</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡å°è¯•<code>wkhtmltopdf http://baidu.com baidu.pdf</code>, and it works! åªæƒ³æ„Ÿå¹ä¸€å¥ï¼Œèƒ½æ´»åˆ°ä»Šå¤©çœŸæ˜¯ğŸ’—å¤§å•Š!</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p>ä¸€å¼€å§‹ä½¿ç”¨çš„æ˜¯<a href="https://github.com/jhonnymertz/java-wkhtmltopdf-wrapper" target="_blank" rel="external">Java WkHtmlToPdf Wrapper</a>, ä½†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¶å°”ä¼šå‡ºç°<code>HostNotFoundError</code>. æ‰€ä»¥æ”¾å¼ƒäº†ã€‚çœ‹äº†ä¸‹æºç ä¸æ˜¯å¾ˆå¤šä»£ç ï¼Œè‡ªå·±å†™äº†ä¸ªè°ƒç”¨<code>wkhtmltopdf</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PDFService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(PDFService.class);</span><br><span class="line">    <span class="keyword">private</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] html2pdf(String srcUrl) &#123;</span><br><span class="line">        String tmp = System.getProperty(<span class="string">"java.io.tmpdir"</span>);</span><br><span class="line">        String filename = System.currentTimeMillis() + random.nextInt(<span class="number">1000</span>) + <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">return</span> html2pdf(srcUrl, tmp + <span class="string">"/"</span> + filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] html2pdf(String src, String dest) &#123;</span><br><span class="line"></span><br><span class="line">        String space = <span class="string">" "</span>;</span><br><span class="line"></span><br><span class="line">        String wkhtmltopdf = findExecutable();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(wkhtmltopdf)) &#123;</span><br><span class="line">            logger.error(<span class="string">"no wkhtmltopdf found!"</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"htmlè½¬æ¢pdfå‡ºé”™äº†"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File file = <span class="keyword">new</span> File(dest);</span><br><span class="line">        File parent = file.getParentFile();</span><br><span class="line">        <span class="keyword">if</span> (!parent.exists()) &#123;</span><br><span class="line">            <span class="keyword">boolean</span> dirsCreation = parent.mkdirs();</span><br><span class="line">            logger.info(<span class="string">"create dir for new file,&#123;&#125;"</span>, dirsCreation);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        StringBuilder cmd = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        cmd.append(findExecutable()).append(space)</span><br><span class="line">                .append(src).append(space)</span><br><span class="line">                .append(<span class="string">"--footer-right"</span>).append(space).append(<span class="string">"é¡µç :[page]"</span>).append(space)</span><br><span class="line">                .append(<span class="string">"--footer-font-size"</span>).append(space).append(<span class="string">"5"</span>).append(space)</span><br><span class="line">                .append(<span class="string">"--disable-smart-shrinking"</span>).append(space)</span><br><span class="line">                .append(<span class="string">"--load-media-error-handling"</span>)</span><br><span class="line">                .append(space).append(<span class="string">"ignore"</span>).append(space)</span><br><span class="line">                .append(<span class="string">"--load-error-handling"</span>).append(space).append(<span class="string">"ignore"</span>).append(space)</span><br><span class="line">                .append(<span class="string">"--footer-left"</span>).append(space).append(<span class="string">"ç”µå­æ¡£æ‰“å°æ—¶é—´:[date]"</span>).append(space)</span><br><span class="line">                .append(dest);</span><br><span class="line"></span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String finalCmd = cmd.toString();</span><br><span class="line">            logger.info(<span class="string">"final cmd:&#123;&#125;"</span>, finalCmd);</span><br><span class="line"></span><br><span class="line">            Process proc = Runtime.getRuntime().exec(finalCmd);</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> ProcessStreamHandler(proc.getInputStream())).start();</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> ProcessStreamHandler(proc.getErrorStream())).start();</span><br><span class="line">            proc.waitFor();</span><br><span class="line"></span><br><span class="line">            ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">            is = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">            <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> (is.read(buf, <span class="number">0</span>, buf.length) != -<span class="number">1</span>) &#123;</span><br><span class="line">                baos.write(buf, <span class="number">0</span>, buf.length);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">"htmlè½¬æ¢pdfå‡ºé”™"</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"htmlè½¬æ¢pdfå‡ºé”™äº†"</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (is != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    is.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Attempts to find the `wkhtmltopdf` executable in the system path.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> the wkhtmltopdf command according to the OS</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">findExecutable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Process p;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String osname = System.getProperty(<span class="string">"os.name"</span>).toLowerCase();</span><br><span class="line"></span><br><span class="line">            String cmd = osname.contains(<span class="string">"windows"</span>) ? <span class="string">"where wkhtmltopdf"</span> : <span class="string">"which wkhtmltopdf"</span>;</span><br><span class="line"></span><br><span class="line">            p = Runtime.getRuntime().exec(cmd);</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> ProcessStreamHandler(p.getErrorStream())).start();</span><br><span class="line">            p.waitFor();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> IOUtils.toString(p.getInputStream(), Charset.defaultCharset());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">"no wkhtmltopdf found!"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessStreamHandler</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> InputStream is;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ProcessStreamHandler</span><span class="params">(InputStream is)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.is = is;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            BufferedReader reader = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(is, <span class="string">"utf-8"</span>);</span><br><span class="line">                reader = <span class="keyword">new</span> BufferedReader(isr);</span><br><span class="line">                String line;</span><br><span class="line">                <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ConfigAdapter.getIsDebug())</span><br><span class="line">                        System.out.println(line); <span class="comment">//è¾“å‡ºå†…å®¹</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (reader != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        reader.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;What_for_3F&quot;&gt;&lt;a href=&quot;#What_for_3F&quot; class=&quot;headerlink&quot; title=&quot;What for?&quot;&gt;&lt;/a&gt;What for?&lt;/h2&gt;&lt;p&gt;PRD: æ‰“å°æ¡æ¬¾ä»¥ä¾›ç”¨æˆ·ä¸‹è½½ã€‚&lt;/p&gt;
&lt;p&gt;After googling around,there are two possiable options:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://itextpdf.com/&quot;&gt;iText&lt;/a&gt;. ä»¥å‰ä¸€èˆ¬éƒ½ç”¨è¿™ä¸ªæ¥åšPDFçš„ç”Ÿæˆï¼Œä½†è¯•ç”¨äº†ä¸€ä¸‹æ„Ÿè§‰å¾ˆæ˜¯éš¾ç”¨ï¼ &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://wkhtmltopdf.org/&quot;&gt;wkhtmltopdf&lt;/a&gt;. ä¸€ä¸ªå•ç‹¬çš„ç¨‹åºï¼Œå‘½ä»¤è¡Œå¯ç›´æ¥ä½¿ç”¨ç”¨ï¼Œç›¸å¯¹(ä¹Ÿæœ‰ä¸€äº›å‘)æ¥è¯´ç®€å•æ˜“ç”¨ã€‚å®˜æ–¹ä»‹ç»:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;wkhtmltopdf&lt;/code&gt; and &lt;code&gt;wkhtmltoimage&lt;/code&gt; are open source (LGPLv3) command line tools to render HTML into PDF and various image formats using the Qt WebKit rendering engine. These run entirely â€œheadlessâ€ and do not require a display or display service.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="wkhtmltopdf" scheme="http://yoursite.com/tags/wkhtmltopdf/"/>
    
  </entry>
  
  <entry>
    <title>æ—¥å¿—æ¸…ç†è„šæœ¬</title>
    <link href="http://yoursite.com/2016/12/06/%E6%97%A5%E5%BF%97%E6%B8%85%E7%90%86%E8%84%9A%E6%9C%AC-md/"/>
    <id>http://yoursite.com/2016/12/06/æ—¥å¿—æ¸…ç†è„šæœ¬-md/</id>
    <published>2016-12-06T03:21:32.000Z</published>
    <updated>2016-12-06T03:44:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ—¥å¿—è¿‡å¤šï¼Œcrontab to the rescue!</p>
<p>æ¸…ç†Xå¤©å‰çš„æ—¥å¿—:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logs_dir=&#34;/path/to/logs&#34;&#10;&#10;# default 7+1 day ago&#10;days_ago=1&#10;&#10;if [ ! -z &#34;$1&#34; ]; then&#10;    echo &#34;delete logs $1 days ago&#34;&#10;    days_ago=$1&#10;else&#10;   echo &#34;delete logs $days_ago days ago&#34;&#10;fi&#10;# &#26085;&#24535;&#25991;&#20214;&#21517;&#26684;&#24335;:datacenter.2016-12-02.25.log&#10;# &#21462;&#20986;&#26085;&#26399;&#10;recent_date=$(ls -t $logs_dir | head -10 | grep  -Eo &#34;[[:digit:]]&#123;4&#125;-[[:digit:]]+-[[:digit:]]+&#34; | head -1)&#10;# delete logs older than 7 days&#10;recent_date=$(date -d &#34;$recent_date -7days&#34; +%F)&#10;for (( d=1; d&#60;=$days_ago; d++))&#10;do&#10;    xdaysago=$(date -d &#34;$recent_date -$d days&#34; +%F)&#10;    file_pattern=&#34;$logs_dir/datacenter.$xdaysago.*&#34;&#10;    echo &#34;rm $file_pattern&#34;&#10;    $(rm $file_pattern)&#10;done&#10;echo &#34;done!&#34;</span><br></pre></td></tr></table></figure>
<p>Then add a cron job:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e&#10;@weekly sh /opt/ruoshui/bin/clear_logs.sh 8</span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ—¥å¿—è¿‡å¤šï¼Œcrontab to the rescue!&lt;/p&gt;
&lt;p&gt;æ¸…ç†Xå¤©å‰çš„æ—¥å¿—:&lt;/p&gt;
&lt;figure class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
    
    </summary>
    
    
      <category term="shell" scheme="http://yoursite.com/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Dubboå­¦ä¹ -ç†è§£åŠ¨æ€ä»£ç†</title>
    <link href="http://yoursite.com/2016/11/23/Dubbo%E5%AD%A6%E4%B9%A0-%E7%90%86%E8%A7%A3%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    <id>http://yoursite.com/2016/11/23/Dubboå­¦ä¹ -ç†è§£åŠ¨æ€ä»£ç†/</id>
    <published>2016-11-23T14:38:15.000Z</published>
    <updated>2016-11-24T10:19:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Dubbo_u5B66_u4E60-_u7406_u89E3_u52A8_u6001_u4EE3_u7406"><a href="#Dubbo_u5B66_u4E60-_u7406_u89E3_u52A8_u6001_u4EE3_u7406" class="headerlink" title="Dubboå­¦ä¹ -ç†è§£åŠ¨æ€ä»£ç†"></a>Dubboå­¦ä¹ -ç†è§£åŠ¨æ€ä»£ç†</h1><p>åœ¨ä¹‹å‰çš„ä¸€ç¯‡postä¸­äº†è§£äº†<a href="http://daveztong.github.io/2016/11/01/Spring%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84XML%E9%85%8D%E7%BD%AE/" target="_blank" rel="external">springå¯æ‰©å±•çš„XMLé…ç½®</a>æ˜¯æ€ä¹ˆä¸€ä¼šäº‹ï¼Œæ¥ä¸‹æ¥ç»§ç»­ç ”ç©¶dubbo consumerç«¯å¦‚ä½•è§£æserviceå¹¶æ‰§è¡Œè¿œç¨‹è°ƒç”¨ã€‚</p>
<h2 id="u672C_u6B21_u7814_u7A76_u76EE_u6807"><a href="#u672C_u6B21_u7814_u7A76_u76EE_u6807" class="headerlink" title="æœ¬æ¬¡ç ”ç©¶ç›®æ ‡"></a>æœ¬æ¬¡ç ”ç©¶ç›®æ ‡</h2><ol>
<li>ä»£ç†å¦‚ä½•åˆ›å»ºçš„ã€‚ä»…ä»…åªæ˜¯é…ç½®äº†<code>&lt;dubbo:reference interface=&quot;x.y.z.ServiceInterface&quot; id=&quot;serviceId&quot;/&gt;</code>å¹¶å°†å…¶äº¤ç»™äº†spring containerï¼Œç„¶åç›´æ¥æ³¨å…¥å¹¶ä½¿ç”¨è¯¥æ¥å£çš„æ–¹æ³•å°±å¯ä»¥å®Œæˆè°ƒç”¨äº†ï¼Œç„¶è€Œæˆ‘å¹¶æ²¡æœ‰ä¸ºè¯¥æ¥å£å®ç°å…·ä½“çš„ç±»ï¼Œhow does it works? </li>
<li><del>è¿œç¨‹è°ƒç”¨å¦‚ä½•æ‰§è¡Œçš„ã€‚å‡è®¾å·²ç»æœ‰äº†å…·ä½“çš„å®ç°ç±»ï¼Œæ€ä¹ˆå®ç°è¿œç¨‹è°ƒç”¨çš„å‘¢ï¼ŒThingking?</del> ç”±äºç¬¬ä¸€ä¸ªåˆ†æå°±å¾ˆé•¿ï¼Œè¿™ä¸ªç›®æ ‡åˆ—å…¥ä¸‹ä¸€æ¬¡åˆ†æã€‚</li>
</ol>
<a id="more"></a>
<h2 id="u9884_u5907_u77E5_u8BC6"><a href="#u9884_u5907_u77E5_u8BC6" class="headerlink" title="é¢„å¤‡çŸ¥è¯†"></a>é¢„å¤‡çŸ¥è¯†</h2><p>ä¸ºäº†é¡ºåˆ©çš„ç ”ç©¶ä¸Šè¿°ä¸¤ä¸ªç›®æ ‡ï¼Œéœ€è¦äº†è§£ä»¥ä¸‹çŸ¥è¯†:</p>
<ol>
<li>SPI. <a href="https://docs.oracle.com/javase/tutorial/ext/basics/spi.html" target="_blank" rel="external">å®˜æ–¹æ•™ç¨‹</a>ã€‚ç”¨äºæœåŠ¡æ‰©å±•ã€‚</li>
<li>Netty. <a href="http://netty.io/wiki/user-guide-for-4.x.html" target="_blank" rel="external">User Guide</a>ã€‚ç”¨äºè¿œç¨‹è°ƒç”¨ã€‚</li>
<li>Javassist. <a href="https://jboss-javassist.github.io/javassist/tutorial/tutorial.html" target="_blank" rel="external">å®˜æ–¹Tutorial</a>ã€‚åŠ¨æ€ç±»ç”Ÿæˆã€‚</li>
</ol>
<h2 id="How_to_dig_in_3F"><a href="#How_to_dig_in_3F" class="headerlink" title="How to dig in?"></a>How to dig in?</h2><p>ä»ä½•å¤„å…¥æ‰‹æ˜¯ä¸ªé—®é¢˜ï¼Œæˆ‘çš„ä¹ æƒ¯æ˜¯é¡ºè—¤æ‘¸ç“œï¼Œæ‰€ä»¥ä»serviceè¢«æ³¨å…¥å¼€å§‹:</p>
<p>dubbo serviceé…ç½®:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- DemoService is just a interface --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">dubbo:reference</span> <span class="attribute">interface</span>=<span class="value">"x.y.z.DemoService"</span> <span class="attribute">id</span>=<span class="value">"demoService"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>Serviceæ³¨å…¥:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Resource</span></span><br><span class="line"><span class="keyword">private</span> DemoService demoService;</span><br></pre></td></tr></table></figure>
<p>å½“ä½¿ç”¨è¿™ä¸ª<code>demoService</code>çš„æ—¶å€™å¯ä»¥è‚¯å®šçš„æ˜¯ä¸€å®šæœ‰ä¸ªDemoServiceçš„å…·ä½“å®ç°å¯ä¾›ä½¿ç”¨ï¼Œ<code>DubboNamespaceHandler</code>ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registerBeanDefinitionParser(<span class="string">"reference"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ReferenceBean.class,<span class="keyword">false</span>));</span><br></pre></td></tr></table></figure>
<p>è§£æä¸Šé¢é…ç½®åœ¨namespace dubboä¸‹çš„referenceã€‚<code>DubboBeanDefinitionParser</code>ç›¸å…³ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DubboBeanDefinitionParser</span><span class="params">(Class&lt;?&gt; beanClass, <span class="keyword">boolean</span> required)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.beanClass = beanClass;</span><br><span class="line">  <span class="keyword">this</span>.required = required;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> BeanDefinition <span class="title">parse</span><span class="params">(Element element, ParserContext parserContext)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> parse(element, parserContext, beanClass, required);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é”®éƒ¨åˆ†</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BeanDefinition <span class="title">parse</span><span class="params">(Element element, ParserContext parserContext, Class&lt;?&gt; beanClass, <span class="keyword">boolean</span> required)</span> </span>&#123;</span><br><span class="line">    RootBeanDefinition beanDefinition = <span class="keyword">new</span> RootBeanDefinition();</span><br><span class="line">    <span class="comment">// è®¾ç½®bean class,in this case it is ReferenceBean.class</span></span><br><span class="line">    beanDefinition.setBeanClass(beanClass);</span><br><span class="line">    beanDefinition.setLazyInit(<span class="keyword">false</span>);</span><br><span class="line">    String id = element.getAttribute(<span class="string">"id"</span>);</span><br><span class="line">    <span class="comment">// some ops...</span></span><br><span class="line">    <span class="keyword">if</span> (id != <span class="keyword">null</span> &amp;&amp; id.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (parserContext.getRegistry().containsBeanDefinition(id))  &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Duplicate spring bean id "</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">        parserContext.getRegistry().registerBeanDefinition(id, beanDefinition);</span><br><span class="line">        beanDefinition.getPropertyValues().addPropertyValue(<span class="string">"id"</span>, id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// some ops...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†setter and getterè®¾ç½®å±æ€§å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (Method setter : beanClass.getMethods()) &#123;</span><br><span class="line">        String name = setter.getName();</span><br><span class="line">        <span class="keyword">if</span> (name.length() &gt; <span class="number">3</span> &amp;&amp; name.startsWith(<span class="string">"set"</span>)</span><br><span class="line">                &amp;&amp; Modifier.isPublic(setter.getModifiers())</span><br><span class="line">                &amp;&amp; setter.getParameterTypes().length == <span class="number">1</span>) &#123;</span><br><span class="line">            Class&lt;?&gt; type = setter.getParameterTypes()[<span class="number">0</span>];</span><br><span class="line">            String property = StringUtils.camelToSplitName(name.substring(<span class="number">3</span>, <span class="number">4</span>).toLowerCase() + name.substring(<span class="number">4</span>), <span class="string">"-"</span>);</span><br><span class="line">            <span class="keyword">if</span>(...)&#123;</span><br><span class="line">                <span class="comment">// some ops...</span></span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                String value = element.getAttribute(property);</span><br><span class="line">                <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    value = value.trim();</span><br><span class="line">                    <span class="keyword">if</span> (value.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                           <span class="comment">// éƒ¨åˆ†çœç•¥...</span></span><br><span class="line">                            Object reference;</span><br><span class="line">                            <span class="keyword">if</span> (isPrimitive(type)) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (<span class="string">"async"</span>.equals(property) &amp;&amp; <span class="string">"false"</span>.equals(value)</span><br><span class="line">                                        || <span class="string">"timeout"</span>.equals(property) &amp;&amp; <span class="string">"0"</span>.equals(value)</span><br><span class="line">                                        || <span class="string">"delay"</span>.equals(property) &amp;&amp; <span class="string">"0"</span>.equals(value)</span><br><span class="line">                                        || <span class="string">"version"</span>.equals(property) &amp;&amp; <span class="string">"0.0.0"</span>.equals(value)</span><br><span class="line">                                        || <span class="string">"stat"</span>.equals(property) &amp;&amp; <span class="string">"-1"</span>.equals(value)</span><br><span class="line">                                        || <span class="string">"reliable"</span>.equals(property) &amp;&amp; <span class="string">"false"</span>.equals(value)) &#123;</span><br><span class="line">                                    <span class="comment">// å…¼å®¹æ—§ç‰ˆæœ¬xsdä¸­çš„defaultå€¼</span></span><br><span class="line">                                    value = <span class="keyword">null</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                reference = value;</span><br><span class="line">                            &#125; </span><br><span class="line"></span><br><span class="line">                            <span class="comment">// å¤§æ‰¹çœç•¥...</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">// è¿™é‡Œä¼šå°†interfaceè¿™ä¸ªattributeçš„å€¼è®¾ç½®åœ¨ReferenceBeançš„çˆ¶ç±»ReferenceConfigçš„interfaceNameä¸Šé€šè¿‡method:setInterface(String)</span></span><br><span class="line">                            beanDefinition.getPropertyValues().addPropertyValue(property, reference);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// çœç•¥...</span></span><br><span class="line">    <span class="keyword">return</span> beanDefinition;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¸¤ä¸ªå…³é”®çš„å±æ€§å€¼id,interfaceéƒ½è®¾ç½®åœ¨äº†beanä¸Šï¼Œåé¢ä¼šç”¨åˆ°ã€‚ReferenceConfigä¸­çš„settter:setInterfaceç”¨æ¥è®¾ç½®interfaceï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInterface</span><span class="params">(String interfaceName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.interfaceName = interfaceName;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="keyword">null</span> || id.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            id = interfaceName;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒReferenceBean Hierarchy:</p>
<p><img src="http://ww1.sinaimg.cn/mw690/50508d62gw1fa1b4h76xgj21960van07.jpg" alt="ReferenceBean Hierarchy"></p>
<p>ReferenceBeanä¸­åŒ…å«ä»¥å‡ ä¸ªä¸¤ä¸ªæ–¹æ³•:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="comment">// inherit from ApplicationContextAware</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">  SpringExtensionFactory.addApplicationContext(applicationContext);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="comment">// inherit from FactoryBean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> get();<span class="comment">// è°ƒç”¨ReferenceConfig#get()æ–¹æ³•åˆ›å»ºç±»å‹ä¸ºgetObjectType()çš„å¯¹è±¡ï¼Œwhich in this case is instance of x.y.z.DemoService</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// inherit from FactoryBean</span></span><br><span class="line"><span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">  <span class="keyword">return</span> getInterfaceClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æ­¤ï¼Œé‡ç‚¹å…³æ³¨ReferenceConfig#get(),follow up:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (destroyed)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Already destroyed!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (ref == <span class="keyword">null</span>) &#123;</span><br><span class="line">    init();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥init():</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// some ops...</span></span><br><span class="line">     &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ä¹‹å‰è®¾ç½®çš„interface:x.y.z.DemoService</span></span><br><span class="line">            interfaceClass = Class.forName(interfaceName, <span class="keyword">true</span>, Thread.currentThread()</span><br><span class="line">                    .getContextClassLoader());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">        checkInterfaceAndMethods(interfaceClass, methods);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// a lot of ops...</span></span><br><span class="line">    ref = createProxy(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥createProxy(Map):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> T <span class="title">createProxy</span><span class="params">(Map&lt;String, String&gt; map)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//some ops...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (urls.size() == <span class="number">1</span>) &#123;</span><br><span class="line">        invoker = refprotocol.refer(interfaceClass, urls.get(<span class="number">0</span>));</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// some ops...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæœåŠ¡ä»£ç†</span></span><br><span class="line">    <span class="keyword">return</span> (T) proxyFactory.getProxy(invoker);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œå·²ç»çŸ¥é“ä»£ç†æ˜¯ç”±ProxyFactoryåˆ›å»ºäº†ï¼Œæ¥ä¸‹é‡ç‚¹çœ‹çœ‹ProxyFactory.</p>
<h2 id="ProxyFactory"><a href="#ProxyFactory" class="headerlink" title="ProxyFactory"></a>ProxyFactory</h2><p>ProxyFactory  Hierarchy:</p>
<p><img src="http://ww4.sinaimg.cn/mw690/50508d62gw1fa27gqakyxj20l8080gmy.jpg" alt="ProxyFactory Hierarchy"></p>
<h3 id="AbstractProxyFactory"><a href="#AbstractProxyFactory" class="headerlink" title="AbstractProxyFactory"></a>AbstractProxyFactory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(Invoker&lt;T&gt; invoker)</span> <span class="keyword">throws</span> RpcException </span>&#123;</span><br><span class="line">  Class&lt;?&gt;[] interfaces = <span class="keyword">null</span>;</span><br><span class="line">  <span class="comment">// createProxyæ—¶åˆ›å»ºinvokeræ—¶å·²å°†interfaceä¼ å…¥</span></span><br><span class="line">  String config = invoker.getUrl().getParameter(<span class="string">"interfaces"</span>);</span><br><span class="line">  <span class="keyword">if</span> (config != <span class="keyword">null</span> &amp;&amp; config.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    String[] types = Constants.COMMA_SPLIT_PATTERN.split(config);</span><br><span class="line">    <span class="keyword">if</span> (types != <span class="keyword">null</span> &amp;&amp; types.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      interfaces = <span class="keyword">new</span> Class&lt;?&gt;[types.length + <span class="number">2</span>];</span><br><span class="line">      interfaces[<span class="number">0</span>] = invoker.getInterface();</span><br><span class="line">      interfaces[<span class="number">1</span>] = EchoService.class;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; types.length; i ++) &#123;</span><br><span class="line">        interfaces[i + <span class="number">1</span>] = ReflectUtils.forName(types[i]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (interfaces == <span class="keyword">null</span>) &#123;</span><br><span class="line">    interfaces = <span class="keyword">new</span> Class&lt;?&gt;[] &#123;invoker.getInterface(), EchoService.class&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è°ƒç”¨å­ç±»çš„å®ç°</span></span><br><span class="line">  <span class="keyword">return</span> getProxy(invoker, interfaces);</span><br></pre></td></tr></table></figure>
<h3 id="JavassistProxyFactory"><a href="#JavassistProxyFactory" class="headerlink" title="JavassistProxyFactory"></a>JavassistProxyFactory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[] interfaces)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (T) Proxy.getProxy(interfaces).newInstance(<span class="keyword">new</span> InvokerInvocationHandler(invoker));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getProxy</code>çš„ç›¸å…³ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Proxy <span class="title">getProxy</span><span class="params">(Class&lt;?&gt;... ics)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getProxy(ClassHelper.getCallerClassLoader(Proxy.class), ics);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŠ¨æ€ç±»çš„å®ç°:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Proxy <span class="title">getProxy</span><span class="params">(ClassLoader cl, Class&lt;?&gt;... ics)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">//some ops...</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            ccp = ClassGenerator.newInstance(cl);</span><br><span class="line"></span><br><span class="line">            Set&lt;String&gt; worked = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">            List&lt;Method&gt; methods = <span class="keyword">new</span> ArrayList&lt;Method&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åå°„è·å–interfaceçš„ç›¸å…³ä¿¡æ¯å¹¶build code stringï¼Œç„¶åäº¤ç»™javassiståŠ¨æ€ç”Ÿæˆå®ç°ç±»ã€‚</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ics.length;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>( !Modifier.isPublic(ics[i].getModifiers()) )</span><br><span class="line">                &#123;</span><br><span class="line">                    String npkg = ics[i].getPackage().getName();</span><br><span class="line">                    <span class="keyword">if</span>( pkg == <span class="keyword">null</span> )</span><br><span class="line">                    &#123;</span><br><span class="line">                        pkg = npkg;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span>( !pkg.equals(npkg)  )</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"non-public interfaces from different packages"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                ccp.addInterface(ics[i]);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span>( Method method : ics[i].getMethods() )</span><br><span class="line">                &#123;</span><br><span class="line">                    String desc = ReflectUtils.getDesc(method);</span><br><span class="line">                    <span class="keyword">if</span>( worked.contains(desc) )</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    worked.add(desc);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">int</span> ix = methods.size();</span><br><span class="line">                    Class&lt;?&gt; rt = method.getReturnType();</span><br><span class="line">                    Class&lt;?&gt;[] pts = method.getParameterTypes();</span><br><span class="line"></span><br><span class="line">                    StringBuilder code = <span class="keyword">new</span> StringBuilder(<span class="string">"Object[] args = new Object["</span>).append(pts.length).append(<span class="string">"];"</span>);</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;pts.length;j++)</span><br><span class="line">                        code.append(<span class="string">" args["</span>).append(j).append(<span class="string">"] = ($w)$"</span>).append(j+<span class="number">1</span>).append(<span class="string">";"</span>);</span><br><span class="line">                    <span class="comment">// æ³¨æ„è¿™é‡Œ handler.invoke(),ä»£ç†çš„ç»Ÿä¸€å¤„ç†</span></span><br><span class="line">                    code.append(<span class="string">" Object ret = handler.invoke(this, methods["</span> + ix + <span class="string">"], args);"</span>);</span><br><span class="line">                    <span class="keyword">if</span>( !Void.TYPE.equals(rt) )</span><br><span class="line">                        code.append(<span class="string">" return "</span>).append(asArgument(rt, <span class="string">"ret"</span>)).append(<span class="string">";"</span>);</span><br><span class="line"></span><br><span class="line">                    methods.add(method);</span><br><span class="line">                    ccp.addMethod(method.getName(), method.getModifiers(), rt, pts, method.getExceptionTypes(), code.toString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>( pkg == <span class="keyword">null</span> )</span><br><span class="line">                pkg = PACKAGE_NAME;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ¥å£çš„å®ç°ç±»</span></span><br><span class="line">            String pcn = pkg + <span class="string">".proxy"</span> + id;</span><br><span class="line">            ccp.setClassName(pcn);</span><br><span class="line">            ccp.addField(<span class="string">"public static java.lang.reflect.Method[] methods;"</span>);</span><br><span class="line">            ccp.addField(<span class="string">"private "</span> + InvocationHandler.class.getName() + <span class="string">" handler;"</span>);</span><br><span class="line">            ccp.addConstructor(Modifier.PUBLIC, <span class="keyword">new</span> Class&lt;?&gt;[]&#123; InvocationHandler.class &#125;, <span class="keyword">new</span> Class&lt;?&gt;[<span class="number">0</span>], <span class="string">"handler=$1;"</span>); <span class="comment">// $1ç­‰è¡¨ç¤ºä¼ å…¥çš„å‚æ•°ï¼Œå…·ä½“å‚è€ƒjavassistå®˜æ–¹æ–‡æ¡£</span></span><br><span class="line">            ccp.addDefaultConstructor();</span><br><span class="line">            Class&lt;?&gt; clazz = ccp.toClass();</span><br><span class="line">            clazz.getField(<span class="string">"methods"</span>).set(<span class="keyword">null</span>, methods.toArray(<span class="keyword">new</span> Method[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç”Ÿæˆå½“å‰Proxyçš„å­ç±»ï¼Œå®ç°newInstance()æ–¹æ³•</span></span><br><span class="line">            String fcn = Proxy.class.getName() + id;</span><br><span class="line">            ccm = ClassGenerator.newInstance(cl);</span><br><span class="line">            ccm.setClassName(fcn);</span><br><span class="line">            ccm.addDefaultConstructor();</span><br><span class="line">            ccm.setSuperClass(Proxy.class);</span><br><span class="line">            ccm.addMethod(<span class="string">"public Object newInstance("</span> + InvocationHandler.class.getName() + <span class="string">" h)&#123; return new "</span> + pcn + <span class="string">"($1); &#125;"</span>);</span><br><span class="line">            Class&lt;?&gt; pc = ccm.toClass();</span><br><span class="line">            proxy = (Proxy)pc.newInstance();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// some ops...</span></span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>toClass()</code> ä¸ºClassGeneratorçš„æ–¹æ³•ï¼Œå®ç°ä¹Ÿæ˜¯é€šè¿‡javassistç”ŸæˆåŠ¨æ€ç±»ã€‚ è¿™å„¿è¿”å›çš„æ˜¯Proxyçš„å­ç±»å®ä¾‹ã€‚JavassistProxyFactoryçš„getProxyä¸­<code>Proxy.getProxy(interfaces).newInstance(new InvokerInvocationHandler(invoker));</code>è¿™å„¿çš„newInstance()å°±å±äºè¿™ä¸ªå­ç±»å®ä¾‹ã€‚è¯¥æ–¹æ³•çš„å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(InvocationHandler handler)</span></span>;</span><br></pre></td></tr></table></figure>
<p>å†æ¥çœ‹çœ‹InvocationHandlerçš„å®ç°:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvokerInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Invoker&lt;?&gt; invoker;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InvokerInvocationHandler</span><span class="params">(Invoker&lt;?&gt; handler)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.invoker = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        String methodName = method.getName();</span><br><span class="line">        Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">        <span class="keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;</span><br><span class="line">            <span class="keyword">return</span> method.invoke(invoker, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"toString"</span>.equals(methodName) &amp;&amp; parameterTypes.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> invoker.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"hashCode"</span>.equals(methodName) &amp;&amp; parameterTypes.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> invoker.hashCode();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"equals"</span>.equals(methodName) &amp;&amp; parameterTypes.length == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> invoker.equals(args[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿”å›è¿œç¨‹è°ƒç”¨çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> invoker.invoke(<span class="keyword">new</span> RpcInvocation(method, args)).recreate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™å„¿å¯èƒ½è¿˜æœ‰ç‚¹è¿·ç³Šï¼Œinvokeæ˜¯åœ¨å“ªé‡Œè°ƒç”¨çš„å‘¢ï¼Ÿå›å¤´çœ‹çœ‹åŠ¨æ€ç±»ç”Ÿæˆéƒ¨åˆ†æœ‰è¿™æ ·ä¸€æ®µä»£ç :</p>
<p><code>code.append(&quot; Object ret = handler.invoke(this, methods[&quot; + ix + &quot;], args);&quot;);</code>è¿™å°±å°†ä»£ç†è°ƒç”¨è¡”æ¥èµ·æ¥äº†ã€‚çœ‹èµ·æ¥å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œå¾…ä¸‹é¢æ¥è¯•éªŒä¸€æŠŠã€‚</p>
<h4 id="u8BD5_u9A8C"><a href="#u8BD5_u9A8C" class="headerlink" title="è¯•éªŒ"></a>è¯•éªŒ</h4><p><code>DemoService.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.examples.x.y.z;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by tangwei on 2016/11/23.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DemoService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sayHi</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Main.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.examples.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.URL;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.examples.x.y.z.DemoService;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.proxy.javassist.JavassistProxyFactory;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.support.MockInvoker;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by tangwei on 2016/11/22.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> JavassistProxyFactory().getProxy(<span class="keyword">new</span> MockInvoker&lt;DemoService&gt;(<span class="keyword">new</span> URL(<span class="string">""</span>, <span class="string">""</span>, <span class="number">8888</span>)),</span><br><span class="line">                <span class="keyword">new</span> Class[]&#123;DemoService.class&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>ClassGenerator</code>ä¸­ toClassè¿”å›å‰åŠ å…¥ä»¥ä¸‹ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// å°†classå†™å…¥æ–‡ä»¶</span></span><br><span class="line">  mCtc.writeFile(<span class="string">"/path/to/save/classfile/"</span>+mSuperClass);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> mCtc.toClass(loader, pd);</span><br></pre></td></tr></table></figure>
<p>debugä¸€ä¸‹main,åœ¨åŠ¨æ€ç”Ÿæˆç±»çš„æ—¶å€™å°†ç±»å†™å…¥æ–‡ä»¶ä¸­ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p>DemoServiceçš„å®ç°:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.common.bytecode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.bytecode.ClassGenerator.DC;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.examples.x.y.z.DemoService;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">proxy0</span> <span class="keyword">implements</span> <span class="title">DC</span>, <span class="title">DemoService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Method[] methods;</span><br><span class="line">    <span class="keyword">private</span> InvocationHandler handler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHi</span><span class="params">(String var1)</span> </span>&#123;</span><br><span class="line">        Object[] var2 = <span class="keyword">new</span> Object[]&#123;var1&#125;;</span><br><span class="line">        <span class="keyword">this</span>.handler.invoke(<span class="keyword">this</span>, methods[<span class="number">0</span>], var2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">proxy0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">proxy0</span><span class="params">(InvocationHandler var1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.handler = var1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Proxyçš„å­ç±»:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.alibaba.dubbo.common.bytecode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.bytecode.Proxy;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.bytecode.proxy0;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.common.bytecode.ClassGenerator.DC;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy0</span> <span class="keyword">extends</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">DC</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(InvocationHandler var1)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿”å›çš„æ˜¯DemoServiceçš„å®ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> proxy0(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­DCæ¥å£åªæ˜¯ä¸€ä¸ªæ ‡è¯†æ¥å£ï¼Œè¡¨ç¤ºè¯¥ç±»æ˜¯åŠ¨æ€ç”Ÿæˆçš„ã€‚è¿™æ ·çœ‹èµ·æ¥å°±æ¯”è¾ƒæ¸…æ™°æ˜äº†äº†ã€‚ä¸‹é¢å†æ¥çœ‹çœ‹jdkçš„proxyã€‚</p>
<h3 id="JdkProxyFactory"><a href="#JdkProxyFactory" class="headerlink" title="JdkProxyFactory"></a>JdkProxyFactory</h3><p>ç›¸å…³ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkProxyFactory</span> <span class="keyword">extends</span> <span class="title">AbstractProxyFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[] interfaces)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), interfaces, <span class="keyword">new</span> InvokerInvocationHandler(invoker));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">getInvoker</span><span class="params">(T proxy, Class&lt;T&gt; type, URL url)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AbstractProxyInvoker&lt;T&gt;(proxy, type, url) &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> Object <span class="title">doInvoke</span><span class="params">(T proxy, String methodName, </span><br><span class="line">                                      Class&lt;?&gt;[] parameterTypes, </span><br><span class="line">                                      Object[] arguments)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                Method method = proxy.getClass().getMethod(methodName, parameterTypes);</span><br><span class="line">                <span class="keyword">return</span> method.invoke(proxy, arguments);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>Proxy.newProxyInstance</code>ç›´æ¥ä½¿ç”¨çš„æ˜¯JDKçš„åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå› æ­¤å°±ä¸å†è·Ÿä¸‹å»äº†ã€‚</p>
<h2 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡³æ­¤ï¼Œå¯¹dubboæœ¬åœ°åŠ¨æ€ä»£ç†æœ‰ä¸€ä¸ªæ¸…æ™°çš„ç†è§£äº†ï¼Œæ€»çš„æ¥è¯´ä¸€è·¯é¡ºè—¤æ‘¸ç“œè¿˜ç®—é¡ºç•…ã€‚å¯¹äºé€‰æ‹©å“ªä¸€ä¸­æ–¹å¼ä½œä¸ºç”Ÿäº§ä½¿ç”¨ï¼ŒDubboæ¨èä½¿ç”¨Javassistçš„ä»£ç†æœºåˆ¶ï¼Œå› ä¸ºjdkåŸç”Ÿçš„åŠ¨æ€ä»£ç†æ€§èƒ½è¾ƒå·®ï¼Œç”Ÿäº§ç¯å¢ƒä¸å®œä½¿ç”¨ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Dubbo_u5B66_u4E60-_u7406_u89E3_u52A8_u6001_u4EE3_u7406&quot;&gt;&lt;a href=&quot;#Dubbo_u5B66_u4E60-_u7406_u89E3_u52A8_u6001_u4EE3_u7406&quot; class=&quot;headerlink&quot; title=&quot;Dubboå­¦ä¹ -ç†è§£åŠ¨æ€ä»£ç†&quot;&gt;&lt;/a&gt;Dubboå­¦ä¹ -ç†è§£åŠ¨æ€ä»£ç†&lt;/h1&gt;&lt;p&gt;åœ¨ä¹‹å‰çš„ä¸€ç¯‡postä¸­äº†è§£äº†&lt;a href=&quot;http://daveztong.github.io/2016/11/01/Spring%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84XML%E9%85%8D%E7%BD%AE/&quot;&gt;springå¯æ‰©å±•çš„XMLé…ç½®&lt;/a&gt;æ˜¯æ€ä¹ˆä¸€ä¼šäº‹ï¼Œæ¥ä¸‹æ¥ç»§ç»­ç ”ç©¶dubbo consumerç«¯å¦‚ä½•è§£æserviceå¹¶æ‰§è¡Œè¿œç¨‹è°ƒç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&quot;u672C_u6B21_u7814_u7A76_u76EE_u6807&quot;&gt;&lt;a href=&quot;#u672C_u6B21_u7814_u7A76_u76EE_u6807&quot; class=&quot;headerlink&quot; title=&quot;æœ¬æ¬¡ç ”ç©¶ç›®æ ‡&quot;&gt;&lt;/a&gt;æœ¬æ¬¡ç ”ç©¶ç›®æ ‡&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ä»£ç†å¦‚ä½•åˆ›å»ºçš„ã€‚ä»…ä»…åªæ˜¯é…ç½®äº†&lt;code&gt;&amp;lt;dubbo:reference interface=&amp;quot;x.y.z.ServiceInterface&amp;quot; id=&amp;quot;serviceId&amp;quot;/&amp;gt;&lt;/code&gt;å¹¶å°†å…¶äº¤ç»™äº†spring containerï¼Œç„¶åç›´æ¥æ³¨å…¥å¹¶ä½¿ç”¨è¯¥æ¥å£çš„æ–¹æ³•å°±å¯ä»¥å®Œæˆè°ƒç”¨äº†ï¼Œç„¶è€Œæˆ‘å¹¶æ²¡æœ‰ä¸ºè¯¥æ¥å£å®ç°å…·ä½“çš„ç±»ï¼Œhow does it works? &lt;/li&gt;
&lt;li&gt;&lt;del&gt;è¿œç¨‹è°ƒç”¨å¦‚ä½•æ‰§è¡Œçš„ã€‚å‡è®¾å·²ç»æœ‰äº†å…·ä½“çš„å®ç°ç±»ï¼Œæ€ä¹ˆå®ç°è¿œç¨‹è°ƒç”¨çš„å‘¢ï¼ŒThingking?&lt;/del&gt; ç”±äºç¬¬ä¸€ä¸ªåˆ†æå°±å¾ˆé•¿ï¼Œè¿™ä¸ªç›®æ ‡åˆ—å…¥ä¸‹ä¸€æ¬¡åˆ†æã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="dubbo" scheme="http://yoursite.com/categories/dubbo/"/>
    
    
      <category term="dubbo" scheme="http://yoursite.com/tags/dubbo/"/>
    
      <category term="javassist" scheme="http://yoursite.com/tags/javassist/"/>
    
      <category term="proxy" scheme="http://yoursite.com/tags/proxy/"/>
    
  </entry>
  
  <entry>
    <title>Springå¯æ‰©å±•çš„XMLé…ç½®</title>
    <link href="http://yoursite.com/2016/11/01/Spring%E5%8F%AF%E6%89%A9%E5%B1%95%E7%9A%84XML%E9%85%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2016/11/01/Springå¯æ‰©å±•çš„XMLé…ç½®/</id>
    <published>2016-11-01T03:58:34.000Z</published>
    <updated>2016-11-24T10:19:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Spring__u53EF_u6269_u5C55_u7684XML_u914D_u7F6E"><a href="#Spring__u53EF_u6269_u5C55_u7684XML_u914D_u7F6E" class="headerlink" title="Spring å¯æ‰©å±•çš„XMLé…ç½®"></a>Spring å¯æ‰©å±•çš„XMLé…ç½®</h1><p>Spring è‡ªä»2.0å¼€å§‹å°±ä¸ºåŸºç¡€çš„xmlæ ¼å¼æä¾›äº†ä¸€ä¸ªåŸºäºxml schemaçš„æ‰©å±•æœºåˆ¶ï¼Œç”¨äºå®šä¹‰å’Œé…ç½®beansã€‚æœ¬æ–‡åŸºäºæ­¤ç®€å•è®²è§£å¦‚æœå®šä¹‰è‡ªå·±çš„<code>BeanDefinitionParser</code>å’Œå¦‚ä½•å°†å®šä¹‰å¥½çš„<code>parsers</code>é›†æˆåˆ°<code>Spring IoC container</code>ä¸­ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªxmlé…ç½®æ‰©å±•å¯ä»¥é€šè¿‡ä»¥ä¸‹4æ­¥å®Œæˆï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªxml schemaæ¥æè¿°ä½ è‡ªå®šçš„xmlå…ƒç´ ã€‚</li>
<li>ç¼–å†™ä¸€ä¸ª<code>NamespaceHandler</code>çš„å…·ä½“å®ç°ã€‚</li>
<li>ç¼–å†™ä¸€ä¸ªæˆ–è€…å¤šä¸ª<code>BeanDefinitionParser</code>çš„å®ç°ã€‚ä¸»è¦çš„å·¥ä½œéƒ½åœ¨æ­¤æ­¥éª¤å®Œæˆã€‚</li>
<li>å…³è”<code>xsd</code>,<code>NamespaceHandler</code>ã€‚</li>
</ol>
<p>ä¸‹é¢ä¾ç…§ä»¥ä¸Šå››ä¸ªæ­¥éª¤å¹¶é™„ä¸€ä¸ªç¤ºä¾‹è¯¦ç»†è®²è§£ã€‚å®Œæ•´ä»£ç æ”¾åœ¨ç äº‘ä¸Š:<a href="https://git.oschina.net/android-speeder/springcustomxml.git" target="_blank" rel="external">https://git.oschina.net/android-speeder/springcustomxml.git</a></p>
<a id="more"></a>
<h2 id="u521B_u5EFAschema_u6587_u4EF6"><a href="#u521B_u5EFAschema_u6587_u4EF6" class="headerlink" title="åˆ›å»ºschemaæ–‡ä»¶"></a>åˆ›å»ºschemaæ–‡ä»¶</h2><p>åˆ›å»ºä¸€ä¸ªspringå¯ä»¥ç”¨çš„xmlé…ç½®æ‰©å±•é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªxml schemaæ¥æè¿°è¿™ä¸ªæ‰©å±•ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">xsd:schema</span> <span class="attribute">xmlns</span>=<span class="value">"http://daveztong.github.io/schema/dz"</span></span><br><span class="line">            <span class="attribute">xmlns:xsd</span>=<span class="value">"http://www.w3.org/2001/XMLSchema"</span></span><br><span class="line">            <span class="attribute">xmlns:beans</span>=<span class="value">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">            <span class="attribute">targetNamespace</span>=<span class="value">"http://daveztong.github.io/schema/dz"</span></span><br><span class="line">            <span class="attribute">elementFormDefault</span>=<span class="value">"qualified"</span></span><br><span class="line">            <span class="attribute">attributeFormDefault</span>=<span class="value">"unqualified"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">xsd:import</span> <span class="attribute">namespace</span>=<span class="value">"http://www.springframework.org/schema/beans"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">xsd:element</span> <span class="attribute">name</span>=<span class="value">"person"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">xsd:complexType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">xsd:complexContent</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">xsd:extension</span> <span class="attribute">base</span>=<span class="value">"beans:identifiedType"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">xsd:attribute</span> <span class="attribute">name</span>=<span class="value">"name"</span> <span class="attribute">type</span>=<span class="value">"xsd:string"</span> <span class="attribute">use</span>=<span class="value">"required"</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">xsd:attribute</span> <span class="attribute">name</span>=<span class="value">"age"</span> <span class="attribute">type</span>=<span class="value">"xsd:int"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="title">xsd:extension</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">xsd:complexContent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">xsd:complexType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">xsd:element</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">xsd:schema</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„<code>&lt;xsd:extension base=&quot;beans:identifiedType&quot;&gt;</code>è¡¨ç¤ºè¯¥tagå«æœ‰ä¸€ä¸ªidå±æ€§å¹¶ä¸”ä¼šè¢«spring containerç”¨äºè¯†åˆ«è¯¥beanã€‚ä½¿ç”¨è¯¥å±æ€§çš„å‰ææ˜¯éœ€è¦å¯¼å…¥<code>&lt;xsd:import namespace=&quot;http://www.springframework.org/schema/beans&quot;/&gt;</code>ã€‚</p>
<h2 id="u5B9E_u73B0NamespaceHandler"><a href="#u5B9E_u73B0NamespaceHandler" class="headerlink" title="å®ç°NamespaceHandler"></a>å®ç°NamespaceHandler</h2><p>å½“springåœ¨è§£æxmlæ—¶é‡åˆ°è¯¥namespaceå°±éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„<code>Namespacehandler</code>å»è§£ææ‰€æœ‰è¯¥åç§°ç©ºé—´ä¸‹çš„å…ƒç´ ã€‚</p>
<p><code>NamespaceHandler</code>åªåŒ…å«ä¸‰ä¸ªæ–¹æ³•:</p>
<ul>
<li><code>init()</code>: ç”¨äºåˆå§‹åŒ–<code>NamespaceHandler</code>ã€‚</li>
<li><code>BeanDefinition parse(Element, ParserContext)</code>ï¼šå½“springé‡åˆ°é¡¶çº§çš„å…ƒç´ æ—¶æ‰ä¼šè°ƒç”¨ã€‚è¯¥æ–¹æ³•å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªbean definitionæˆ–è€…è‡ªå·±æ³¨å†Œä¸€ä¸ªã€‚</li>
<li><code>BeanDefinitionHolder decorate(Node, BeanDefinitionHolder, ParserContext)</code>:å½“springé‡åˆ°å±æ€§å®šä¹‰æˆ–è€…åµŒå¥—åœ¨ä¸åŒåç§°ç©ºé—´ä¸‹çš„å…ƒç´ æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°<code>NamespaceHandler</code>,ä½†æ˜¯åŸºäºspringçš„æƒ¯ä¾‹ï¼Œä¸€èˆ¬éƒ½ä¼šæä¾›ä¸€ä¸ªåŸºç¡€ç±»ç®€åŒ–å¼€å‘äººå‘˜çš„å·¥ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç»§æ‰¿springæä¾›çš„<code>NamespaceHandlerSupport</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.daveztong;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.NamespaceHandlerSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by tangwei on 2016/10/31.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DZNamespaceHandler</span> <span class="keyword">extends</span> <span class="title">NamespaceHandlerSupport</span></span>&#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"person"</span>,<span class="keyword">new</span> PersonBeanDefinitionParser());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>DZNamespaceHandler</code>çš„ä»£ç é‡å¾ˆå°‘ï¼Œå› ä¸ºçœŸæ­£çš„è§£æå·¥ä½œéƒ½å§”æ‰˜ç»™äº†<code>BeanDefinitionParser</code>ã€‚    <code>NamespaceHandler</code>æ”¯æŒæ³¨å†Œä»»æ„å¤šä¸ª<code>BeanDefinitionParser</code>,å½“å…¶éœ€è¦è§£æå…¶æ‰€è´Ÿè´£çš„åç§°ç©ºé—´ä¸‹çš„å…ƒç´ æ—¶å°±ä¼šå°†è§£æå·¥ä½œå§”æ‰˜ç»™æ³¨å†Œçš„<code>BeanDefinitionParser</code>ã€‚</p>
<h2 id="u5B9E_u73B0BeanDefinitionParser"><a href="#u5B9E_u73B0BeanDefinitionParser" class="headerlink" title="å®ç°BeanDefinitionParser"></a>å®ç°<code>BeanDefinitionParser</code></h2><p>å½“<code>NamespaceHandler</code>é‡åˆ°ä¸€ä¸ªä¸æ³¨å†Œåˆ—è¡¨ä¸­keyåŒ¹é…çš„xmlå…ƒç´ æ—¶å°±ä¼šå°†è¯¥å…ƒç´ çš„è§£æä»»åŠ¡äº¤ç»™ä¸keyå¯¹åº”çš„<code>BeanDefinitionParser</code>ã€‚åœ¨æœ¬ä¾‹ä¸­åˆ™æ˜¯<code>PersonBeanDefinitionParser</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª<code>BeanDefinitionParser</code>ä»…è´Ÿè´£è§£æå®šä¹‰åœ¨æŒ‡å®šschemaä¸­çš„ä¸€ä¸ªå”¯ä¸€é¡¶çº§çš„xmlå…ƒç´ ã€‚åœ¨parserä¸­æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°å…¶è´Ÿè´£è§£æçš„å…ƒç´ å’Œå­å…ƒç´ çš„å†…å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.daveztong;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.Element;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by tangwei on 2016/10/31.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonBeanDefinitionParser</span> <span class="keyword">extends</span> <span class="title">AbstractSingleBeanDefinitionParser</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; getBeanClass(Element element) &#123;</span><br><span class="line">        <span class="keyword">return</span> Person.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doParse</span><span class="params">(Element element, BeanDefinitionBuilder builder)</span> </span>&#123;</span><br><span class="line">        String name = element.getAttribute(<span class="string">"name"</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(name)) &#123;</span><br><span class="line">            builder.addPropertyValue(<span class="string">"name"</span>, name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String age = element.getAttribute(<span class="string">"age"</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(age)) &#123;</span><br><span class="line">            builder.addPropertyValue(<span class="string">"age"</span>, Integer.parseInt(age));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–ç éƒ¨åˆ†å°±è¿™ä¹ˆå¤šï¼Œæ˜¯ä¸æ˜¯so easy! å¯èƒ½æœ‰äººä¼šç–‘é—®ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ°<code>BeanDefiniiton</code>çš„åˆ›å»ºï¼Œé‚£æ˜¯å› ä¸ºåˆ›å»ºçš„å·¥ä½œç”±<code>AbstractSingleBeanDefinitionParser#parseInternal</code>å®Œæˆäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> AbstractBeanDefinition <span class="title">parseInternal</span><span class="params">(Element element, ParserContext parserContext)</span> </span>&#123;</span><br><span class="line">		BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition();</span><br><span class="line">		String parentName = getParentName(element);</span><br><span class="line">		<span class="keyword">if</span> (parentName != <span class="keyword">null</span>) &#123;</span><br><span class="line">			builder.getRawBeanDefinition().setParentName(parentName);</span><br><span class="line">		&#125;</span><br><span class="line">		Class&lt;?&gt; beanClass = getBeanClass(element);</span><br><span class="line">		<span class="keyword">if</span> (beanClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">			builder.getRawBeanDefinition().setBeanClass(beanClass);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			String beanClassName = getBeanClassName(element);</span><br><span class="line">			<span class="keyword">if</span> (beanClassName != <span class="keyword">null</span>) &#123;</span><br><span class="line">				builder.getRawBeanDefinition().setBeanClassName(beanClassName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		builder.getRawBeanDefinition().setSource(parserContext.extractSource(element));</span><br><span class="line">		<span class="keyword">if</span> (parserContext.isNested()) &#123;</span><br><span class="line">			<span class="comment">// Inner bean definition must receive same scope as containing bean.</span></span><br><span class="line">			builder.setScope(parserContext.getContainingBeanDefinition().getScope());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (parserContext.isDefaultLazyInit()) &#123;</span><br><span class="line">			<span class="comment">// Default-lazy-init applies to custom bean definitions as well.</span></span><br><span class="line">			builder.setLazyInit(<span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		doParse(element, parserContext, builder);</span><br><span class="line">		<span class="keyword">return</span> builder.getBeanDefinition();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>The last statement <code>builder.getBeanDefinition();</code>è¿”å›äº†æˆ‘ä»¬éœ€è¦çš„bean. ç»§ç»­çœ‹builder.getBeanDefinition()çš„ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> AbstractBeanDefinition <span class="title">getBeanDefinition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.beanDefinition.validate();</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.beanDefinition;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>Thatâ€™s our bean!</p>
<p>ç¼–ç éƒ¨åˆ†æ˜¯å®Œæˆäº†ï¼Œä½†æ˜¯springè¿˜ä¸çŸ¥é“ä»–ä»¬çš„å­˜åœ¨ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦è®©spring aware of them!(awareæ˜¯ä¸ªå¾ˆå…³é”®çš„è¯å•Šï¼Œåœ¨springçš„ä»£ç é‡Œéšå¤„å¯è§^_^)</p>
<h2 id="u6CE8_u518Chandler_and_schema"><a href="#u6CE8_u518Chandler_and_schema" class="headerlink" title="æ³¨å†Œhandler and schema"></a>æ³¨å†Œhandler and schema</h2><p>è¦è®©spring aware of out handler and xsd schema,æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªç‰¹æ®Šçš„propertiesæ–‡ä»¶ä¸­æ³¨å†Œä»–ä»¬ã€‚è¿™äº›propertiesæ–‡ä»¶éœ€è¦æ”¾åœ¨<code>META-INF</code>ç›®å½•ä¸‹é¢,å¹¶ä¸”å¯ä»¥å’ŒjaråŒ…ä¸€èµ·å‘å¸ƒã€‚springçš„è§£ææ¡†æ¶é€šè¿‡è¿™äº›ç‰¹æ®Šçš„propertiesæ–‡ä»¶å°±èƒ½pick up our handler and schema!</p>
<h3 id="META-INF/spring-handlers"><a href="#META-INF/spring-handlers" class="headerlink" title="META-INF/spring.handlers"></a>META-INF/spring.handlers</h3><p><code>spring.handlers</code>åŒ…å«äº† xml schema uri å’Œnamespace handlerä¹‹é—´çš„k-væ˜ å°„å…³ç³»ï¼Œå¦‚ä¸‹:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http\://daveztong.github.io/schema/dz=io.github.daveztong.DZNamespaceHandler</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œå› ä¸º<code>:</code>åœ¨propertiesæ–‡ä»¶ä¸­æ˜¯ä¸ªåˆæ³•çš„åˆ†éš”ç¬¦ï¼Œæ‰€ä»¥éœ€è¦escapeä»¥ä¸‹ï¼</p>
<p>å…¶ä¸­URIéƒ¨åˆ†æ˜¯è‡ªå®šä¹‰çš„namespaceæ‰©å±•ï¼Œå¿…é¡»ä¸xsdä¸­çš„<code>targetNamespace</code>å®Œå…¨åŒ¹é…ã€‚</p>
<h3 id="META-INF/spring-schemas"><a href="#META-INF/spring-schemas" class="headerlink" title="META-INF/spring.schemas"></a>META-INF/spring.schemas</h3><p><code>spring.schemas</code>ä¸­åŒ…å«äº†xml schema uri(å¯¹åº”<code>xsi:schemaLocation</code>çš„å€¼)ä¸classpath resourcesçš„æ˜ å°„å…³ç³»ã€‚å¦‚æœè¿™ä¸ªæ–‡ä»¶ä¸å­˜åœ¨ï¼Œspringé»˜è®¤ä¼šä»ç½‘ä¸ŠåŠ è½½<code>xsi:schemaLocation</code>ä¸­æ‰€å®šä¹‰çš„schemaã€‚æœ‰ä¸ªè¿™ä¸ªæ˜ å°„æ–‡ä»¶ï¼Œspringå°±ä¼šä»classpathä¸­åŠ è½½è€Œä¸å†è”ç½‘æŸ¥æ‰¾ã€‚</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http\://daveztong.github.io/schema/dz/dz.xsd=io/github/daveztong/schema/dz/dz.xsd</span><br></pre></td></tr></table></figure>
<h2 id="Now_2Ctime_to_test"><a href="#Now_2Ctime_to_test" class="headerlink" title="Now,time to test"></a>Now,time to test</h2><p>ä½¿ç”¨xmlå®šä¹‰person bean: spring-beans.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">beans</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       <span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       <span class="attribute">xmlns:dz</span>=<span class="value">"http://daveztong.github.io/schema/dz"</span></span><br><span class="line">       <span class="attribute">xsi:schemaLocation</span>=<span class="value">"</span><br><span class="line">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">http://daveztong.github.io/schema/dz http://daveztong.github.io/schema/dz/dz.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- as a top-level bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">dz:person</span> <span class="attribute">age</span>=<span class="value">"22"</span> <span class="attribute">id</span>=<span class="value">"person"</span> <span class="attribute">name</span>=<span class="value">"tangwei"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æ¼”ç¤ºæ•ˆæœï¼Œè¿™é‡Œä½¿ç”¨spring bootæ¥å¿«é€Ÿæµ‹è¯•: <code>App.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.daveztong;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ImportResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by tangwei on 2016/11/1.</span><br><span class="line"> */</span></span><br><span class="line"><span class="annotation">@EnableAutoConfiguration</span></span><br><span class="line"><span class="annotation">@Controller</span></span><br><span class="line"><span class="annotation">@ImportResource</span>(<span class="string">"classpath:spring-beans.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(App.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line">    <span class="annotation">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showPerson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> person.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è®¿é—®<a href="http://localhost:8080/" target="_blank" rel="external">http://localhost:8080/</a> ,dada:</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person&#123;age=<span class="number">22</span>, name=<span class="string">'tangwei'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œåˆ°åº•è°åœ¨ç”¨è¿™ä¸ªï¼Œèƒ½å¹²å•¥å‘¢ï¼</p>
<h2 id="Dubbo_xml__u914D_u7F6E_u6269_u5C55"><a href="#Dubbo_xml__u914D_u7F6E_u6269_u5C55" class="headerlink" title="Dubbo xml é…ç½®æ‰©å±•"></a>Dubbo xml é…ç½®æ‰©å±•</h2><p>Dubbo åœ¨å›½å†…å¼€æºRPCç•Œç®—æ˜¯æ¯”è¾ƒçŸ¥åçš„ï¼Œå¥¹å…¶å®é‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼è§£æè‡ªå®šä¹‰çš„é…ç½®ã€‚dubbo jar åŒ…ç»“æ„:</p>
<p><img src="http://ww4.sinaimg.cn/large/94dc19degw1f9cgo55oetj209q06hmxg.jpg" alt="dubbo jar structure"></p>
<p>spring.handlers:</p>
<p><code>http\://code.alibabatech.com/schema/dubbo=com.alibaba.dubbo.config.spring.schema.DubboNamespaceHandler</code></p>
<p>spring.schemas:</p>
<p><code>http\://code.alibabatech.com/schema/dubbo/dubbo.xsd=META-INF/dubbo.xsd</code></p>
<p>NamespaceHandlerå®ç°ä¸º:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboNamespaceHandler</span> <span class="keyword">extends</span> <span class="title">NamespaceHandlerSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		Version.checkDuplicate(DubboNamespaceHandler.class);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	    registerBeanDefinitionParser(<span class="string">"application"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ApplicationConfig.class, <span class="keyword">true</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"module"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ModuleConfig.class, <span class="keyword">true</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"registry"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(RegistryConfig.class, <span class="keyword">true</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"monitor"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(MonitorConfig.class, <span class="keyword">true</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"provider"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ProviderConfig.class, <span class="keyword">true</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"consumer"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ConsumerConfig.class, <span class="keyword">true</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"protocol"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ProtocolConfig.class, <span class="keyword">true</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"service"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ServiceBean.class, <span class="keyword">true</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"reference"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ReferenceBean.class, <span class="keyword">false</span>));</span><br><span class="line">        registerBeanDefinitionParser(<span class="string">"annotation"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(AnnotationBean.class, <span class="keyword">true</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥handleræ³¨å†Œäº†æ‰€æœ‰çš„bean definition parser!</p>
<p>äº†è§£è¿™ç§æœºåˆ¶åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦åšä»»ä½•é…ç½®æ‰©å±•ã€‚So cool!</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Spring__u53EF_u6269_u5C55_u7684XML_u914D_u7F6E&quot;&gt;&lt;a href=&quot;#Spring__u53EF_u6269_u5C55_u7684XML_u914D_u7F6E&quot; class=&quot;headerlink&quot; title=&quot;Spring å¯æ‰©å±•çš„XMLé…ç½®&quot;&gt;&lt;/a&gt;Spring å¯æ‰©å±•çš„XMLé…ç½®&lt;/h1&gt;&lt;p&gt;Spring è‡ªä»2.0å¼€å§‹å°±ä¸ºåŸºç¡€çš„xmlæ ¼å¼æä¾›äº†ä¸€ä¸ªåŸºäºxml schemaçš„æ‰©å±•æœºåˆ¶ï¼Œç”¨äºå®šä¹‰å’Œé…ç½®beansã€‚æœ¬æ–‡åŸºäºæ­¤ç®€å•è®²è§£å¦‚æœå®šä¹‰è‡ªå·±çš„&lt;code&gt;BeanDefinitionParser&lt;/code&gt;å’Œå¦‚ä½•å°†å®šä¹‰å¥½çš„&lt;code&gt;parsers&lt;/code&gt;é›†æˆåˆ°&lt;code&gt;Spring IoC container&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªxmlé…ç½®æ‰©å±•å¯ä»¥é€šè¿‡ä»¥ä¸‹4æ­¥å®Œæˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªxml schemaæ¥æè¿°ä½ è‡ªå®šçš„xmlå…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;ç¼–å†™ä¸€ä¸ª&lt;code&gt;NamespaceHandler&lt;/code&gt;çš„å…·ä½“å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;ç¼–å†™ä¸€ä¸ªæˆ–è€…å¤šä¸ª&lt;code&gt;BeanDefinitionParser&lt;/code&gt;çš„å®ç°ã€‚ä¸»è¦çš„å·¥ä½œéƒ½åœ¨æ­¤æ­¥éª¤å®Œæˆã€‚&lt;/li&gt;
&lt;li&gt;å…³è”&lt;code&gt;xsd&lt;/code&gt;,&lt;code&gt;NamespaceHandler&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢ä¾ç…§ä»¥ä¸Šå››ä¸ªæ­¥éª¤å¹¶é™„ä¸€ä¸ªç¤ºä¾‹è¯¦ç»†è®²è§£ã€‚å®Œæ•´ä»£ç æ”¾åœ¨ç äº‘ä¸Š:&lt;a href=&quot;https://git.oschina.net/android-speeder/springcustomxml.git&quot;&gt;https://git.oschina.net/android-speeder/springcustomxml.git&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="dubbo" scheme="http://yoursite.com/tags/dubbo/"/>
    
  </entry>
  
  <entry>
    <title>bootcamp</title>
    <link href="http://yoursite.com/2016/07/18/bootcamp/"/>
    <id>http://yoursite.com/2016/07/18/bootcamp/</id>
    <published>2016-07-18T10:03:48.000Z</published>
    <updated>2016-11-24T10:19:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="mysql_index_and_best_practice_handout"><a href="#mysql_index_and_best_practice_handout" class="headerlink" title="mysql index and best practice handout"></a>mysql index and best practice handout</h1><p>è®²è®²MySQLçš„æœ€ä½³å®è·µå’Œå®¹æ˜“è¸©åˆ°çš„å‘ã€‚</p>
<a id="more"></a>
<h2 id="syntax"><a href="#syntax" class="headerlink" title="syntax"></a>syntax</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> [<span class="keyword">TEMPORARY</span>] <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] tbl_name</span><br><span class="line">    (create_definition,...)</span><br><span class="line">    [table_options]</span><br><span class="line">    [partition_options]</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">TEMPORARY</span>] <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] tbl_name</span><br><span class="line">    [(create_definition,...)]</span><br><span class="line">    [table_options]</span><br><span class="line">    [partition_options]</span><br><span class="line">    [<span class="keyword">IGNORE</span> | <span class="keyword">REPLACE</span>]</span><br><span class="line">    [<span class="keyword">AS</span>] query_expression</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">TEMPORARY</span>] <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] tbl_name</span><br><span class="line">    &#123; <span class="keyword">LIKE</span> old_tbl_name | (<span class="keyword">LIKE</span> old_tbl_name) &#125;</span><br><span class="line"></span><br><span class="line">create_definition:</span><br><span class="line">    col_name column_definition</span><br><span class="line">  | [<span class="keyword">CONSTRAINT</span> [symbol]] PRIMARY <span class="keyword">KEY</span> [index_type] (index_col_name,...)</span><br><span class="line">      [index_option] ...</span><br><span class="line">  | &#123;<span class="keyword">INDEX</span>|<span class="keyword">KEY</span>&#125; [index_name] [index_type] (index_col_name,...)</span><br><span class="line">      [index_option] ...</span><br><span class="line">  | [<span class="keyword">CONSTRAINT</span> [symbol]] <span class="keyword">UNIQUE</span> [<span class="keyword">INDEX</span>|<span class="keyword">KEY</span>]</span><br><span class="line">      [index_name] [index_type] (index_col_name,...)</span><br><span class="line">      [index_option] ...</span><br><span class="line">  | &#123;FULLTEXT|SPATIAL&#125; [<span class="keyword">INDEX</span>|<span class="keyword">KEY</span>] [index_name] (index_col_name,...)</span><br><span class="line">      [index_option] ...</span><br><span class="line">  | [<span class="keyword">CONSTRAINT</span> [symbol]] FOREIGN <span class="keyword">KEY</span></span><br><span class="line">      [index_name] (index_col_name,...) reference_definition</span><br><span class="line">  | <span class="keyword">CHECK</span> (expr)</span><br><span class="line"></span><br><span class="line">column_definition:</span><br><span class="line">    data_type [<span class="keyword">NOT</span> <span class="literal">NULL</span> | <span class="literal">NULL</span>] [<span class="keyword">DEFAULT</span> default_value]</span><br><span class="line">      [AUTO_INCREMENT] [<span class="keyword">UNIQUE</span> [<span class="keyword">KEY</span>] | [PRIMARY] <span class="keyword">KEY</span>]</span><br><span class="line">      [<span class="keyword">COMMENT</span> <span class="string">'string'</span>]</span><br><span class="line">      [COLUMN_FORMAT &#123;<span class="keyword">FIXED</span>|DYNAMIC|<span class="keyword">DEFAULT</span>&#125;]</span><br><span class="line">      [<span class="keyword">STORAGE</span> &#123;DISK|<span class="keyword">MEMORY</span>|<span class="keyword">DEFAULT</span>&#125;]</span><br><span class="line">      [reference_definition]</span><br><span class="line">  | data_type [<span class="keyword">GENERATED</span> <span class="keyword">ALWAYS</span>] <span class="keyword">AS</span> (expression)</span><br><span class="line">      [<span class="keyword">VIRTUAL</span> | <span class="keyword">STORED</span>] [<span class="keyword">UNIQUE</span> [<span class="keyword">KEY</span>]] [<span class="keyword">COMMENT</span> <span class="keyword">comment</span>]</span><br><span class="line">      [<span class="keyword">NOT</span> <span class="literal">NULL</span> | <span class="literal">NULL</span>] [[PRIMARY] <span class="keyword">KEY</span>]</span><br><span class="line"></span><br><span class="line">data_type:</span><br><span class="line">    <span class="built_in">BIT</span>[(<span class="keyword">length</span>)]</span><br><span class="line">  | TINYINT[(<span class="keyword">length</span>)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">SMALLINT</span>[(<span class="keyword">length</span>)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | MEDIUMINT[(<span class="keyword">length</span>)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">INT</span>[(<span class="keyword">length</span>)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">INTEGER</span>[(<span class="keyword">length</span>)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">BIGINT</span>[(<span class="keyword">length</span>)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">REAL</span>[(<span class="keyword">length</span>,decimals)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="keyword">DOUBLE</span>[(<span class="keyword">length</span>,decimals)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">FLOAT</span>[(<span class="keyword">length</span>,decimals)] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">DECIMAL</span>[(<span class="keyword">length</span>[,decimals])] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">NUMERIC</span>[(<span class="keyword">length</span>[,decimals])] [<span class="keyword">UNSIGNED</span>] [ZEROFILL]</span><br><span class="line">  | <span class="built_in">DATE</span></span><br><span class="line">  | <span class="keyword">TIME</span>[(fsp)]</span><br><span class="line">  | <span class="keyword">TIMESTAMP</span>[(fsp)]</span><br><span class="line">  | DATETIME[(fsp)]</span><br><span class="line">  | <span class="keyword">YEAR</span></span><br><span class="line">  | <span class="built_in">CHAR</span>[(<span class="keyword">length</span>)] [<span class="built_in">BINARY</span>]</span><br><span class="line">      [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name] [<span class="keyword">COLLATE</span> collation_name]</span><br><span class="line">  | <span class="built_in">VARCHAR</span>(<span class="keyword">length</span>) [<span class="built_in">BINARY</span>]</span><br><span class="line">      [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name] [<span class="keyword">COLLATE</span> collation_name]</span><br><span class="line">  | <span class="built_in">BINARY</span>[(<span class="keyword">length</span>)]</span><br><span class="line">  | VARBINARY(<span class="keyword">length</span>)</span><br><span class="line">  | TINYBLOB</span><br><span class="line">  | <span class="built_in">BLOB</span></span><br><span class="line">  | MEDIUMBLOB</span><br><span class="line">  | LONGBLOB</span><br><span class="line">  | TINYTEXT [<span class="built_in">BINARY</span>]</span><br><span class="line">      [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name] [<span class="keyword">COLLATE</span> collation_name]</span><br><span class="line">  | <span class="built_in">TEXT</span> [<span class="built_in">BINARY</span>]</span><br><span class="line">      [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name] [<span class="keyword">COLLATE</span> collation_name]</span><br><span class="line">  | MEDIUMTEXT [<span class="built_in">BINARY</span>]</span><br><span class="line">      [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name] [<span class="keyword">COLLATE</span> collation_name]</span><br><span class="line">  | LONGTEXT [<span class="built_in">BINARY</span>]</span><br><span class="line">      [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name] [<span class="keyword">COLLATE</span> collation_name]</span><br><span class="line">  | ENUM(value1,value2,value3,...)</span><br><span class="line">      [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name] [<span class="keyword">COLLATE</span> collation_name]</span><br><span class="line">  | <span class="keyword">SET</span>(value1,value2,value3,...)</span><br><span class="line">      [<span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name] [<span class="keyword">COLLATE</span> collation_name]</span><br><span class="line">  | <span class="keyword">JSON</span></span><br><span class="line">  | spatial_type</span><br><span class="line"></span><br><span class="line">index_col_name:</span><br><span class="line">    col_name [(<span class="keyword">length</span>)] [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>]</span><br><span class="line"></span><br><span class="line">index_type:</span><br><span class="line">    <span class="keyword">USING</span> &#123;BTREE | <span class="keyword">HASH</span>&#125;</span><br><span class="line"></span><br><span class="line">index_option:</span><br><span class="line">    KEY_BLOCK_SIZE [=] <span class="keyword">value</span></span><br><span class="line">  | index_type</span><br><span class="line">  | <span class="keyword">WITH</span> PARSER parser_name</span><br><span class="line">  | <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br><span class="line"></span><br><span class="line">reference_definition:</span><br><span class="line">    <span class="keyword">REFERENCES</span> tbl_name (index_col_name,...)</span><br><span class="line">      [<span class="keyword">MATCH</span> <span class="keyword">FULL</span> | <span class="keyword">MATCH</span> <span class="keyword">PARTIAL</span> | <span class="keyword">MATCH</span> SIMPLE]</span><br><span class="line">      [<span class="keyword">ON</span> <span class="keyword">DELETE</span> reference_option]</span><br><span class="line">      [<span class="keyword">ON</span> <span class="keyword">UPDATE</span> reference_option]</span><br><span class="line"></span><br><span class="line">reference_option:</span><br><span class="line">    RESTRICT | <span class="keyword">CASCADE</span> | <span class="keyword">SET</span> <span class="literal">NULL</span> | <span class="keyword">NO</span> <span class="keyword">ACTION</span></span><br><span class="line"></span><br><span class="line">table_options:</span><br><span class="line">    table_option [[,] table_option] ...</span><br><span class="line"></span><br><span class="line">table_option:</span><br><span class="line">    <span class="keyword">ENGINE</span> [=] engine_name</span><br><span class="line">  | AUTO_INCREMENT [=] <span class="keyword">value</span></span><br><span class="line">  | AVG_ROW_LENGTH [=] <span class="keyword">value</span></span><br><span class="line">  | [<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> [=] charset_name</span><br><span class="line">  | <span class="keyword">CHECKSUM</span> [=] &#123;<span class="number">0</span> | <span class="number">1</span>&#125;</span><br><span class="line">  | [<span class="keyword">DEFAULT</span>] <span class="keyword">COLLATE</span> [=] collation_name</span><br><span class="line">  | <span class="keyword">COMMENT</span> [=] <span class="string">'string'</span></span><br><span class="line">  | COMPRESSION [=] &#123;<span class="string">'ZLIB'</span>|<span class="string">'LZ4'</span>|<span class="string">'NONE'</span>&#125;</span><br><span class="line">  | <span class="keyword">CONNECTION</span> [=] <span class="string">'connect_string'</span></span><br><span class="line">  | <span class="keyword">DATA</span> <span class="keyword">DIRECTORY</span> [=] <span class="string">'absolute path to directory'</span></span><br><span class="line">  | DELAY_KEY_WRITE [=] &#123;<span class="number">0</span> | <span class="number">1</span>&#125;</span><br><span class="line">  | ENCRYPTION [=] &#123;<span class="string">'Y'</span> | <span class="string">'N'</span>&#125;</span><br><span class="line">  | <span class="keyword">INDEX</span> <span class="keyword">DIRECTORY</span> [=] <span class="string">'absolute path to directory'</span></span><br><span class="line">  | INSERT_METHOD [=] &#123; <span class="keyword">NO</span> | <span class="keyword">FIRST</span> | <span class="keyword">LAST</span> &#125;</span><br><span class="line">  | KEY_BLOCK_SIZE [=] <span class="keyword">value</span></span><br><span class="line">  | MAX_ROWS [=] <span class="keyword">value</span></span><br><span class="line">  | MIN_ROWS [=] <span class="keyword">value</span></span><br><span class="line">  | PACK_KEYS [=] &#123;<span class="number">0</span> | <span class="number">1</span> | <span class="keyword">DEFAULT</span>&#125;</span><br><span class="line">  | <span class="keyword">PASSWORD</span> [=] <span class="string">'string'</span></span><br><span class="line">  | ROW_FORMAT [=] &#123;<span class="keyword">DEFAULT</span>|DYNAMIC|<span class="keyword">FIXED</span>|COMPRESSED|REDUNDANT|<span class="keyword">COMPACT</span>&#125;</span><br><span class="line">  | STATS_AUTO_RECALC [=] &#123;<span class="keyword">DEFAULT</span>|<span class="number">0</span>|<span class="number">1</span>&#125;</span><br><span class="line">  | STATS_PERSISTENT [=] &#123;<span class="keyword">DEFAULT</span>|<span class="number">0</span>|<span class="number">1</span>&#125;</span><br><span class="line">  | STATS_SAMPLE_PAGES [=] <span class="keyword">value</span></span><br><span class="line">  | <span class="keyword">TABLESPACE</span> tablespace_name</span><br><span class="line">  | <span class="keyword">UNION</span> [=] (tbl_name[,tbl_name]...)</span><br><span class="line"></span><br><span class="line">partition_options:</span><br><span class="line">    <span class="keyword">PARTITION</span> <span class="keyword">BY</span></span><br><span class="line">        &#123; [LINEAR] <span class="keyword">HASH</span>(expr)</span><br><span class="line">        | [LINEAR] <span class="keyword">KEY</span> [ALGORITHM=&#123;<span class="number">1</span>|<span class="number">2</span>&#125;] (column_list)</span><br><span class="line">        | <span class="keyword">RANGE</span>&#123;(expr) | <span class="keyword">COLUMNS</span>(column_list)&#125;</span><br><span class="line">        | <span class="keyword">LIST</span>&#123;(expr) | <span class="keyword">COLUMNS</span>(column_list)&#125; &#125;</span><br><span class="line">    [<span class="keyword">PARTITIONS</span> <span class="keyword">num</span>]</span><br><span class="line">    [<span class="keyword">SUBPARTITION</span> <span class="keyword">BY</span></span><br><span class="line">        &#123; [LINEAR] <span class="keyword">HASH</span>(expr)</span><br><span class="line">        | [LINEAR] <span class="keyword">KEY</span> [ALGORITHM=&#123;<span class="number">1</span>|<span class="number">2</span>&#125;] (column_list) &#125;</span><br><span class="line">      [<span class="keyword">SUBPARTITIONS</span> <span class="keyword">num</span>]</span><br><span class="line">    ]</span><br><span class="line">    [(partition_definition [, partition_definition] ...)]</span><br><span class="line"></span><br><span class="line">partition_definition:</span><br><span class="line">    <span class="keyword">PARTITION</span> partition_name</span><br><span class="line">        [<span class="keyword">VALUES</span></span><br><span class="line">            &#123;<span class="keyword">LESS</span> <span class="keyword">THAN</span> &#123;(expr | value_list) | MAXVALUE&#125;</span><br><span class="line">            |</span><br><span class="line">            <span class="keyword">IN</span> (value_list)&#125;]</span><br><span class="line">        [[<span class="keyword">STORAGE</span>] <span class="keyword">ENGINE</span> [=] engine_name]</span><br><span class="line">        [<span class="keyword">COMMENT</span> [=] <span class="string">'comment_text'</span> ]</span><br><span class="line">        [<span class="keyword">DATA</span> <span class="keyword">DIRECTORY</span> [=] <span class="string">'data_dir'</span>]</span><br><span class="line">        [<span class="keyword">INDEX</span> <span class="keyword">DIRECTORY</span> [=] <span class="string">'index_dir'</span>]</span><br><span class="line">        [MAX_ROWS [=] max_number_of_rows]</span><br><span class="line">        [MIN_ROWS [=] min_number_of_rows]</span><br><span class="line">        [<span class="keyword">TABLESPACE</span> [=] tablespace_name]</span><br><span class="line">        [(subpartition_definition [, subpartition_definition] ...)]</span><br><span class="line"></span><br><span class="line">subpartition_definition:</span><br><span class="line">    <span class="keyword">SUBPARTITION</span> logical_name</span><br><span class="line">        [[<span class="keyword">STORAGE</span>] <span class="keyword">ENGINE</span> [=] engine_name]</span><br><span class="line">        [<span class="keyword">COMMENT</span> [=] <span class="string">'comment_text'</span> ]</span><br><span class="line">        [<span class="keyword">DATA</span> <span class="keyword">DIRECTORY</span> [=] <span class="string">'data_dir'</span>]</span><br><span class="line">        [<span class="keyword">INDEX</span> <span class="keyword">DIRECTORY</span> [=] <span class="string">'index_dir'</span>]</span><br><span class="line">        [MAX_ROWS [=] max_number_of_rows]</span><br><span class="line">        [MIN_ROWS [=] min_number_of_rows]</span><br><span class="line">        [<span class="keyword">TABLESPACE</span> [=] tablespace_name]</span><br><span class="line"></span><br><span class="line">query_expression:</span><br><span class="line">    <span class="keyword">SELECT</span> ...   (<span class="keyword">Some</span> valid <span class="keyword">select</span> <span class="keyword">or</span> <span class="keyword">union</span> <span class="keyword">statement</span>)</span></span><br></pre></td></tr></table></figure>
<h2 id="u9009_u62E9_u5408_u9002_u7684_u6570_u636E_u7C7B_u578B"><a href="#u9009_u62E9_u5408_u9002_u7684_u6570_u636E_u7C7B_u578B" class="headerlink" title="é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹"></a>é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹</h2><p>ç‰©å°½å…¶ç”¨ã€‚å¦‚æœå­˜å‚¨ç©ºé—´è¾ƒå°çš„æ•°æ®ç±»å‹èƒ½æ»¡è¶³éœ€æ±‚ï¼Œå°±ä¸è¦ä½¿ç”¨æ›´å¤§çš„ç±»å‹ã€‚</p>
<h3 id="u6574_u6570"><a href="#u6574_u6570" class="headerlink" title="æ•´æ•°"></a>æ•´æ•°</h3><p>TINYINT(8),SMALLINT(16),MEDIUMINT(24),INT(32),BIGINT(64) <unsigned>. å¦‚æœæ˜ç¡®å­˜å‚¨çš„å€¼ä¸ä¸ºè´Ÿæ•°ï¼ŒåŠ ä¸Šunsignedå¯æœ‰æ•ˆæ‰©å¤§å€¼åŸŸèŒƒå›´ã€‚</unsigned></p>
<h3 id="u5B9E_u6570"><a href="#u5B9E_u6570" class="headerlink" title="å®æ•°"></a>å®æ•°</h3><p>è™½ç„¶mysqlæä¾›äº†FLOAT,DOUBLE,DECIMALæ¥å­˜å‚¨å¸¦ç²¾åº¦çš„å°æ•°ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­é€šå¸¸çš„åšæ³•æ˜¯å°†å…¶è½¬æ¢æˆæ•´æ•°å­˜å‚¨ï¼Œé¿å…å‡ºç°å„ç§å› ç²¾åº¦å¯¼è‡´çš„é—®é¢˜ã€‚</p>
<h3 id="u5B57_u7B26_u4E32"><a href="#u5B57_u7B26_u4E32" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><h4 id="varchar"><a href="#varchar" class="headerlink" title="varchar"></a>varchar</h4><p>å¯å˜é•¿ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µã€‚</p>
<h4 id="char"><a href="#char" class="headerlink" title="char"></a>char</h4><p>é€‰æ‹©åˆé€‚çš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚å­˜å‚¨å¯†ç å’Œæ‰‹æœºå·ç­‰ç­‰ã€‚</p>
<h3 id="u65E5_u671F_u548C_u65F6_u95F4"><a href="#u65E5_u671F_u548C_u65F6_u95F4" class="headerlink" title="æ—¥æœŸå’Œæ—¶é—´"></a>æ—¥æœŸå’Œæ—¶é—´</h3><h4 id="datetime"><a href="#datetime" class="headerlink" title="datetime"></a>datetime</h4><p>ä¿å­˜æ—¶é—´èŒƒå›´ä»1001-9999ï¼Œç²¾åº¦ä¸ºç§’ï¼Œæ˜¯mysqlä¸­è¡¨ç¤ºæ—¶é—´èŒƒå›´æœ€å¤§çš„ç±»å‹ï¼Œä¸”ä¸æ—¶åŒºæ— å…³ã€‚ç©ºé—´å ç”¨8å­—èŠ‚ã€‚</p>
<h4 id="timestamp"><a href="#timestamp" class="headerlink" title="timestamp"></a>timestamp</h4><p>unix timestampï¼Œè¡¨ç¤ºä»1970-01-01åˆå¤œå¼€å§‹çš„æ—¶é—´ã€‚å¯è¦†ç›–çš„æœ€å¤§æ—¶é—´ä¸º2038å¹´ï¼Œä¸æ—¶åŒºç›¸å…³ï¼Œå¯æ ¹æ®æ—¶åŒºè‡ªåŠ¨å˜åŒ–ï¼Œç©ºé—´å ç”¨4å­—èŠ‚ã€‚</p>
<p>è¿™ä¸¤ç§æ—¥æœŸæ—¶é—´ç±»å‹éƒ½åªæ”¯æŒç§’çº§åˆ«çš„æ•°æ®ï¼Œå¦‚æœéœ€è¦å­˜å‚¨æ¯«ç§’å¯ä»¥è€ƒè™‘ä½¿ç”¨bigintæ¥å­˜å‚¨ã€‚</p>
<h3 id="u8C28_u614E_u9009_u62E9_u6807_u8BC6_u7B26_u7C7B_u578B"><a href="#u8C28_u614E_u9009_u62E9_u6807_u8BC6_u7B26_u7C7B_u578B" class="headerlink" title="è°¨æ…é€‰æ‹©æ ‡è¯†ç¬¦ç±»å‹"></a>è°¨æ…é€‰æ‹©æ ‡è¯†ç¬¦ç±»å‹</h3><ol>
<li>æ•´æ•°ç±»å‹ã€‚ æ•´æ•°æ˜¯æœ€ç†æƒ³çš„ä½œä¸ºæ ‡è¯†åˆ—çš„æ•°æ®ç±»å‹ï¼Œæ¯”è¾ƒå¾ˆå¿«ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨auto_increment. é¡ºåºI/Oçš„æ€§èƒ½è¦æ¯”éšæœºå¥½å¾ˆå¤šã€‚</li>
<li>å­—ç¬¦ä¸²ç±»å‹ã€‚ å®é™…å·¥ä½œä¸­å¯èƒ½ä¼šé‡åˆ°ä½¿ç”¨UUID,SHA1äº§ç”Ÿçš„éšæœºå­—ç¬¦ä¸²æ¥ä½œä¸ºæ ‡è¯†åˆ—ï¼Œç”¨å­—ç¬¦ä¸²æ¥ä½œä¸ºæ ‡è¯†åˆ—ä¸ä»…æ¶ˆè€—å¤§è€Œä¸”æ¯”è¾ƒæ…¢ï¼Œæ­¤å¤–ä¼šå¯¼è‡´æ’å…¥ï¼ŒæŸ¥è¯¢éƒ½å˜æˆéšæœºI/Oï¼Œè€Œä¸”å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡é¡µåˆ†è£‚çš„æƒ…å†µï¼Œå¯¹æ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ã€‚å¯è€ƒè™‘å°†å…¶è½¬æ¢æˆæ•´æ•°å­˜å‚¨ã€‚</li>
</ol>
<h2 id="u8868_u8BBE_u8BA1_u6CE8_u610F_u4E8B_u9879"><a href="#u8868_u8BBE_u8BA1_u6CE8_u610F_u4E8B_u9879" class="headerlink" title="è¡¨è®¾è®¡æ³¨æ„äº‹é¡¹"></a>è¡¨è®¾è®¡æ³¨æ„äº‹é¡¹</h2><h3 id="u5408_u7406_u7684_u5217_u957F_u5EA6"><a href="#u5408_u7406_u7684_u5217_u957F_u5EA6" class="headerlink" title="åˆç†çš„åˆ—é•¿åº¦"></a>åˆç†çš„åˆ—é•¿åº¦</h3><p>åŒä¸€ä¸ªè¡¨ä¸­ä¸è¦è®¾è®¡è¿‡å¤šçš„åˆ—ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ•°æ®è¡Œåœ¨mysql serverå’Œæ•°æ®åº“å¼•æ“ä¹‹å‰è½¬æ¢æ—¶äº§ç”Ÿè¾ƒå¤§çš„å¼€é”€ã€‚</p>
<h3 id="u5408_u7406_u4F7F_u7528null"><a href="#u5408_u7406_u4F7F_u7528null" class="headerlink" title="åˆç†ä½¿ç”¨null"></a>åˆç†ä½¿ç”¨null</h3><p>å‰é¢è¯´è¿‡å°½é‡ä¸è¦å­˜åœ¨é»˜è®¤å€¼ä¸ºnullçš„æƒ…å†µï¼Œä½†æ˜¯å¦‚æœå®é™…æƒ…å†µç¡®å®ä¸ºä¸€ä¸ªæœªçŸ¥çš„å€¼ï¼Œä¹Ÿä¸èƒ½ç¡¬å¡ä¸€ä¸ªä¸åˆç†çš„å€¼å……æ•°ï¼Œå¦åˆ™ç¼–å†™ä»£ç æ—¶è¿˜è¦å¯¹å…¶è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œæ›´ä¸¥é‡çš„æ˜¯å¯¼è‡´bugçš„äº§ç”Ÿã€‚å¦‚æ•°æ®åº“å­˜åœ¨ä¸€ä¸ª<code>-1</code>çš„é»˜è®¤å€¼,åœ¨ä¼ é€’ç»™iOSå®¢æˆ·ç«¯æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯ä½¿ç”¨çš„ç±»å‹æ˜¯unsigned intï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªæœªçŸ¥çš„æ•´æ•°ï¼Œä¸¥é‡çš„å¯¼è‡´åº”ç”¨å´©æºƒï¼Œæ¬¡ä¹‹åˆ™æ˜¯äº§ç”Ÿå›°æƒ‘çš„æ•°æ®ã€‚</p>
<h2 id="null__u6BD4_u8F83_u67E5_u8BE2_u6CE8_u610F_u4E8B_u9879"><a href="#null__u6BD4_u8F83_u67E5_u8BE2_u6CE8_u610F_u4E8B_u9879" class="headerlink" title="null æ¯”è¾ƒæŸ¥è¯¢æ³¨æ„äº‹é¡¹"></a>null æ¯”è¾ƒæŸ¥è¯¢æ³¨æ„äº‹é¡¹</h2><p>ä¸è¦ä½¿ç”¨ = &lt;&gt; æ¯”è¾ƒnullå€¼ã€‚ä½¿ç”¨ is null ,is not null. çµæ´»ä½¿ç”¨IF(),IFNULL(). é™¤éæœ‰ç‰¹æ®Šéœ€è¦ï¼Œå°½é‡é¿å…ä½¿ç”¨nullå€¼ï¼Œnullå€¼ä¼šä½¿å¾—mysqlå¾ˆéš¾å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œå°¤å…¶æ˜¯ä¸è¦åœ¨æœ‰ç´¢å¼•çš„åˆ—ä¸Šå…è®¸nullå­˜åœ¨ã€‚</p>
<h2 id="u5B57_u6BB5_u7EF4_u62A4_u6CE8_u610F_u4E8B_u9879"><a href="#u5B57_u6BB5_u7EF4_u62A4_u6CE8_u610F_u4E8B_u9879" class="headerlink" title="å­—æ®µç»´æŠ¤æ³¨æ„äº‹é¡¹"></a>å­—æ®µç»´æŠ¤æ³¨æ„äº‹é¡¹</h2><ol>
<li>æ–°å¢å­—æ®µå°½é‡è¦æœ‰é»˜è®¤å€¼,ä¸”è®¾ç½®ä¸ºNOT NULL,æœ‰åˆ©äºæ•°æ®æ£€ç´¢ä¼˜åŒ–ã€‚</li>
<li>å¢åŠ å¤šä¸ªå­—æ®µæ—¶ï¼Œä½¿ç”¨ä¸€æ¡è¯­å¥ä¿®æ”¹ï¼Œé¿å…å¤šæ¬¡å•ç‹¬åˆ›å»ºã€‚</li>
<li>å­—æ®µæ–°å¢æˆ–ç»“æ„å˜åŒ–åº”è¯¥å…ˆäºåº”ç”¨ä¸Šçº¿ï¼Œé¿å…ä¸Šçº¿åæŠ¥SQLé”™è¯¯ã€‚</li>
<li>è‹¥æ˜¯åˆ é™¤å­—æ®µï¼Œåº”è¯¥ç­‰å¾…åº”ç”¨ä¸Šçº¿è¿è¡Œç¨³å®šåå†è¿›è¡Œå­—æ®µåˆ é™¤ï¼Œé¿å…è¯¯åˆ ã€‚</li>
<li>è‹¥å­—æ®µç±»å‹æ›´æ”¹å¯¼è‡´ä¸å…¼å®¹æ—¶ï¼Œå¯èƒ½ä¼šåœæœºç»´æŠ¤ï¼Œä¸€èˆ¬å¯é€šè¿‡å…¶ä»–æ–¹å¼é¿å…åœæœºã€‚</li>
<li>è‹¥æ¶‰åŠç´¢å¼•å˜æ›´ï¼Œåº”åœ¨åº”ç”¨ä¸Šçº¿å‰å¢åŠ æ–°çš„ç´¢å¼•ï¼Œä¸Šçº¿è¿è¡Œç¨³å®šä¹‹åå†åˆ é™¤æ—§çš„ç´¢å¼•ã€‚</li>
</ol>
<h2 id="u98CE_u683C"><a href="#u98CE_u683C" class="headerlink" title="é£æ ¼"></a>é£æ ¼</h2><h3 id="u547D_u540D"><a href="#u547D_u540D" class="headerlink" title="å‘½å"></a>å‘½å</h3><ul>
<li>é‡‡ç”¨26ä¸ªè‹±æ–‡å­—æ¯(åŒºåˆ†å¤§å°å†™)å’Œ0-9è¿™åä¸ªè‡ªç„¶æ•°,åŠ ä¸Šä¸‹åˆ’çº¿â€™_â€™ç»„æˆ,å…±63ä¸ªå­—ç¬¦.ä¸èƒ½å‡ºç°å…¶ä»–å­—ç¬¦(æ³¨é‡Šé™¤å¤–).</li>
<li>å¤–é”®åç”¨<code>fk_å¼€å¤´ï¼Œåé¢è·Ÿè¯¥å¤–é”®æ‰€åœ¨çš„è¡¨åå’Œå¯¹åº”çš„ä¸»è¡¨åï¼ˆä¸å«t_ï¼‰</code>ã€‚å­è¡¨åå’Œçˆ¶è¡¨åè‡ªå·±ç”¨ä¸‹åˆ’çº¿ï¼ˆ<em>ï¼‰åˆ†éš”ã€‚å¤–é”®åé•¿åº¦ä¸èƒ½è¶…è¿‡30ä¸ªå­—ç¬¦ã€‚å¦‚æœè¿‡é•¿ï¼Œå¯å¯¹è¡¨åè¿›è¡Œç¼©å†™ã€‚ç¼©å†™è§„åˆ™åŒè¡¨åçš„ç¼©å†™è§„åˆ™ã€‚å¤–é”®åç”¨å°å†™çš„è‹±æ–‡å•è¯æ¥è¡¨ç¤ºã€‚<br>å”¯ä¸€æ€§ç´¢å¼•ç”¨`uk</em>å¼€å¤´ï¼Œåé¢è·Ÿå­—æ®µåã€‚ä¸€èˆ¬æ€§ç´¢å¼•ç”¨idx_å¼€å¤´`ï¼Œåé¢è·Ÿå­—æ®µå</li>
<li>å¤‡ä»½æ•°æ®è¡¨åä½¿ç”¨æ­£å¼è¡¨ååŠ ä¸Šå¤‡ä»½æ—¶é—´ç»„æˆï¼Œå¦‚ï¼Œ<code>branch_user_20140326</code></li>
</ul>
<h3 id="u5EFA_u8868_u76F8_u5173"><a href="#u5EFA_u8868_u76F8_u5173" class="headerlink" title="å»ºè¡¨ç›¸å…³"></a>å»ºè¡¨ç›¸å…³</h3><ul>
<li>innodbå»ºè¡¨ï¼Œä¸»é”®ç”¨æ— æ„ä¹‰çš„è‡ªå¢ä¸»é”®ã€‚</li>
<li>ç¦ç”¨å¤–é”®çº¦æŸï¼Œç”±åº”ç”¨ç¨‹åºå®ç°å‚ç…§å®Œæ•´æ€§</li>
<li>å­—æ®µéœ€è®¾ç½®ä¸ºéç©ºï¼Œéœ€è®¾ç½®å­—æ®µé»˜è®¤å€¼ã€‚</li>
<li>ç”¨INNODBå¼•æ“å»ºè¡¨ã€‚</li>
<li>è¡¨å’Œæ¯ä¸ªå­—æ®µéƒ½æ·»åŠ ç®€çŸ­çš„comments</li>
<li>ç”¨å°½é‡å°‘çš„å­˜å‚¨ç©ºé—´æ¥å­˜æ•°ä¸€ä¸ªå­—æ®µçš„æ•°æ®<ol>
<li>èƒ½ç”¨intçš„å°±ä¸ç”¨charæˆ–è€…varchar</li>
<li>èƒ½ç”¨tinyintçš„å°±ä¸ç”¨int</li>
<li>èƒ½ç”¨varchar(20)çš„å°±ä¸ç”¨varchar(255)</li>
</ol>
</li>
<li><p>åœ¨å»ºè¡¨è¯­å¥åé¢åŠ ä¸Šä½¿ç”¨çš„æ•°æ®å¼•æ“å’Œç´¢å¼•è¿˜æœ‰ç¼–ç æ ¼å¼</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`db`</span>.<span class="string">`tbl_name`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'ä¸»é”®'</span>,</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">11</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'ç”¨æˆ·ID'</span>,</span><br><span class="line">  <span class="string">`start_time`</span> DATETIME <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'åˆ›å»ºæ—¶é—´'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> <span class="string">`uk_user`</span> (<span class="string">`user_id`</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'æ¸…ç†æµè§ˆè®°å½•çš„æ—¶é—´â€™;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹æˆ–è€…æ–°å»ºè¡¨çš„æ—¶å€™,ä¸éœ€è¦åŠ åº“å‘½ï¼Œä¹Ÿä¸è¦å†™if not existè¿™ç§è¯­å¥ï¼Œå»ºè¡¨ä¹‹å‰è¯·ç¡®å®šæ˜¯å¦å­˜åœ¨åŸè¡¨,æ¯”å¦‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`user_token`</span> <span class="keyword">add</span> <span class="keyword">column</span> <span class="string">`version`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">COMMENT</span> <span class="string">'ç‰ˆæœ¬å·'</span>;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>è€Œä¸æ˜¯å†™<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="string">`db`</span>.<span class="string">`user_token`</span> <span class="keyword">add</span> <span class="keyword">column</span> <span class="string">`version`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'ç‰ˆæœ¬å·'</span>;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="u4FEE_u6539_u8868_u7ED3_u6784"><a href="#u4FEE_u6539_u8868_u7ED3_u6784" class="headerlink" title="ä¿®æ”¹è¡¨ç»“æ„"></a>ä¿®æ”¹è¡¨ç»“æ„</h3><ul>
<li>å¤šæ­¥åˆä¸€,ç¦æ­¢å•è¡¨å¤šä¸ªæ›´æ”¹å­—æ®µï¼Œç”¨å¤šæ¬¡alter tableå‘½ä»¤ ,åœ¨æ“ä½œæ—¶ï¼Œä¸ºäº†å°½å¯èƒ½å‡å°‘å½±å“å’Œæ“ä½œæ—¶é—´ï¼Œå¯¹åŒä¸€ä¸ªè¡¨è¿›è¡Œçš„å¤šæ­¥æ“ä½œè¿›è¡Œåˆå¹¶ã€‚æ¯”å¦‚å¯¹åŒä¸€ä¸ªè¡¨æ—¢åŠ å­—æ®µã€åˆåŠ ç´¢å¼•ï¼Œé‚£ä¹ˆå°±åº”è¯¥å†™æˆä¸€æ¡è¯­å¥ã€‚å‡å°‘å¤åˆ¶ä¸´æ—¶è¡¨çš„æ—¶é—´ã€‚</li>
<li>å¦‚æœåªæ˜¯æ”¹å˜ä¸€ä¸ªå­—æ®µçš„é»˜è®¤å€¼ï¼Œé‚£ä¹ˆä½¿ç”¨<code>alter table user alter column id set default 5;</code>è¿™ç§è¯­æ³•.</li>
</ul>
<h2 id="u57FA_u672C_u547D_u4EE4"><a href="#u57FA_u672C_u547D_u4EE4" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><p><code>show databases</code>,<code>show tables</code>,<code>desc tableName</code>,<code>show create table tableName</code>.</p>
<h2 id="u67E5_u8BE2_u6280_u5DE7"><a href="#u67E5_u8BE2_u6280_u5DE7" class="headerlink" title="æŸ¥è¯¢æŠ€å·§"></a>æŸ¥è¯¢æŠ€å·§</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">where 1=1</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">select</span></span><br><span class="line">g1.<span class="keyword">id</span></span><br><span class="line"><span class="keyword">from</span> <span class="keyword">group</span> g1</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line"><span class="number">1</span> = (<span class="keyword">select</span> <span class="keyword">count</span>(g2.<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">group</span> g2 <span class="keyword">where</span> g1.user_id=g2.user_id <span class="keyword">and</span> g1.created_time &lt;= g2.created_time );</span></span><br></pre></td></tr></table></figure>
<h2 id="u7D22_u5F15"><a href="#u7D22_u5F15" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><h3 id="B_Tree__u7D22_u5F15"><a href="#B_Tree__u7D22_u5F15" class="headerlink" title="B Tree ç´¢å¼•"></a>B Tree ç´¢å¼•</h3><p>å®ç°ä¸ºB+ TREE.</p>
<h3 id="hash_u7D22_u5F15"><a href="#hash_u7D22_u5F15" class="headerlink" title="hashç´¢å¼•"></a>hashç´¢å¼•</h3><p>ç´¢å¼•ä¸­å­˜æ”¾çš„hashå€¼å’ŒæŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆã€‚</p>
<h3 id="u805A_u7C07_u7D22_u5F15_u3002"><a href="#u805A_u7C07_u7D22_u5F15_u3002" class="headerlink" title="èšç°‡ç´¢å¼•ã€‚"></a>èšç°‡ç´¢å¼•ã€‚</h3><p>èšç°‡ç´¢å¼•ä¸¥æ ¼æ¥è¯´ä¸æ˜¯ä¸€ç§ç´¢å¼•ç±»å‹ï¼Œåªæ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ã€‚ä¸»é”®å°±æ˜¯ä¸€ç§èšç°‡ç´¢å¼•ï¼Œç´¢å¼•å’Œæ•°æ®è¡Œéƒ½å­˜æ”¾åœ¨leafä¸Šã€‚</p>
<h3 id="u8986_u76D6_u7D22_u5F15"><a href="#u8986_u76D6_u7D22_u5F15" class="headerlink" title="è¦†ç›–ç´¢å¼•"></a>è¦†ç›–ç´¢å¼•</h3><p>ä¸€ä¸ªç´¢å¼•åŒ…å«æ‰€æœ‰æŸ¥è¯¢å­—æ®µçš„å€¼ï¼Œåˆ™ç§°ä¸ºè¦†ç›–ç´¢å¼•ã€‚<br>ä¼˜ç‚¹:</p>
<ol>
<li>å¯é¿å…å›è¡¨æŸ¥è¯¢ï¼Œæå¤§æé«˜æ•ˆç‡ã€‚</li>
<li>å®Œå…¨é¡ºåºI/Oã€‚<br>ç¼ºç‚¹:<br>å› ä¸ºè¦å­˜å‚¨åˆ—å€¼ï¼Œæ‰€ä»¥åªé€‚ç”¨äºB TREE ç´¢å¼•ã€‚<h3 id="u7D22_u5F15_u5408_u5E76"><a href="#u7D22_u5F15_u5408_u5E76" class="headerlink" title="ç´¢å¼•åˆå¹¶"></a>ç´¢å¼•åˆå¹¶</h3>å¦‚æœè¡¨ä¸­å­˜åœ¨å¤šä¸ªå•åˆ—ç´¢å¼•ï¼Œåœ¨åŒæ—¶ä½¿ç”¨è¿™å‡ ä¸ªå•åˆ—ç´¢å¼•æ—¶ï¼Œmysqlä¼šé‡‡ç”¨ä¸€ç§ç´¢å¼•åˆå¹¶çš„ç®—æ³•æ¥åŒæ—¶ä½¿ç”¨è¿™å‡ ä¸ªç´¢å¼•ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè€—è´¹å¤§é‡çš„CPUå’Œå†…å­˜èµ„æºï¼Œå‡ºç°è¿™ç§æƒ…å†µå¯ä»¥è¯´è®¾è®¡çš„ç´¢å¼•å°±æ˜¯ä¸€ä¸ªå¤±è´¥çš„æ¡ˆä¾‹ã€‚ é€šè¿‡EXPALINå¯ä»¥æŸ¥çœ‹åˆ°æ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•åˆå¹¶ã€‚<h3 id="u7D22_u5F15_u9009_u62E9_u6027"><a href="#u7D22_u5F15_u9009_u62E9_u6027" class="headerlink" title="ç´¢å¼•é€‰æ‹©æ€§"></a>ç´¢å¼•é€‰æ‹©æ€§</h3>ç´¢å¼•é€‰æ‹©æ€§=å”¯ä¸€å€¼/æ€»è®°å½•æ•°ã€‚ ç´¢å¼•é€‰æ‹©æ€§è¶Šé«˜æŸ¥è¯¢æ€§èƒ½è¶Šå¥½ã€‚å¯ä»¥æ®æ­¤åˆ¤æ–­ç´¢å¼•è®¾è®¡çš„å¥½åã€‚</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;mysql_index_and_best_practice_handout&quot;&gt;&lt;a href=&quot;#mysql_index_and_best_practice_handout&quot; class=&quot;headerlink&quot; title=&quot;mysql index and best practice handout&quot;&gt;&lt;/a&gt;mysql index and best practice handout&lt;/h1&gt;&lt;p&gt;è®²è®²MySQLçš„æœ€ä½³å®è·µå’Œå®¹æ˜“è¸©åˆ°çš„å‘ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>æ·±å…¥ç†è§£HashMap</title>
    <link href="http://yoursite.com/2016/06/27/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3HashMap/"/>
    <id>http://yoursite.com/2016/06/27/æ·±å…¥ç†è§£HashMap/</id>
    <published>2016-06-27T09:12:53.000Z</published>
    <updated>2016-11-24T10:19:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºä¸€ä¸ªJavaå¼€å‘è€…æ¥è¯´ï¼Œæœ€å¸¸ç”¨çš„Mapç»“æ„è«è¿‡äºHashMapã€‚ä½†æˆ‘å‘ç°å¾ˆå¤šäººå¯¹å…¶å†…éƒ¨æ˜¯å¦‚ä½•è¿›è¡Œå­˜å‚¨å’ŒæŸ¥æ‰¾çš„åŸºæœ¬æ²¡ä»€ä¹ˆæ¦‚å¿µæˆ–è€…æœ‰ç‚¹æ¦‚å¿µä½†å´æ˜¯é”™è¯¯çš„æˆ–ä¸å…¨é¢çš„ï¼Œå¯¹äºé è¿™ä¸ªåƒé¥­çš„äººæ¥è¯´ï¼Œå¦‚æœä½ ä¸äº†è§£ä»–ï¼Œä½ æ€ä¹ˆèƒ½æ”¾å¿ƒçš„æŠŠä½ çš„æ•°æ®äº¤ç»™ä»–å‘¢ï¼Œè¿™å°±å¥½æ¯”æŠŠè‡ªå·±çš„é¥­ç¢—äº¤ç»™äº†ä¸€ä¸ªä¸è®¤è¯†çš„äººï¼Œthatâ€™s terrible! æ‰€ä»¥æœ¬æ–‡å°±å¸¦ä½ æ·±å…¥ç†è§£ä¸€ä¸‹HashMap, å†…å®¹å¤§è‡´æ¶µç›–å¦‚ä¸‹å‡ ä¸ªæ–¹é¢:</p>
<ol>
<li>æ¯”è¾ƒHashMapåœ¨java7å’Œjava8ä¸­çš„ä¸åŒç‚¹</li>
<li>æ€§èƒ½</li>
<li>å¯èƒ½çš„é—®é¢˜</li>
</ol>
<h1 id="u5B58_u50A8"><a href="#u5B58_u50A8" class="headerlink" title="å­˜å‚¨"></a>å­˜å‚¨</h1><p>HashMapå®ç°äº†<code>Map&lt;K,V&gt;</code>ï¼Œæ‰€ä»¥åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªä¸»è¦çš„æ–¹æ³•:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">V <span class="function"><span class="title">put</span><span class="params">(K key, V value)</span></span></span><br><span class="line">V <span class="function"><span class="title">get</span><span class="params">(Object key)</span></span></span><br><span class="line">V <span class="function"><span class="title">remove</span><span class="params">(Object key)</span></span></span><br><span class="line">Boolean <span class="function"><span class="title">containsKey</span><span class="params">(Object key)</span></span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>HashMapä½¿ç”¨<code>Entry&lt;K, V&gt;</code>ä½œä¸ºå†…éƒ¨å­˜å‚¨å€¼çš„ç»“æ„,åŸºæœ¬ç»“æ„:<br><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> K key; <span class="comment">// é”®å€¼</span></span><br><span class="line">    V value;<span class="comment">// å®é™…å€¼</span></span><br><span class="line">    Entry&lt;K,V&gt; next; <span class="comment">// ä¸‹ä¸€æ¡è®°å½•ï¼Œæ„æˆä¸€ä¸ªå•å‘é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">int</span> hash;<span class="comment">// keyçš„hashå€¼ï¼Œå‡ºäºæ€§èƒ½ä¸Šçš„è€ƒè™‘ï¼Œè¿™ä¸ªå€¼ä¸»è¦æ˜¯ä¸ºäº†é¿å…é‡å¤è®¡ç®—hashå€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>HashMapå°†æ•°æ®å­˜å‚¨åœ¨å¤šä¸ªå•å‘é“¾è¡¨é‡Œé¢ï¼Œè¿™ä¸ªå•å‘é“¾è¡¨é€šå¸¸å«åšbucketï¼Œä½¿ç”¨ä¸€ä¸ªEntry<k,v>[]arrayæ¥å­˜å‚¨è¿™äº›bucket. è¿™ä¸ªarrayçš„é»˜è®¤å¤§å°ä¸º16.</k,v></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">  * The default initial capacity - MUST be a power of two.</span><br><span class="line">  */</span></span><br><span class="line"><span class="keyword">static</span> final <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br></pre></td></tr></table></figure>
<p>è¿™å¼ ç¤ºæ„å›¾å¯ä»¥å¤§è‡´è¡¨ç¤ºHashMapæ˜¯æ€ä¹ˆå­˜çš„æ•°æ®:</p>
<p><img src="http://ww4.sinaimg.cn/mw690/50508d62gw1f59y3ncsu4j20ta0ji0ty.jpg" alt="å›¾ä¾‹"></p>
<p><code>bucket array</code>çš„å¤§å°ä¸ºn,i<sub>0</sub> å­˜å‚¨äº†3ä¸ªentryæ„æˆçš„singly linked list,i<sub>1</sub>å­˜äº†ä¸ªnull,i<sub>n-1</sub>åªå­˜äº†1ä¸ªentryã€‚</p>
<p>å½“è°ƒç”¨put(K key, V value)æˆ–è€…get(Object key)æ—¶,å°±ä¼šæ ¹æ®keyå€¼è®¡ç®—ç›¸åº”çš„bucketåœ¨arrayä¸­çš„indexï¼Œç„¶åè¿›è¡Œæ·»åŠ æˆ–è€…è·å–Entry.</p>
<h2 id="u7D22_u5F15_u7684_u8BA1_u7B97_u65B9_u5F0F"><a href="#u7D22_u5F15_u7684_u8BA1_u7B97_u65B9_u5F0F" class="headerlink" title="ç´¢å¼•çš„è®¡ç®—æ–¹å¼"></a>ç´¢å¼•çš„è®¡ç®—æ–¹å¼</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java7</span></span><br><span class="line"><span class="function">final <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = hashSeed;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> != h &amp;&amp; k instanceof String) &#123;</span><br><span class="line">        <span class="keyword">return</span> sun.misc.Hashing.stringHash32((String) k);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    h ^= k.hashCode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This function ensures that hashCodes that differ only by</span></span><br><span class="line">    <span class="comment">// constant multiples at each bit position have a bounded</span></span><br><span class="line">    <span class="comment">// number of collisions (approximately 8 at default load factor).</span></span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">20</span>) ^ (h &gt;&gt;&gt; <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="number">7</span>) ^ (h &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// java8</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> + Computes key.hashCode() and spreads (XORs) higher bits of hash</span><br><span class="line"> + to lower.  Because the table uses power-of-two masking, sets of</span><br><span class="line"> + hashes that vary only in bits above the current mask will</span><br><span class="line"> + always collide. (Among known examples are sets of Float keys</span><br><span class="line"> + holding consecutive whole numbers in small tables.)  So we</span><br><span class="line"> + apply a transform that spreads the impact of higher bits</span><br><span class="line"> + downward. There is a tradeoff between speed, utility, and</span><br><span class="line"> + quality of bit-spreading. Because many common sets of hashes</span><br><span class="line"> + are already reasonably distributed (so don't benefit from</span><br><span class="line"> + spreading), and because we use trees to handle large sets of</span><br><span class="line"> + collisions in bins, we just XOR some shifted bits in the</span><br><span class="line"> + cheapest possible way to reduce systematic lossage, as well as</span><br><span class="line"> + to incorporate impact of the highest bits that would otherwise</span><br><span class="line"> + never be used in index calculations because of table bounds.</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> final <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == null) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Returns index for hash code h.</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// assert Integer.bitCount(length) == 1 : "length must be a non-zero power of 2";</span></span><br><span class="line">    <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†é«˜æ•ˆçš„å­˜å–æ•°æ®ï¼Œbucket arrayçš„é•¿åº¦å¿…é¡»ä¸º2çš„æŒ‡æ•°æ¬¡æ–¹ï¼Œä»ä¸Šé¢é»˜è®¤å¤§å°16çš„æ³¨é‡Šä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæ¥ä¸‹æ¥å°±è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¿™ä¸ªæ˜¯å¿…é¡»çš„ã€‚</p>
<p>å‡è®¾é»˜è®¤bucket arrayçš„é»˜è®¤å¤§å°æ˜¯17ï¼Œindexå³ä¸ºh&amp;(17-1),16çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸º00010000ï¼Œæ­¤æ—¶æ— è®ºhçš„æ˜¯ä»€ä¹ˆï¼Œh&amp;(17-1)çš„å€¼åªå¯èƒ½æ˜¯16æˆ–è€…0ï¼Œæ‰€ä»¥bucket arrayåªæœ‰bucket 16å’Œbucket 0èƒ½å¤Ÿè¢«ç”¨åˆ°ï¼Œå…¶ä»–éƒ½æµªè´¹äº†ã€‚ä½†æ˜¯å¦‚æœbucket arrayçš„å¤§å°ä¸º2çš„æŒ‡æ•°æ¬¡æ–¹ï¼Œå¦‚é»˜è®¤å¤§å°2<sup>4</sup>ï¼Œh&amp;15çš„ç»“æœå€¼ä¸º0-15ï¼Œæ¯ä¸ªbucketéƒ½è¢«ä½¿ç”¨äº†ï¼Œä¸å­˜åœ¨æµªè´¹æƒ…å†µã€‚</p>
<p>ç”±æ­¤å¯ä»¥çœ‹å‡ºbucket arrayçš„å¤§å°ä¸º2<sup>n</sup>æ˜¯å¾ˆé‡è¦çš„ï¼Œå½“ä½ æŒ‡å®šä¸€ä¸ªé2<sup>n</sup>å¾—å¤§å°æ—¶ï¼ŒHashMapé‡‡å–çš„ç­–ç•¥æ˜¯å‘ä¸Šå–ä¸‹ä¸€ä¸ª2çš„æŒ‡æ•°æ¬¡æ–¹ã€‚</p>
<h1 id="u81EA_u52A8_u6269_u5C55"><a href="#u81EA_u52A8_u6269_u5C55" class="headerlink" title="è‡ªåŠ¨æ‰©å±•"></a>è‡ªåŠ¨æ‰©å±•</h1><p>åœ¨è·å–åˆ°bucketçš„indexä¹‹åï¼Œå°±å¯ä»¥éå†bucketä¸­çš„linked listäº†ã€‚è®¾æƒ³æˆ‘ä»¬çš„bucketä¸­å­˜å‚¨äº†å¤§é‡æ•°æ®ï¼Œéå†linked listçš„æ—¶å€™å°±å¯èƒ½ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚æ‰€ä»¥HashMapåœ¨å‘ç°è‡ªå·±å­˜å‚¨çš„æ•°æ®é‡è¶…è¿‡æŸä¸ªé˜€å€¼çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨å¯¹bucket arrayå‡çº§ï¼Œå³æ‰©å®¹ã€‚</p>
<p>HashMapæä¾›äº†ä¸€ä¸ªå¯æŒ‡å®šåˆå§‹å®¹é‡å’ŒloadFactorçš„æ„é€ å™¨:<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">HashMap</span>(<span class="built_in">int</span> initialCapacity, <span class="built_in">float</span> loadFactor)</span><br></pre></td></tr></table></figure></p>
<p>é»˜è®¤çš„<code>initialCapacity</code>ä¸º16ï¼Œ<code>loadFactor</code>ä¸º0.75.</p>
<p>æ¯æ¬¡è°ƒç”¨put()æ—¶éƒ½ä¼šæ‰§è¡Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œå½“<code>map.size&gt;(threshold=capacity*loadFactor)</code>bucket arrayçš„å¤§å°ä¼šæ‰©å±•è‡³åŸæ¥çš„2å€,bucketçš„æ•°é‡ä¹Ÿå¢åŠ äº†ï¼Œæ‰€ä»¥éšå³å‘ç”Ÿçš„å°±æ˜¯é‡æ–°åˆ†å¸ƒæ‰€æœ‰çš„å…ƒç´ ã€‚é—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿæ‰©å±•array bucketçš„ä¸»è¦ç›®çš„å°±æ˜¯å‡å°bucketä¸­çš„linked listçš„å¤§å°ï¼Œè¿™æ ·æ‰èƒ½å¿«é€Ÿçš„åœ¨å…¶ä¸Šè¿›è¡ŒCRUDæ“ä½œã€‚ åœ¨å…ƒç´ çš„é‡æ–°åˆ†å¸ƒä¹‹åï¼Œæœ‰ç›¸åŒhashå€¼çš„å­˜åœ¨åŒä¸€ä¸ªbucketä¸­ï¼Œä¹‹å‰åœ¨åŒä¸€ä¸ªbucketä¸­ä½†æ˜¯hashå€¼ä¸ä¸€æ ·çš„å…ƒç´ å¯èƒ½åˆ†é…ä¹‹åå°±ä¸åœ¨åŒä¸€ä¸ªbucketä¸­äº†ã€‚</p>
<p>è¿‡ç¨‹å¦‚ä¸‹å›¾:</p>
<p><img src="http://ww2.sinaimg.cn/mw690/50508d62gw1f59y3lvrypj20q20lo75b.jpg" alt="åˆå§‹ç»“æ„"><br><img src="http://ww3.sinaimg.cn/mw690/50508d62gw1f59y3mj4myj20y80cwgmt.jpg" alt="æ‰©å±•åçš„ç»“æ„"></p>
<p><strong>HashMapè™½ç„¶æä¾›äº†æ‰©å®¹çš„æœºåˆ¶ï¼Œä½†æ²¡æœ‰æä¾›ç›¸åº”çš„ç¼©å®¹æœºåˆ¶ã€‚</strong></p>
<h1 id="u7EBF_u7A0B_u5B89_u5168"><a href="#u7EBF_u7A0B_u5B89_u5168" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h1><p>å¤§å®¶éƒ½çŸ¥é“HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ·±ç©¶è¿‡ä¸ºä»€ä¹ˆéº½ï¼Ÿ è€ƒè™‘å¦‚æœä¸€ä¸ªå†™çº¿ç¨‹å’Œä¸€ä¸ªè¯»çº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªHashMapï¼Œå†™çš„æ—¶å€™å¦‚æœå‘ç”Ÿæ‰©å®¹ï¼Œé‚£ä¹ˆè¯»çš„æ—¶å€™å°±å¯èƒ½å‡ºç°å¤±è´¥çš„ç°è±¡ï¼Œå› ä¸ºç´¢å¼•å’Œlistç»“æ„éƒ½å˜äº†ã€‚</p>
<p>HashMapçš„å°ä¼™ä¼´HashTableçš„å®ç°æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå…¶CRUDéƒ½åšäº†åŒæ­¥æ“ä½œï¼Œæ€§èƒ½è‡ªç„¶æ˜¯ä¸èƒ½åŒHashMapç›¸æ¯”ï¼Œé™¤éåœ¨ç‰¹æ®Šåœºæ™¯ï¼Œå¦åˆ™ä¸æ¨èä½¿ç”¨ã€‚</p>
<h1 id="key_u503C_u53EF_u53D8_u6027"><a href="#key_u503C_u53EF_u53D8_u6027" class="headerlink" title="keyå€¼å¯å˜æ€§"></a>keyå€¼å¯å˜æ€§</h1><p>é€šå¸¸æˆ‘ä»¬å¯èƒ½ä¼šçœ‹åˆ°æœ‰äººè¯´æœ€å¥½æ˜¯ä½¿ç”¨String and Integerä½œä¸ºMapçš„keyå€¼ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ä¸»è¦åŸå› æ˜¯å› ä¸ºå…¶<code>immutable</code>çš„ç‰¹æ€§ã€‚å¦‚æœä½¿ç”¨è‡ªå·±å®šä¹‰çš„å¯¹è±¡ä½œä¸ºkey,è¯·ç¡®ä¿å…¶hashä¸å¯å˜ï¼Œå¦åˆ™å¯èƒ½ä¸¢å¤±ä¹‹å‰å­˜å‚¨çš„æ•°æ®ã€‚</p>
<h1 id="Java8_u7684_u53D8_u5316"><a href="#Java8_u7684_u53D8_u5316" class="headerlink" title="Java8çš„å˜åŒ–"></a>Java8çš„å˜åŒ–</h1><p>ä»ä»£ç é‡ä¸Šæ¥çœ‹å°±çŸ¥é“java8åšäº†ä¸€äº›æ”¹è¿›ï¼Œjava7çš„HashMapåªæœ‰1000è¡Œå·¦å³çš„ä»£ç ï¼Œjava8å´ç”¨äº†2000å¤šè¡Œã€‚<br>Java8æ–°å¢äº†ä¸€ä¸ªNodeå¯¹è±¡ï¼Œç»“æ„å’ŒEntryæ˜¯ä¸€æ ·çš„:<br><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    Node&lt;K,V&gt; next;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>bucketä¸­å­˜å‚¨çš„æ˜¯è¿™ä¸ªæ–°çš„Nodeå¯¹è±¡ã€‚ä¸Java7ä¸åŒçš„åœ°æ–¹æ˜¯ï¼ŒNodeå¯ä»¥æ‰©å±•ä¸ºTreeNode,TreeNodeçš„å®ç°æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œè¿™æ ·å¢åˆ ç­‰æ“ä½œå¯ä»¥é™åˆ°<code>O(log(n))</code>çš„çº§åˆ«ã€‚</p>
<p>TreeNodeéƒ¨åˆ†ä»£ç <br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">static <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode&lt;K</span>,<span class="title">V&gt;</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">LinkedHashMap</span>.<span class="title">Entry&lt;K</span>,<span class="title">V&gt;</span> &#123;</span></span><br><span class="line">    <span class="type">TreeNode</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; parent;  <span class="comment">// red-black tree links</span></span><br><span class="line">    <span class="type">TreeNode</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; left;</span><br><span class="line">    <span class="type">TreeNode</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; right;</span><br><span class="line">    <span class="type">TreeNode</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; prev;    <span class="comment">// needed to unlink next upon deletion</span></span><br><span class="line">    boolean red;</span><br><span class="line">    <span class="type">TreeNode</span>(int hash, <span class="type">K</span> key, <span class="type">V</span> <span class="keyword">val</span>, <span class="type">Node</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; next) &#123;</span><br><span class="line">        <span class="keyword">super</span>(hash, key, <span class="keyword">val</span>, next);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     + Returns root of tree containing this node.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">TreeNode</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; root() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">TreeNode</span>&lt;<span class="type">K</span>,<span class="type">V</span>&gt; r = <span class="keyword">this</span>, p;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((p = r.parent) == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            r = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨çº¢é»‘æ ‘çš„ä¸€ä¸ªä¸»è¦å¥½å¤„å°±æ˜¯å½“æŸä¸ªbucketä¸­å­˜åœ¨å¾ˆå¤šå…ƒç´ æ—¶ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´ä¸º<code>O(log(n))</code>,è€ŒåŸæ¥çš„ä¸º<code>O(n)</code>ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„çš„æ˜¯bucketä¸­æ—¢å¯å­˜æ”¾linked list,ä¹Ÿå¯ä»¥å­˜æ”¾TreeNode. ä½•æ—¶ä½¿ç”¨å“ªç§ç»“æ„å–å†³äºbucketä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚æºç ä¸­å®šä¹‰äº†ä¸€ä¸ªé˜€å€¼:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> + The bin <span class="command">count</span> threshold <span class="keyword">for</span> using a tree rather than <span class="type">list</span> <span class="keyword">for</span> a</span><br><span class="line"> + bin.  Bins are converted <span class="keyword">to</span> trees when adding an element <span class="keyword">to</span> a</span><br><span class="line"> + bin <span class="keyword">with</span> <span class="keyword">at</span> least this many nodes. The value must be greater</span><br><span class="line"> + than <span class="number">2</span> <span class="keyword">and</span> should be <span class="keyword">at</span> least <span class="number">8</span> <span class="keyword">to</span> mesh <span class="keyword">with</span> assumptions <span class="keyword">in</span></span><br><span class="line"> + tree removal <span class="keyword">about</span> conversion <span class="keyword">back</span> <span class="keyword">to</span> plain bins upon</span><br><span class="line"> + shrinkage.</span><br><span class="line"> */</span><br><span class="line">static final int TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br></pre></td></tr></table></figure>
<p>è¶…è¿‡8ä¸ªå°±è½¬æ¢æˆTreeNodeï¼Œå¦åˆ™å°±ä½¿ç”¨Linked List.</p>
<h1 id="u6027_u80FD_u95EE_u9898"><a href="#u6027_u80FD_u95EE_u9898" class="headerlink" title="æ€§èƒ½é—®é¢˜"></a>æ€§èƒ½é—®é¢˜</h1><p>HashMapæ€§èƒ½æ˜¯å¦è¿‡å…³ï¼Œä¸»è¦å–å†³äºhash functionçš„è®¾è®¡æ˜¯å¦åˆç†ã€‚ hash functionå¦‚æœè®¾è®¡ä¸åˆç†ï¼Œbucket arrayå°±ä¸èƒ½å¤Ÿè¢«å……åˆ†åˆ©ç”¨ï¼Œå‡è®¾æœ‰<code>n(n&gt;=16)</code>ä¸ªå…ƒç´ ï¼Œbucket arrayé•¿åº¦ä¸ºL,bucket<sub>i</sub>å­˜å‚¨<code>k(k&lt;n/2)</code>ä¸ªå…ƒç´ ,å¦ä¸€ä¸ªbucket<sub>j</sub>å­˜å‚¨n-kä¸ª,å¦‚æœæ˜¯ä½¿ç”¨java7ï¼ŒæŸ¥æ‰¾æœ€åæƒ…å†µéœ€è¦<code>O(n-k)</code>, ä½†å¦‚æœå‡åŒ€åˆ†å¸ƒçš„è¯,java7å°±åªéœ€è¦<code>O(n/L)</code>.</p>
<p>ä¹‹å‰è¯´æ¨èä½¿ç”¨String or Integerä½œä¸ºKeyå°±æ˜¯å› ä¸ºå…¶æœ‰ä¸é”™çš„hash functionã€‚</p>
<h1 id="u81EA_u52A8_u6269_u5C55_u7684_u5F00_u9500"><a href="#u81EA_u52A8_u6269_u5C55_u7684_u5F00_u9500" class="headerlink" title="è‡ªåŠ¨æ‰©å±•çš„å¼€é”€"></a>è‡ªåŠ¨æ‰©å±•çš„å¼€é”€</h1><p>å‰é¢å·²ç»è®²è¿‡ï¼Œå½“put()çš„æ—¶å€™è¾¾åˆ°ä¸´ç•Œå€¼æ—¶å°±ä¼šå¯¹bucket arrayè¿›è¡Œæ‰©å®¹ï¼Œæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ä¸€ä¸ªå¼€é”€å¾ˆå¤§çš„è¿‡ç¨‹ï¼Œå¦‚æœæå‰çŸ¥é“è‡ªå·±éœ€è¦å¤šå¤§çš„å®¹é‡ï¼Œæ¨èåœ¨åˆ›å»ºHashMapçš„æ—¶å€™å°±è®¾ç½®å¥½initialCapacity and loadFactor.</p>
<h1 id="u7ED3_u8BED"><a href="#u7ED3_u8BED" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>å¯¹äºæ—¥å¸¸å¼€å‘æ¥è¯´ï¼Œä¸Šè¿°å„æ–¹é¢å¯èƒ½ä¼šè®©ä½ è§‰å¾—æ²¡å¤ªå¤§ç”¨å¤„ï¼Œä½†å¯¹äºä¸€ä¸ªè®¤çœŸçš„å¼€å‘è€…æ¥è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½ä»…ä»…åšåˆ°çŸ¥å…¶ç„¶ï¼Œæ›´è¦åšåˆ°çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½å¥½çš„åˆ©ç”¨è¿™äº›å·¥å…·ä¸ºæˆ‘ä»¬è§£å†³é—®é¢˜ï¼Œå¹¶ä¸”åœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™èƒ½å¤Ÿå¿«é€Ÿå®šä½å’Œå¾—å‡ºè§£å†³é—®é¢˜çš„æ–¹æ¡ˆã€‚That is what makes you different!</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¯¹äºä¸€ä¸ªJavaå¼€å‘è€…æ¥è¯´ï¼Œæœ€å¸¸ç”¨çš„Mapç»“æ„è«è¿‡äºHashMapã€‚ä½†æˆ‘å‘ç°å¾ˆå¤šäººå¯¹å…¶å†…éƒ¨æ˜¯å¦‚ä½•è¿›è¡Œå­˜å‚¨å’ŒæŸ¥æ‰¾çš„åŸºæœ¬æ²¡ä»€ä¹ˆæ¦‚å¿µæˆ–è€…æœ‰ç‚¹æ¦‚å¿µä½†å´æ˜¯é”™è¯¯çš„æˆ–ä¸å…¨é¢çš„ï¼Œå¯¹äºé è¿™ä¸ªåƒé¥­çš„äººæ¥è¯´ï¼Œå¦‚æœä½ ä¸äº†è§£ä»–ï¼Œä½ æ€ä¹ˆèƒ½æ”¾å¿ƒçš„æŠŠä½ çš„æ•°æ®äº¤ç»™ä»–å‘¢ï¼Œè¿™å°±å¥½æ¯”æŠŠè‡ªå·±çš„é¥­ç¢—äº¤ç»™äº†ä¸€ä¸ªä¸è®¤è¯†çš„äººï¼Œthatâ€™s terrible! æ‰€ä»¥æœ¬æ–‡å°±å¸¦ä½ æ·±å…¥ç†è§£ä¸€ä¸‹HashMap, å†…å®¹å¤§è‡´æ¶µç›–å¦‚ä¸‹å‡ ä¸ªæ–¹é¢:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¯”è¾ƒHashMapåœ¨java7å’Œjava8ä¸­çš„ä¸åŒç‚¹&lt;/li&gt;
&lt;li&gt;æ€§èƒ½&lt;/li&gt;
&lt;li&gt;å¯èƒ½çš„é—®é¢˜&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;u5B58_u50A8&quot;&gt;&lt;a href=&quot;#u5B58_u50A8&quot; class=&quot;headerlink&quot; title=&quot;å­˜å‚¨&quot;&gt;&lt;/a&gt;å­˜å‚¨&lt;/h1&gt;&lt;p&gt;HashMapå®ç°äº†&lt;code&gt;Map&amp;lt;K,V&amp;gt;&lt;/code&gt;ï¼Œæ‰€ä»¥åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªä¸»è¦çš„æ–¹æ³•:&lt;br&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;V &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(K key, V value)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;V &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object key)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;V &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object key)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Boolean &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;containsKey&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Object key)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="HashMap" scheme="http://yoursite.com/tags/HashMap/"/>
    
      <category term="java" scheme="http://yoursite.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>effective-java-methods</title>
    <link href="http://yoursite.com/2016/06/22/effective-java-methods/"/>
    <id>http://yoursite.com/2016/06/22/effective-java-methods/</id>
    <published>2016-06-22T06:34:20.000Z</published>
    <updated>2016-11-24T10:19:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h1><p>â€œusability, robustness, and flexibility.â€</p>
<p>æ‘˜å½•æ¥è‡ª: Joshua Bloch. â€œEffective JavaÂ™ (Jason Arnoldâ€™s Library)â€ã€‚ iBooks. </p>
<h2 id="u68C0_u67E5_u53C2_u6570_u6709_u6548_u6027_28check_validity_of_params_29"><a href="#u68C0_u67E5_u53C2_u6570_u6709_u6548_u6027_28check_validity_of_params_29" class="headerlink" title="æ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§(check validity of params)"></a>æ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§(check validity of params)</h2><p>æ—©æ£€æŸ¥æ—©å‘ç°æ—©é¿å…é—®é¢˜ã€‚Fail fast!</p>
<p>æœªæ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§å¯èƒ½å¯¼è‡´çš„é—®é¢˜:</p>
<ol>
<li>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¤±è´¥å¹¶æŠ›å‡ºæ©ç›–é—®é¢˜çš„å¼‚å¸¸ã€‚</li>
<li>æ­£å¸¸è¿”å›ä½†æ˜¯è¿”å›çš„æ˜¯é”™è¯¯çš„ç»“æœã€‚</li>
<li>åŒæ ·æ˜¯æ­£å¸¸è¿”å›ï¼Œä½†æ˜¯åŸ‹ä¸‹äº†ç¥¸æ ¹ï¼Œå¯èƒ½äº§ç”Ÿäº†å…¶ä»–çŠ¶æ€æœ‰é—®é¢˜çš„æ•°æ®ï¼Œå¯¼è‡´åœ¨ä¸å®šæ—¶çš„å°†æ¥äº§ç”Ÿä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚</li>
</ol>
<a id="more"></a>
<h2 id="u629B_u51FA_u5F02_u5E38"><a href="#u629B_u51FA_u5F02_u5E38" class="headerlink" title="æŠ›å‡ºå¼‚å¸¸"></a>æŠ›å‡ºå¼‚å¸¸</h2><p>å¯¹éœ€è¦æŠ›å‡ºå¼‚å¸¸çš„publicæ–¹æ³•ï¼Œåº”è¯¥ä½¿ç”¨@throwsè¯´æ˜ã€‚å¸¸è§çš„å¦‚:<code>IllegalArgumentException</code>,<code>NPE</code>,<code>IndexOutOfBoundsException</code> etc. </p>
<p>å¯¹äºéœ€è¦æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ï¼Œåº”è¯¥ä½¿ç”¨javadocå°½é‡è¯´æ˜æŠ›å‡ºè¯¥å¼‚å¸¸çš„å…·ä½“æ¡ä»¶ï¼Œå¹¶ä¸”æŠ›å‡ºå¼‚å¸¸æ—¶åº”è¯¥æŠ›å‡ºå…·ä½“çš„å¼‚å¸¸è€Œä¸æ˜¯ä¸€ä¸ªçˆ¶ç±»ï¼Œå¦‚é¿å…æŠ›å‡ºexception or throwable,è®©ä½¿ç”¨è¯¥æ–¹æ³•çš„äººçŸ¥é“å¦‚ä½•åˆç†æœ‰æ•ˆçš„ä½¿ç”¨ä½ æä¾›çš„æ–¹æ³•ã€‚</p>
<p>å¯¹äºnonpublicç±»å‹çš„æ–¹æ³•ï¼Œæ˜¯ç”±ç»´æŠ¤äººå‘˜æ§åˆ¶çš„ï¼Œæ‰€ä»¥ç»´æŠ¤äººå‘˜åº”è¯¥ä¿è¯ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œåªéœ€è¦åšassertionåˆ¤æ–­å°±è¡Œï¼Œæ²¡å¿…è¦å†æ£€æŸ¥ç„¶åæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h2 id="u5931_u8D25_u539F_u5B50_u6027_28failure_atomicity_29"><a href="#u5931_u8D25_u539F_u5B50_u6027_28failure_atomicity_29" class="headerlink" title="å¤±è´¥åŸå­æ€§(failure atomicity)"></a>å¤±è´¥åŸå­æ€§(failure atomicity)</h2><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªå¤±è´¥çš„æ–¹æ³•è°ƒç”¨å¦‚æœå°†å¤„ç†çš„ç›®æ ‡å¯¹è±¡è¿˜åŸä¸ºè°ƒç”¨æ–¹æ³•ä¹‹å‰çš„çŠ¶æ€ï¼Œå°±èƒ½ç§°ä¸ºæ˜¯å¤±è´¥åŸå­æ€§çš„ã€‚<br>é€šå¸¸è¾¾åˆ°è¿™ä¸ªæ•ˆæœçš„åšæ³•:</p>
<ul>
<li>ä½¿ç”¨immutable object.</li>
<li>é’ˆå¯¹mutable objectï¼Œå¸¸ç”¨æ–¹æ³•å°±æ˜¯æ£€æŸ¥å‚æ•°çš„æœ‰æ•ˆæ€§ï¼Œfail before modification!</li>
</ul>
<p>Talking is cheap, time to show some code!</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">  * Deletes the component at the specified index. Each component in</span><br><span class="line">  * this vector with an index greater or equal to the specified</span><br><span class="line">  * &#123;<span class="doctag">@code</span> index&#125; is shifted downward to have an index one</span><br><span class="line">  * smaller than the value it had previously. The size of this vector</span><br><span class="line">  * is decreased by &#123;<span class="doctag">@code</span> 1&#125;.</span><br><span class="line">  *</span><br><span class="line">  * &lt;p&gt;The index must be a value greater than or equal to &#123;<span class="doctag">@code</span> 0&#125;</span><br><span class="line">  * and less than the current size of the vector.</span><br><span class="line">  *</span><br><span class="line">  * &lt;p&gt;This method is identical in functionality to the &#123;<span class="doctag">@link</span> #remove(int)&#125;</span><br><span class="line">  * method (which is part of the &#123;<span class="doctag">@link</span> List&#125; interface).  Note that the</span><br><span class="line">  * &#123;<span class="doctag">@code</span> remove&#125; method returns the old value that was stored at the</span><br><span class="line">  * specified position.</span><br><span class="line">  *</span><br><span class="line">  * <span class="doctag">@param</span>      index   the index of the object to remove</span><br><span class="line">  * <span class="doctag">@throws</span> ArrayIndexOutOfBoundsException if the index is out of range</span><br><span class="line">  *         (&#123;<span class="doctag">@code</span> index &lt; 0 || index &gt;= size()&#125;)</span><br><span class="line">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">removeElementAt</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">     modCount++;</span><br><span class="line">     <span class="keyword">if</span> (index &gt;= elementCount) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException(index + <span class="string">" &gt;= "</span> +</span><br><span class="line">                                                  elementCount);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException(index);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">int</span> j = elementCount - index - <span class="number">1</span>;</span><br><span class="line">     <span class="keyword">if</span> (j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         System.arraycopy(elementData, index + <span class="number">1</span>, elementData, index, j);</span><br><span class="line">     &#125;</span><br><span class="line">     elementCount--;</span><br><span class="line">     elementData[elementCount] = <span class="keyword">null</span>; <span class="comment">/* to let gc do its work */</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç å–è‡ªVectorä¸­ã€‚åœ¨ç§»é™¤å…ƒç´ æ—¶æå‰æ£€æŸ¥æ•°ç»„æ˜¯å¦è¶Šç•Œï¼Œå¹¶åœ¨javadocä¸­ä½¿ç”¨<code>@throws</code>è¯´æ˜æŠ›å‡ºçš„å¼‚å¸¸å’Œè§¦å‘æ¡ä»¶ã€‚</p>
<ul>
<li>å¤åˆ¶æ›¿æ¢. å¤åˆ¶ä¸€ä»½åŸå§‹æ•°æ®ï¼Œå¯¹å‰¯æœ¬è¿›è¡Œæ“ä½œï¼Œé¡ºåˆ©å®Œæˆä¹‹åå†æ›¿æ¢åŸå§‹æ•°æ®ã€‚ å¦‚Collections.sort()åœ¨è¿›è¡Œæ’åºä¹‹å‰å°±æ˜¯å…ˆå°†åŸå§‹æ•°æ®å­˜åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå¦‚æœæ’åºå¤±è´¥ï¼ŒåŸå§‹æ•°æ®åŸå°ä¸åŠ¨ã€‚</li>
<li>JDK source code:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; c)</span> </span>&#123;</span><br><span class="line">    Object[] a = <span class="keyword">this</span>.toArray();</span><br><span class="line">    Arrays.sort(a, (Comparator) c);</span><br><span class="line">    ListIterator&lt;E&gt; i = <span class="keyword">this</span>.listIterator();</span><br><span class="line">    <span class="keyword">for</span> (Object e : a) &#123;</span><br><span class="line">        i.next();</span><br><span class="line">        i.set((E) e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å°±ä»¥ä¸Šçœ‹æ¥ï¼Œæ–¹æ³•å‚æ•°é™åˆ¶è¶Šä¸¥å¯†è¶Šå¥½ï¼Œå…¶å®ä¸ç„¶ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•å¯¹ä¼ å…¥çš„å‚æ•°éƒ½èƒ½å¤Ÿä¼˜é›…çš„å¤„ç†ä¸ç”¨å¤ªå¤šçš„é™åˆ¶å¯¹äºä½¿ç”¨è¯¥æ–¹æ³•çš„äººæ¥è¯´æ— ç–‘æ˜¯ä¸€å¤§ç¦éŸ³ã€‚</p>
<p><strong>ä»¥ä¸Šè¿™å‡ ç‚¹çœ‹ä¸Šå»å¾ˆç®€å•æœ´å®ï¼Œä½†å¦‚æœçœŸæ­£éµå®ˆå¹¶å…»æˆè¿™äº›ä¹ æƒ¯ï¼Œå¯¹ä»£ç è´¨é‡çš„æé«˜æ˜¯å¯è§ä¸€æ–‘çš„ã€‚</strong></p>
<h2 id="u4FDD_u62A4_u6027_u590D_u5236_28Defensive_copy_29"><a href="#u4FDD_u62A4_u6027_u590D_u5236_28Defensive_copy_29" class="headerlink" title="ä¿æŠ¤æ€§å¤åˆ¶(Defensive copy)"></a>ä¿æŠ¤æ€§å¤åˆ¶(Defensive copy)</h2><p>ä¿æŠ¤æ€§å¤åˆ¶æ˜¯ä¿æŠ¤å¯¹è±¡ä¸å˜æ€§ï¼Œå¥å£®æ€§çš„ä¸€ç§ç­–ç•¥ã€‚APIæä¾›è€…æœ¬æ„æ˜¯æƒ³æä¾›ä¸€ä¸ªå¯é ç¨³å®šçš„å¯¹è±¡ï¼Œä½†å¾€å¾€ä¸ç»æ„é—´å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å°±è¢«APIçš„ä½¿ç”¨è€…æ‰€æ›´æ”¹äº†ï¼Œè€Œä¸”æ˜¯æ— æ„è¯†çš„ã€‚ä¸¾ä¸ªæ —å­:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Period</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Date start;</span><br><span class="line">        <span class="keyword">private</span> Date end;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span><br><span class="line">         * </span><br><span class="line">         * <span class="doctag">@param</span> start</span><br><span class="line">         * <span class="doctag">@param</span> end</span><br><span class="line">         *</span><br><span class="line">         * <span class="doctag">@throws</span> IllegalArgumentException if start is greater than end</span><br><span class="line">         * <span class="doctag">@throws</span> NullPointerException if start or end is null</span><br><span class="line">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Period</span><span class="params">(Date start, Date end)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (start.compareTo(end)&gt;<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"start must less than end"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.start = <span class="keyword">new</span> Date(start);</span><br><span class="line">            <span class="keyword">this</span>.end = <span class="keyword">new</span> Date(end);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Date <span class="title">getStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// return new Date(start);</span></span><br><span class="line">            <span class="keyword">return</span> start;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Date <span class="title">getEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// return new Date(end);</span></span><br><span class="line">            <span class="keyword">return</span> end;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>The invariants of period can be broken easily!</strong><br>ä¼ å…¥startå’Œendåï¼Œå¯¹startå’Œendçš„ä¿®æ”¹ä¼šç›´æ¥å½±å“Periodçš„å†…éƒ¨çŠ¶æ€,ä½¿ç”¨getæ–¹æ³•è·å–åˆ°æ—¥æœŸåä¹Ÿå¯ä»¥ä¿®æ”¹å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€,å¯ä»¥è¯´è¿™å°±æ˜¯å‘å¸ƒäº†ä¸€ä¸ªä¸å®‰å…¨çš„å¯¹è±¡ã€‚ä½¿ç”¨defensive copyå°±å¯ä»¥ä¿®å¤è¿™ä¸ªé—®é¢˜,åœ¨æ„é€ å™¨å’Œgetteræ–¹æ³•ä¸­éƒ½å¤åˆ¶ä¸€ä»½æºå¯¹è±¡å³å¯ã€‚å¦å¤–ä¸€ç§æŠ€å·§ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œperiodå†…éƒ¨ä½¿ç”¨longæ¥å­˜å‚¨æ—¶é—´ï¼Œå°±ä¸ç”¨æ‹…å¿ƒçŠ¶æ€è¢«æ›´æ”¹ã€‚</p>
<h2 id="u8C28_u614E_u8BBE_u8BA1_u65B9_u6CD5_u7B7E_u540D"><a href="#u8C28_u614E_u8BBE_u8BA1_u65B9_u6CD5_u7B7E_u540D" class="headerlink" title="è°¨æ…è®¾è®¡æ–¹æ³•ç­¾å"></a>è°¨æ…è®¾è®¡æ–¹æ³•ç­¾å</h2><h3 id="u9009_u62E9_u6709_u610F_u4E49_u7684_u540D_u5B57"><a href="#u9009_u62E9_u6709_u610F_u4E49_u7684_u540D_u5B57" class="headerlink" title="é€‰æ‹©æœ‰æ„ä¹‰çš„åå­—"></a>é€‰æ‹©æœ‰æ„ä¹‰çš„åå­—</h3><p>éµå®ˆçº¦å®šçš„å‘½åè§„èŒƒï¼Œå¦‚å˜é‡åè¯ï¼Œæ–¹æ³•åŠ¨è¯å¼€å¤´ç­‰ã€‚</p>
<h3 id="u4E0D_u8981_u8FC7_u5EA6_u63D0_u4F9B_u5DE5_u5177_u65B9_u6CD5"><a href="#u4E0D_u8981_u8FC7_u5EA6_u63D0_u4F9B_u5DE5_u5177_u65B9_u6CD5" class="headerlink" title="ä¸è¦è¿‡åº¦æä¾›å·¥å…·æ–¹æ³•"></a>ä¸è¦è¿‡åº¦æä¾›å·¥å…·æ–¹æ³•</h3><p>è¿‡å¤šçš„æ–¹æ³•å¯¼è‡´å¯¹è±¡çš„ç»´æŠ¤éš¾åº¦æé«˜ï¼Œæ˜“ç”¨æ€§ä¸‹é™ã€‚ç‰¹åˆ«æ˜¯å¯¹äºæ¥å£è€Œè¨€ï¼Œè¿‡å¤šçš„æ–¹æ³•å¯¼è‡´å®ç°èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼ŒThink before in doing anything! å¦‚æœè§‰å¾—æ²¡å¿…è¦å°±ä¸æä¾›ã€‚</p>
<h3 id="u907F_u514D_u8FC7_u957F_u7684_u53C2_u6570_u5217_u8868"><a href="#u907F_u514D_u8FC7_u957F_u7684_u53C2_u6570_u5217_u8868" class="headerlink" title="é¿å…è¿‡é•¿çš„å‚æ•°åˆ—è¡¨"></a>é¿å…è¿‡é•¿çš„å‚æ•°åˆ—è¡¨</h3><p>å‚æ•°å°½é‡ä¸è¦è¶…è¿‡å››ä¸ªï¼Œå¤šäº†ä½¿ç”¨èµ·æ¥å®¹æ˜“å‡ºé”™ï¼Œç‰¹åˆ«å½“æœ‰å¤šä¸ªç›¸åŒç±»å‹çš„å‚æ•°å­˜åœ¨çš„æ—¶å€™,å¦‚æœé¡ºåºå¼„é”™äº†ï¼Œæœ€ç»ˆç»“æœæ€»æ˜¯ä¸å¯¹ï¼Œä¹Ÿå¾ˆéš¾å‘ä¸‹bugçš„æ‰€åœ¨ã€‚</p>
<p>é’ˆå¯¹å‚æ•°è¿‡å¤šçš„æƒ…å†µå¸¸è§çš„åº”å¯¹æ–¹å¼æœ‰:</p>
<ol>
<li>æ‹†åˆ†æˆå‡ ä¸ªæ–¹æ³•ï¼Œæœ‰å¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šæ–¹æ³•ã€‚</li>
<li>æ–°å»ºä¸€ä¸ªhelperç±»åŒ…å«è¿™äº›å‚æ•°ï¼Œå†å°†è¿™ä¸ªhelperç±»ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li>
<li>åˆ©ç”¨Builder patternã€‚</li>
</ol>
<h3 id="u4F18_u5148_u4F7F_u7528_u63A5_u53E3_u7C7B_u578B_u4F5C_u4E3A_u53C2_u6570_u800C_u4E0D_u662F_u5B9E_u73B0_u7C7B"><a href="#u4F18_u5148_u4F7F_u7528_u63A5_u53E3_u7C7B_u578B_u4F5C_u4E3A_u53C2_u6570_u800C_u4E0D_u662F_u5B9E_u73B0_u7C7B" class="headerlink" title="ä¼˜å…ˆä½¿ç”¨æ¥å£ç±»å‹ä½œä¸ºå‚æ•°è€Œä¸æ˜¯å®ç°ç±»"></a>ä¼˜å…ˆä½¿ç”¨æ¥å£ç±»å‹ä½œä¸ºå‚æ•°è€Œä¸æ˜¯å®ç°ç±»</h3><p>è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„.</p>
<h3 id="u4F7F_u7528_u542B_u6709_u4E24_u4E2A_u5143_u7D20_u7684_u679A_u4E3E_u4EE3_u66FFboolean_u7C7B_u578B"><a href="#u4F7F_u7528_u542B_u6709_u4E24_u4E2A_u5143_u7D20_u7684_u679A_u4E3E_u4EE3_u66FFboolean_u7C7B_u578B" class="headerlink" title="ä½¿ç”¨å«æœ‰ä¸¤ä¸ªå…ƒç´ çš„æšä¸¾ä»£æ›¿booleanç±»å‹"></a>ä½¿ç”¨å«æœ‰ä¸¤ä¸ªå…ƒç´ çš„æšä¸¾ä»£æ›¿booleanç±»å‹</h3><p>ä½¿ç”¨æšä¸¾ä¸ä»…å¯è¯»æ€§æ›´å¼ºï¼Œè€Œä¸”æ›´å®¹æ˜“æ‰©å±•ï¼Œå¯ä»¥æ·»åŠ å…¶ä»–é€‰é¡¹å’Œåšè½¬æ¢å¤„ç†ç­‰ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Methods&quot;&gt;&lt;a href=&quot;#Methods&quot; class=&quot;headerlink&quot; title=&quot;Methods&quot;&gt;&lt;/a&gt;Methods&lt;/h1&gt;&lt;p&gt;â€œusability, robustness, and flexibility.â€&lt;/p&gt;
&lt;p&gt;æ‘˜å½•æ¥è‡ª: Joshua Bloch. â€œEffective JavaÂ™ (Jason Arnoldâ€™s Library)â€ã€‚ iBooks. &lt;/p&gt;
&lt;h2 id=&quot;u68C0_u67E5_u53C2_u6570_u6709_u6548_u6027_28check_validity_of_params_29&quot;&gt;&lt;a href=&quot;#u68C0_u67E5_u53C2_u6570_u6709_u6548_u6027_28check_validity_of_params_29&quot; class=&quot;headerlink&quot; title=&quot;æ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§(check validity of params)&quot;&gt;&lt;/a&gt;æ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§(check validity of params)&lt;/h2&gt;&lt;p&gt;æ—©æ£€æŸ¥æ—©å‘ç°æ—©é¿å…é—®é¢˜ã€‚Fail fast!&lt;/p&gt;
&lt;p&gt;æœªæ£€æŸ¥å‚æ•°æœ‰æ•ˆæ€§å¯èƒ½å¯¼è‡´çš„é—®é¢˜:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¤±è´¥å¹¶æŠ›å‡ºæ©ç›–é—®é¢˜çš„å¼‚å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;æ­£å¸¸è¿”å›ä½†æ˜¯è¿”å›çš„æ˜¯é”™è¯¯çš„ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;åŒæ ·æ˜¯æ­£å¸¸è¿”å›ï¼Œä½†æ˜¯åŸ‹ä¸‹äº†ç¥¸æ ¹ï¼Œå¯èƒ½äº§ç”Ÿäº†å…¶ä»–çŠ¶æ€æœ‰é—®é¢˜çš„æ•°æ®ï¼Œå¯¼è‡´åœ¨ä¸å®šæ—¶çš„å°†æ¥äº§ç”Ÿä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="java" scheme="http://yoursite.com/categories/java/"/>
    
    
      <category term="effective" scheme="http://yoursite.com/tags/effective/"/>
    
      <category term="java" scheme="http://yoursite.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>how-to-create-products-customers-love</title>
    <link href="http://yoursite.com/2016/05/14/how-to-create-products-customers-love/"/>
    <id>http://yoursite.com/2016/05/14/how-to-create-products-customers-love/</id>
    <published>2016-05-14T15:11:20.000Z</published>
    <updated>2016-11-24T10:19:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="My_Opinion"><a href="#My_Opinion" class="headerlink" title="My Opinion"></a>My Opinion</h1><p>ä¸€ä¸ªä¸é”™çš„å¼€å‘è€…æœ‰å¾ˆå¤§çš„æ½œåŠ›èƒ½æˆä¸ºä¸€ä¸ªä¸é”™çš„PMã€‚PMè¿™é‡Œä¸ä»…ä»…æŒ‡product manager but also means project manager. å‡ºäºå¯¹PMçš„å…´è¶£ï¼Œè¿‘æœŸåœ¨å°è¯•çœ‹ä¸€äº›PMç›¸å…³çš„ä¹¦ï¼Œæ€»ç»“äº†ä¸€äº›Keynoteä¾›åç»­å›é¡¾ã€‚</p>
<h1 id="u4EA7_u54C1_u7BA1_u7406_26amp_3B_u9879_u76EE_u7BA1_u7406"><a href="#u4EA7_u54C1_u7BA1_u7406_26amp_3B_u9879_u76EE_u7BA1_u7406" class="headerlink" title="äº§å“ç®¡ç†&amp;é¡¹ç›®ç®¡ç†"></a>äº§å“ç®¡ç†&amp;é¡¹ç›®ç®¡ç†</h1><ul>
<li>äº§å“ç®¡ç†æ›´å¤šæ˜¯æ¢ç´¢å®šä¹‰äº§å“åŠŸèƒ½ï¼ŒéªŒè¯äº§å“å¯è¡Œå¯ç”¨æ€§ï¼Œå‘ç°äº§å“ä»·å€¼ã€‚ åè°ƒäº¤äº’è®¾è®¡ï¼Œè§†è§‰è®¾è®¡ï¼ŒåŸå‹è®¾è®¡è¿›åº¦ä¸æµç¨‹ã€‚äº§å“åœ¨è®¾è®¡æ¯ä¸ªå‘¨æœŸå¼€å‘åŠŸèƒ½çš„æ—¶å€™å°½é‡ç•™å‡º20%çš„æ—¶é—´ä¾›å¼€å‘äººå‘˜ä¼˜åŒ–ä»£ç å’Œä¿®å¤å¯èƒ½çš„é—®é¢˜ã€‚(this is called headroom)</li>
<li>é¡¹ç›®ç®¡ç†æ§åˆ¶é¡¹ç›®è¿›åº¦ï¼Œåˆç†åˆ†é…èµ„æºï¼Œè§£å†³é¡¹ç›®è¿‡ç¨‹ä¸­å‡ºç°çš„å„ç§é—®é¢˜ï¼Œä¿è¯é¡¹ç›®æŒ‰æ—¶æŒ‰è´¨äº¤ä»˜ã€‚</li>
</ul>
<a id="more"></a>
<h1 id="u5BFB_u627E_u5408_u9002_u7684_u4EA7_u54C1_u7ECF_u7406"><a href="#u5BFB_u627E_u5408_u9002_u7684_u4EA7_u54C1_u7ECF_u7406" class="headerlink" title="å¯»æ‰¾åˆé€‚çš„äº§å“ç»ç†"></a>å¯»æ‰¾åˆé€‚çš„äº§å“ç»ç†</h1><p>å…¬å¸å†…éƒ¨å…¶ä»–å²—ä½ä¸Šçš„äººå‘˜ï¼Œå¼€å‘äººå‘˜ï¼Œè®¾è®¡äººå‘˜ç­‰éƒ½å¯èƒ½æ˜¯å¾ˆå¥½çš„äº§å“ç»ç†å¤‡é€‰äººå‘˜ï¼Œç­‰å¾…å‘æ˜ã€‚</p>
<h2 id="u4F18_u79C0_u4EA7_u54C1_u7ECF_u7406_u7684_u7D20_u8D28"><a href="#u4F18_u79C0_u4EA7_u54C1_u7ECF_u7406_u7684_u7D20_u8D28" class="headerlink" title="ä¼˜ç§€äº§å“ç»ç†çš„ç´ è´¨"></a>ä¼˜ç§€äº§å“ç»ç†çš„ç´ è´¨</h2><ol>
<li>å¯¹äº§å“çš„çƒ­æƒ…</li>
<li>ç”¨æˆ·ç«‹åœº</li>
<li>åˆ¤æ–­åŠ›å’Œå†³ç­–åŠ›</li>
<li>èŒä¸šæ“å®ˆ</li>
<li>ä¿¡å¿ƒ</li>
<li>æ€åº¦</li>
<li>æŠ€èƒ½</li>
<li>æ³¨æ„åŠ›</li>
<li>æ—¶é—´ç®¡ç†</li>
<li>æ²Ÿé€šæŠ€èƒ½</li>
<li>å•†ä¸šæŠ€èƒ½<br>PMé€šå¸¸éœ€è¦ä¸ä¸Šçº§å…¶ä»–éƒ¨é—¨æ²Ÿé€šï¼Œä¸ºäº†ä½¿æ²Ÿé€šæœ‰æ•ˆéœ€è¦ç†Ÿæ‚‰ä»–ä»¬å¸¸è¯´çš„æ¦‚å¿µå’Œæœ¯è¯­ã€‚å¦‚æˆåŠŸæ„æˆï¼Œè¾¹é™…æ•ˆåº”ï¼Œå¸‚åœºä»½é¢ï¼Œäº§å“å®šä½å’Œå“ç‰Œç­‰ã€‚æ‰€ä»¥éœ€è¦ä¸€å®šçš„å•†ä¸šæŠ€èƒ½ã€‚</li>
</ol>
<h1 id="u7BA1_u7406_u4EA7_u54C1_u7ECF_u7406"><a href="#u7BA1_u7406_u4EA7_u54C1_u7ECF_u7406" class="headerlink" title="ç®¡ç†äº§å“ç»ç†"></a>ç®¡ç†äº§å“ç»ç†</h1><p>è¿™ä»½å·¥ä½œé€šå¸¸ç”±äº§å“æ€»ç›‘æ¥å®Œæˆã€‚ä¸»è¦æœ‰ä¸¤æ–¹é¢çš„èŒè´£:</p>
<ol>
<li>ç»„å»ºä¼˜ç§€çš„äº§å“å›¢é˜Ÿã€‚</li>
<li>è§„åˆ’äº§å“å…¨å±€æˆ˜ç•¥ï¼Œå¯¹äº§å“ç»„åˆè´Ÿè´£ã€‚</li>
</ol>
<h2 id="u5EFA_u8BBE_u4EA7_u54C1_u56E2_u961F"><a href="#u5EFA_u8BBE_u4EA7_u54C1_u56E2_u961F" class="headerlink" title="å»ºè®¾äº§å“å›¢é˜Ÿ"></a>å»ºè®¾äº§å“å›¢é˜Ÿ</h2><p>ç®€å•æ¥è¯´ï¼Œå‘ç°é€‚åˆåšäº§å“ç®¡ç†çš„äººå‘˜ï¼ŒåŒæ—¶æ‰¾å‡ºä¸é€‚åˆçš„äººå‘˜ã€‚å‘ç°æœ‰åšäº§å“æ½œè´¨çš„äººå‘˜æ—¶ï¼Œåº”å°½é‡ç»™äºˆå…¶è¶³å¤Ÿçš„æ—¶é—´å’Œä¿¡ä»»å¹¶ç›‘ç£å’ŒæŒ‡å¯¼å…¶ä¸æ–­è¿›æ­¥ï¼Œè¿™æ ·ä¸ä»…æé«˜äº†æ‰‹ä¸‹çš„èƒ½åŠ›ï¼Œä¹Ÿæ˜¯å¯¹è‡ªå·±èƒ½åŠ›çš„ä¸€ç§æ‰©å¤§ï¼Œæ‰‹ä¸‹äº§å“åšå¾—å¥½ä¹Ÿå°±æ˜¯è‡ªå·±äº§å“åšå¾—å¥½ã€‚æœ‰äº›äººå¤©ç”Ÿå°±ä¸åˆé€‚åšäº§å“ï¼Œæ‰€ä»¥éœ€è¦åŠæ—¶å‘ç°ä»¥å…æµªè´¹ç ”å‘çš„æ—¶é—´å’Œå¤±å»ç”¨æˆ·å¯¹äº§å“çš„ä¿¡ä»»ã€‚</p>
<h2 id="u89C4_u5212_u516C_u53F8_u7684_u4EA7_u54C1_u6218_u7565"><a href="#u89C4_u5212_u516C_u53F8_u7684_u4EA7_u54C1_u6218_u7565" class="headerlink" title="è§„åˆ’å…¬å¸çš„äº§å“æˆ˜ç•¥"></a>è§„åˆ’å…¬å¸çš„äº§å“æˆ˜ç•¥</h2><p>ç»“åˆå…¬å¸çš„å•†ä¸šæˆ˜ç•¥è§„åˆ’äº§å“æˆ˜ç•¥ï¼Œåšåˆ°å•†ä¸šä¸ç”¨æˆ·éœ€æ±‚çš„å®Œç¾ç»“åˆã€‚åŒæ—¶éœ€è¦è§£å†³ä¸åŒäº§å“ç»ç†æå‡ºçš„æ–¹æ¡ˆçš„å†²çªï¼Œåšå¥½æ•´ä½“äº§å“çš„ç»„åˆå’Œè§„åˆ’ã€‚</p>
<h1 id="u5DF4_u987F_u5C06_u519B_u7684_u5FE0_u544A"><a href="#u5DF4_u987F_u5C06_u519B_u7684_u5FE0_u544A" class="headerlink" title="å·´é¡¿å°†å†›çš„å¿ å‘Š"></a>å·´é¡¿å°†å†›çš„å¿ å‘Š</h1><h2 id="u76EE_u6807_u7BA1_u7406"><a href="#u76EE_u6807_u7BA1_u7406" class="headerlink" title="ç›®æ ‡ç®¡ç†"></a>ç›®æ ‡ç®¡ç†</h2><p>åœ¨æ„æ€ä¸€ä¸ªäº§å“åŠŸèƒ½ä¸”æœªå½¢æˆæœ€ç»ˆæ–¹æ¡ˆçš„æ—¶å€™ï¼Œåº”è¯¥å……åˆ†å‘æŒ¥è§†è§‰è®¾è®¡ï¼Œäº¤äº’è®¾è®¡å¸ˆçš„ä¸ªäººåˆ›é€ åŠ›ï¼Œåº”è¯¥å‘Šè¯‰ä»–ä»¬æ¥ä¸‹æ¥è¦åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯å‘Šè¯‰ä»–ä»¬å¦‚ä½•åšã€‚è®©ä»–ä»¬æ ¹æ®è‡ªå·±å¯¹å¸‚åœºçš„ç†è§£å’Œå¯¹ç”¨æˆ·çš„è°ƒç ”æ¥å‘æŒ¥æƒ³è±¡ã€‚</p>
<h1 id="u8BC4_u4F30_u4EA7_u54C1_u673A_u4F1A"><a href="#u8BC4_u4F30_u4EA7_u54C1_u673A_u4F1A" class="headerlink" title="è¯„ä¼°äº§å“æœºä¼š"></a>è¯„ä¼°äº§å“æœºä¼š</h1><p>è¯„ä¼°äº§å“æœºä¼šæ˜¯äº§å“ç»ç†çš„é‡è¦èŒè´£ï¼Œé€šè¿‡è¯„ä¼°äº§å“æœºä¼šå¯ä»¥æ·˜æ±°bad idea,é¿å…èµ„æºæµªè´¹ã€‚å°¤å…¶å¯¹äºèµ„æºæœ‰é™çš„åˆ›ä¸šå…¬å¸è€Œè¨€ã€‚</p>
<p>ä¸ºäº†è¯„ä¼°äº§å“æœºä¼šï¼Œå¯ä»¥è¦æ±‚äº§å“ç»ç†å›ç­”ä»¥ä¸‹å‡ ä¸ªé—®é¢˜:</p>
<ol>
<li>äº§å“è¦è§£å†³ä»€ä¹ˆé—®é¢˜?(äº§å“ä»·å€¼)</li>
<li>ä¸ºè°è§£å†³è¿™ä¸ªé—®é¢˜?(ç›®æ ‡å¸‚åœº)</li>
<li>æˆåŠŸçš„æœºä¼šæœ‰å¤šå¤§?(å¸‚åœºè§„æ¨¡)</li>
<li>æ€æ ·åˆ¤æ–­äº§å“æˆåŠŸä¸å¦?(åº¦é‡æŒ‡æ ‡æˆ–æ”¶ç›ŠæŒ‡æ ‡)</li>
<li>æœ‰å“ªäº›åŒç±»äº§å“?(ç«å“åˆ†æ)</li>
<li>ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ€é€‚åˆåšè¿™ä¸ªäº§å“?(ç«äº‰ä¼˜åŠ¿)</li>
<li>æ—¶æœºæ˜¯å¦åˆé€‚?(å¸‚åœºæ—¶æœº)</li>
<li>å¦‚ä½•æŠŠäº§å“æ¨å‘å¸‚åœº?(è¥é”€ç»„åˆç­–ç•¥)</li>
<li>æˆåŠŸçš„å¿…è¦æ¡ä»¶æ˜¯ä»€ä¹ˆ?(è§£å†³æ–¹æ¡ˆè¦æ»¡è¶³çš„æ¡ä»¶) </li>
<li>æ ¹æ®ä»¥ä¸Šé—®é¢˜ï¼Œå¾—å‡ºè¯„ä¼°ç»“è®º?(ç»§ç»­æˆ–æ”¾å¼ƒ)</li>
</ol>
<p>è¯„ä¼°äº§å“æœºä¼šçš„æ—¶å€™ä¸åº”è¯¥ä¸å…·ä½“è§£å†³æ–¹æ¡ˆä¸€èµ·è®¨è®ºï¼Œå¦åˆ™å®¹æ˜“é€ æˆå…·ä½“æ–¹æ¡ˆé‡åˆ°å›°éš¾æ—¶å°±ç›´æ¥æŠŠäº§å“æœºä¼šä¸€èµ·å¦å®šæ‰ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;My_Opinion&quot;&gt;&lt;a href=&quot;#My_Opinion&quot; class=&quot;headerlink&quot; title=&quot;My Opinion&quot;&gt;&lt;/a&gt;My Opinion&lt;/h1&gt;&lt;p&gt;ä¸€ä¸ªä¸é”™çš„å¼€å‘è€…æœ‰å¾ˆå¤§çš„æ½œåŠ›èƒ½æˆä¸ºä¸€ä¸ªä¸é”™çš„PMã€‚PMè¿™é‡Œä¸ä»…ä»…æŒ‡product manager but also means project manager. å‡ºäºå¯¹PMçš„å…´è¶£ï¼Œè¿‘æœŸåœ¨å°è¯•çœ‹ä¸€äº›PMç›¸å…³çš„ä¹¦ï¼Œæ€»ç»“äº†ä¸€äº›Keynoteä¾›åç»­å›é¡¾ã€‚&lt;/p&gt;
&lt;h1 id=&quot;u4EA7_u54C1_u7BA1_u7406_26amp_3B_u9879_u76EE_u7BA1_u7406&quot;&gt;&lt;a href=&quot;#u4EA7_u54C1_u7BA1_u7406_26amp_3B_u9879_u76EE_u7BA1_u7406&quot; class=&quot;headerlink&quot; title=&quot;äº§å“ç®¡ç†&amp;amp;é¡¹ç›®ç®¡ç†&quot;&gt;&lt;/a&gt;äº§å“ç®¡ç†&amp;amp;é¡¹ç›®ç®¡ç†&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;äº§å“ç®¡ç†æ›´å¤šæ˜¯æ¢ç´¢å®šä¹‰äº§å“åŠŸèƒ½ï¼ŒéªŒè¯äº§å“å¯è¡Œå¯ç”¨æ€§ï¼Œå‘ç°äº§å“ä»·å€¼ã€‚ åè°ƒäº¤äº’è®¾è®¡ï¼Œè§†è§‰è®¾è®¡ï¼ŒåŸå‹è®¾è®¡è¿›åº¦ä¸æµç¨‹ã€‚äº§å“åœ¨è®¾è®¡æ¯ä¸ªå‘¨æœŸå¼€å‘åŠŸèƒ½çš„æ—¶å€™å°½é‡ç•™å‡º20%çš„æ—¶é—´ä¾›å¼€å‘äººå‘˜ä¼˜åŒ–ä»£ç å’Œä¿®å¤å¯èƒ½çš„é—®é¢˜ã€‚(this is called headroom)&lt;/li&gt;
&lt;li&gt;é¡¹ç›®ç®¡ç†æ§åˆ¶é¡¹ç›®è¿›åº¦ï¼Œåˆç†åˆ†é…èµ„æºï¼Œè§£å†³é¡¹ç›®è¿‡ç¨‹ä¸­å‡ºç°çš„å„ç§é—®é¢˜ï¼Œä¿è¯é¡¹ç›®æŒ‰æ—¶æŒ‰è´¨äº¤ä»˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="PM" scheme="http://yoursite.com/tags/PM/"/>
    
  </entry>
  
  <entry>
    <title>Build-rest-api</title>
    <link href="http://yoursite.com/2016/04/27/Build-rest-api/"/>
    <id>http://yoursite.com/2016/04/27/Build-rest-api/</id>
    <published>2016-04-27T08:41:13.000Z</published>
    <updated>2016-11-24T10:19:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Why_REST_3F"><a href="#Why_REST_3F" class="headerlink" title="Why REST?"></a>Why REST?</h1><ol>
<li>Scalability</li>
<li>Generality</li>
<li>Independence</li>
<li>Latency (Caching)</li>
<li>Security</li>
<li>Encapsulation</li>
</ol>
<h1 id="Why_JSON_3F"><a href="#Why_JSON_3F" class="headerlink" title="Why JSON?"></a>Why JSON?</h1><ol>
<li>Ubiquity</li>
<li>Simplicity</li>
<li>Readability</li>
<li>Scalability</li>
<li>Flexibility</li>
</ol>
<a id="more"></a>
<h1 id="Keep_it_simple"><a href="#Keep_it_simple" class="headerlink" title="Keep it simple"></a>Keep it simple</h1><p>Restç®€å•ç†è§£å°±æ˜¯å¯¹èµ„æºçš„ç®¡ç†ã€‚èµ„æºå¯åˆ†ä¸ºåŸºæœ¬çš„ä¸¤ç±»:</p>
<ol>
<li>é›†åˆèµ„æº, <code>/resources</code></li>
<li>å•ä¸ªèµ„æº, <code>/resources/123</code></li>
</ol>
<p>åœ¨å¯¹èµ„æºè¿›è¡Œå‘½åæ—¶ï¼Œä¸ç”¨çº ç»“ä½¿ç”¨å•æ•°è¿˜æ˜¯å¤æ•°ï¼Œæœ€å¥½å§‹ç»ˆé‡‡ç”¨å¤æ•°å½¢å¼ï¼Œä¿æŒURLçš„ç®€å•å’Œä¸€è‡´ã€‚</p>
<h1 id="HTTP_Verb"><a href="#HTTP_Verb" class="headerlink" title="HTTP Verb"></a>HTTP Verb</h1><p>è¿™ä¸ªå¦‚ä»Šåˆ°å¤„éƒ½æœ‰è®²è§£ï¼Œæˆ‘å°±ç®€å•è¯´æ˜ä¸€ä¸‹ã€‚</p>
<ol>
<li>GET = Read</li>
<li>PUT</li>
<li>POST</li>
<li>PATCH = Partially updates</li>
<li>DELETE = Delete</li>
<li>HEAD = Headers, no Body</li>
</ol>
<p>è¿™å‡ ä¸ªVerbså¹¶éä¸CRUDä¸€ä¸€å¯¹åº”çš„, <code>^_^</code> . PUTå’ŒPOSTè¿™ä¸¤ä¸ªéƒ½å¯ä»¥ç”¨æ¥createå’Œupdate,ä½†ä»–ä»¬è¿˜æ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«çš„ã€‚</p>
<h2 id="PUT_-_Create"><a href="#PUT_-_Create" class="headerlink" title="PUT - Create"></a>PUT - Create</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">PUT</span> /<span class="tag">resources</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    æ ¹æ®æä¾›çš„æ•°æ®æ›¿æ¢ç°æœ‰çš„å…¨éƒ¨ç›¸å…³çš„èµ„æº</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="PUT_-_Update"><a href="#PUT_-_Update" class="headerlink" title="PUT - Update"></a>PUT - Update</h2><p>æ ¹æ®æŒ‡å®šçš„ID create or updateç°æœ‰çš„èµ„æºã€‚</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT /resources/<span class="property">id</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    æ ¹æ®<span class="property">id</span>æ›´æ–°æˆ–è€…æ–°å»ºä¸€ä¸ªèµ„æº</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="POST_-_Create"><a href="#POST_-_Create" class="headerlink" title="POST - Create"></a>POST - Create</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /resources</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"desc"</span>: <span class="string">"i am gonna be created every time"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Response:</span><br><span class="line"></span><br><span class="line"><span class="number">201</span> Created</span><br><span class="line">Location: https:<span class="comment">//api.daveztong.com/resources/123x</span></span><br><span class="line"></span><br><span class="line">å…¶ä¸­<span class="number">123</span>xæ˜¯æ–°å»ºçš„èµ„æºID</span><br></pre></td></tr></table></figure>
<h2 id="POST_-_Update"><a href="#POST_-_Update" class="headerlink" title="POST - Update"></a>POST - Update</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /resources/<span class="number">123</span>x</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"desc"</span>: <span class="string">"123xè¢«å½“åšæ˜¯ä¸€ä¸ªé›†åˆ,å¹¶åˆ›å»ºä¸€ä¸ªå±äº123xçš„èµ„æº"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Response:</span><br><span class="line"><span class="number">200</span> OK</span><br></pre></td></tr></table></figure>
<h2 id="The_difference_3F"><a href="#The_difference_3F" class="headerlink" title="The difference?"></a>The difference?</h2><p>PUTæ“ä½œæ˜¯å¹‚ç­‰çš„,POSTéå¹‚ç­‰ã€‚PUTçš„æ¯ä¸€æ¬¡æ“ä½œåœ¨æ—¢å®šæƒ…å†µä¸‹éƒ½å¾—åˆ°ç›¸åŒçš„ç»“æœ,POSTå´æ˜¯æ¯ä¸€æ¬¡éƒ½ä¸åŒã€‚</p>
<h1 id="Best_practises"><a href="#Best_practises" class="headerlink" title="Best practises"></a>Best practises</h1><h3 id="u57FA_u7840"><a href="#u57FA_u7840" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><h4 id="u9694_u79BB_u5173_u6CE8_u70B9"><a href="#u9694_u79BB_u5173_u6CE8_u70B9" class="headerlink" title="éš”ç¦»å…³æ³¨ç‚¹"></a>éš”ç¦»å…³æ³¨ç‚¹</h4><p>è®¾è®¡æ—¶é€šè¿‡å°†è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„ä¸åŒéƒ¨åˆ†éš”ç¦»æ¥è®©äº‹æƒ…å˜å¾—ç®€å•ã€‚ä¿æŒç®€å•çš„è§„åˆ™è®©æˆ‘ä»¬èƒ½æ›´å…³æ³¨åœ¨ä¸€äº›æ›´å¤§çš„æ›´å›°éš¾çš„é—®é¢˜ä¸Šã€‚</p>
<p>è¯·æ±‚å’Œå“åº”å°†è§£å†³ä¸€ä¸ªç‰¹å®šçš„èµ„æºæˆ–é›†åˆã€‚ä½¿ç”¨è·¯å¾„ï¼ˆpathï¼‰æ¥è¡¨æ˜èº«ä»½ï¼Œbodyæ¥ä¼ è¾“å†…å®¹ï¼ˆcontentï¼‰è¿˜æœ‰å¤´ä¿¡æ¯ï¼ˆheaderï¼‰æ¥ä¼ é€’å…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€‚æŸ¥è¯¢å‚æ•°åŒæ ·å¯ä»¥ç”¨æ¥ä¼ é€’å¤´ä¿¡æ¯çš„å†…å®¹ï¼Œä½†å¤´ä¿¡æ¯æ˜¯é¦–é€‰ï¼Œå› ä¸ºä»–ä»¬æ›´çµæ´»ã€æ›´èƒ½ä¼ è¾¾ä¸åŒçš„ä¿¡æ¯ã€‚</p>
<h4 id="u5F3A_u5236_u4F7F_u7528_u5B89_u5168_u8FDE_u63A5_uFF08Secure_Connections_uFF09"><a href="#u5F3A_u5236_u4F7F_u7528_u5B89_u5168_u8FDE_u63A5_uFF08Secure_Connections_uFF09" class="headerlink" title="å¼ºåˆ¶ä½¿ç”¨å®‰å…¨è¿æ¥ï¼ˆSecure Connectionsï¼‰"></a>å¼ºåˆ¶ä½¿ç”¨å®‰å…¨è¿æ¥ï¼ˆSecure Connectionsï¼‰</h4><p>æ‰€æœ‰çš„è®¿é—®APIè¡Œä¸ºï¼Œéƒ½éœ€è¦ç”¨ TLS é€šè¿‡å®‰å…¨è¿æ¥æ¥è®¿é—®ã€‚æ²¡æœ‰å¿…è¦ææ¸…æˆ–è§£é‡Šä»€ä¹ˆæƒ…å†µéœ€è¦ TLS ä»€ä¹ˆæƒ…å†µä¸éœ€è¦ TLSï¼Œç›´æ¥å¼ºåˆ¶ä»»ä½•è®¿é—®éƒ½è¦é€šè¿‡ TLSã€‚</p>
<p>ç†æƒ³çŠ¶æ€ä¸‹ï¼Œé€šè¿‡æ‹’ç»æ‰€æœ‰é TLS è¯·æ±‚ï¼Œä¸å“åº” http æˆ–80ç«¯å£çš„è¯·æ±‚ä»¥é¿å…ä»»ä½•ä¸å®‰å…¨çš„æ•°æ®äº¤æ¢ã€‚å¦‚æœç°å®æƒ…å†µä¸­æ— æ³•è¿™æ ·åšï¼Œå¯ä»¥è¿”å›<code>403 Forbidden</code>å“åº”ã€‚</p>
<p>æŠŠé TLS çš„è¯·æ±‚é‡å®šå‘(Redirect)è‡³ TLS è¿æ¥æ˜¯ä¸æ˜æ™ºçš„ï¼Œè¿™ç§å«æ··/ä¸å¥½çš„å®¢æˆ·ç«¯è¡Œä¸ºä¸ä¼šå¸¦æ¥æ˜æ˜¾å¥½å¤„ã€‚ä¾èµ–äºé‡å®šå‘çš„å®¢æˆ·ç«¯è®¿é—®ä¸ä»…ä¼šå¯¼è‡´åŒå€çš„æœåŠ¡å™¨è´Ÿè½½ï¼Œè¿˜ä¼šä½¿ TLS åŠ å¯†å¤±å»æ„ä¹‰ï¼Œå› ä¸ºåœ¨é¦–æ¬¡é TLS è°ƒç”¨æ—¶ï¼Œæ•æ„Ÿä¿¡æ¯å°±å·²ç»æš´éœ²å‡ºå»äº†ã€‚</p>
<h4 id="u5F3A_u5236_u5934_u4FE1_u606F_Accept__u4E2D_u63D0_u4F9B_u7248_u672C_u53F7"><a href="#u5F3A_u5236_u5934_u4FE1_u606F_Accept__u4E2D_u63D0_u4F9B_u7248_u672C_u53F7" class="headerlink" title="å¼ºåˆ¶å¤´ä¿¡æ¯ Accept ä¸­æä¾›ç‰ˆæœ¬å·"></a>å¼ºåˆ¶å¤´ä¿¡æ¯ Accept ä¸­æä¾›ç‰ˆæœ¬å·</h4><p>åˆ¶å®šç‰ˆæœ¬å¹¶åœ¨ç‰ˆæœ¬ä¹‹é—´å¹³ç¼“è¿‡æ¸¡å¯¹äºè®¾è®¡å’Œç»´æŠ¤ä¸€å¥—APIæ˜¯ä¸ªå·¨å¤§çš„æŒ‘æˆ˜ã€‚æ‰€ä»¥ï¼Œæœ€å¥½åœ¨è®¾è®¡ä¹‹åˆå°±ä½¿ç”¨ä¸€äº›æ–¹æ³•æ¥é¢„é˜²å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>ä¸ºäº†é¿å…APIçš„å˜åŠ¨å¯¼è‡´ç”¨æˆ·ä½¿ç”¨ä¸­äº§ç”Ÿæ„å¤–ç»“æœæˆ–è°ƒç”¨å¤±è´¥ï¼Œ<strong>æœ€å¥½å¼ºåˆ¶è¦æ±‚æ‰€æœ‰è®¿é—®éƒ½éœ€è¦æŒ‡å®šç‰ˆæœ¬å·ã€‚è¯·é¿å…æä¾›é»˜è®¤ç‰ˆæœ¬å·ï¼Œä¸€æ—¦æä¾›ï¼Œæ—¥åæƒ³è¦ä¿®æ”¹å®ƒä¼šç›¸å½“å›°éš¾ã€‚</strong></p>
<p>æœ€é€‚åˆæ”¾ç½®ç‰ˆæœ¬å·çš„ä½ç½®æ˜¯å¤´ä¿¡æ¯(HTTP Headers)ï¼Œåœ¨ <code>Accept</code> æ®µä¸­ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹(content type)ä¸å…¶ä»–å…ƒæ•°æ®(metadata)ä¸€èµ·æäº¤ã€‚ä¾‹å¦‚:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accept: <span class="type">application</span>/vnd.heroku+json; <span class="property">version</span>=<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h4 id="u652F_u6301Etag_u7F13_u5B58"><a href="#u652F_u6301Etag_u7F13_u5B58" class="headerlink" title="æ”¯æŒEtagç¼“å­˜"></a>æ”¯æŒEtagç¼“å­˜</h4><p>åœ¨æ‰€æœ‰è¿”å›çš„å“åº”ä¸­åŒ…å«<code>ETag</code>å¤´ä¿¡æ¯ï¼Œç”¨æ¥æ ‡è¯†èµ„æºçš„ç‰ˆæœ¬ã€‚è¿™è®©ç”¨æˆ·å¯¹èµ„æºè¿›è¡Œç¼“å­˜å¤„ç†æˆä¸ºå¯èƒ½ï¼Œåœ¨åç»­çš„è®¿é—®è¯·æ±‚ä¸­æŠŠ<code>If-None-Match</code>å¤´ä¿¡æ¯è®¾ç½®ä¸ºä¹‹å‰å¾—åˆ°çš„<code>ETag</code>å€¼ï¼Œå°±å¯ä»¥ä¾¦æµ‹åˆ°å·²ç¼“å­˜çš„èµ„æºæ˜¯å¦éœ€è¦æ›´æ–°ã€‚</p>
<h4 id="u4E3A_u5185_u7701_u800C_u63D0_u4F9B_Request-Id"><a href="#u4E3A_u5185_u7701_u800C_u63D0_u4F9B_Request-Id" class="headerlink" title="ä¸ºå†…çœè€Œæä¾› Request-Id"></a>ä¸ºå†…çœè€Œæä¾› Request-Id</h4><p>ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚å“åº”åŒ…å«ä¸€ä¸ª<code>Request-Id</code>å¤´ï¼Œå¹¶ä½¿ç”¨UUIDä½œä¸ºè¯¥å€¼ã€‚é€šè¿‡åœ¨å®¢æˆ·ç«¯ã€æœåŠ¡å™¨æˆ–ä»»ä½•æ”¯æŒæœåŠ¡ä¸Šè®°å½•è¯¥å€¼ï¼Œå®ƒèƒ½ä¸ºæˆ‘ä»¬æä¾›ä¸€ç§æœºåˆ¶æ¥è·Ÿè¸ªã€è¯Šæ–­å’Œè°ƒè¯•è¯·æ±‚ã€‚</p>
<p>###è¯·æ±‚ï¼ˆRequestsï¼‰</p>
<h4 id="u5728_u8BF7_u6C42_u7684body_u4F53_u4F7F_u7528JSON_u683C_u5F0F_u6570_u636E"><a href="#u5728_u8BF7_u6C42_u7684body_u4F53_u4F7F_u7528JSON_u683C_u5F0F_u6570_u636E" class="headerlink" title="åœ¨è¯·æ±‚çš„bodyä½“ä½¿ç”¨JSONæ ¼å¼æ•°æ®"></a>åœ¨è¯·æ±‚çš„bodyä½“ä½¿ç”¨JSONæ ¼å¼æ•°æ®</h4><p>åœ¨ <code>PUT</code>/<code>PATCH</code>/<code>POST</code> è¯·æ±‚çš„æ­£æ–‡ï¼ˆrequest bodiesï¼‰ä¸­ä½¿ç”¨JSONæ ¼å¼æ•°æ®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ form è¡¨å•å½¢å¼çš„æ•°æ®ã€‚è¿™ä¸æˆ‘ä»¬ä½¿ç”¨JSONæ ¼å¼è¿”å›è¯·æ±‚ç›¸å¯¹åº”ï¼Œä¾‹å¦‚:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X <span class="keyword">POST</span> https:<span class="comment">//service.com/apps \</span></span><br><span class="line">    -<span class="keyword">H</span> <span class="string">"Content-Type: application/json"</span> \</span><br><span class="line">    -<span class="keyword">d</span> '&#123;<span class="string">"name"</span>: <span class="string">"demoapp"</span>&#125;'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"id"</span>: <span class="string">"01234567-89ab-cdef-0123-456789abcdef"</span>,</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"demoapp"</span>,</span><br><span class="line">  <span class="string">"owner"</span>: &#123;</span><br><span class="line">    <span class="string">"email"</span>: <span class="string">"username@example.com"</span>,</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"01234567-89ab-cdef-0123-456789abcdef"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u4F7F_u7528_u7EDF_u4E00_u7684_u8D44_u6E90_u8DEF_u5F84_u683C_u5F0F"><a href="#u4F7F_u7528_u7EDF_u4E00_u7684_u8D44_u6E90_u8DEF_u5F84_u683C_u5F0F" class="headerlink" title="ä½¿ç”¨ç»Ÿä¸€çš„èµ„æºè·¯å¾„æ ¼å¼"></a>ä½¿ç”¨ç»Ÿä¸€çš„èµ„æºè·¯å¾„æ ¼å¼</h4><h5 id="u8D44_u6E90_u540D_uFF08Resource_names_uFF09"><a href="#u8D44_u6E90_u540D_uFF08Resource_names_uFF09" class="headerlink" title="èµ„æºåï¼ˆResource namesï¼‰"></a>èµ„æºåï¼ˆResource namesï¼‰</h5><p>ä½¿ç”¨å¤æ•°å½¢å¼ä¸ºèµ„æºå‘½åï¼Œé™¤éè¿™ä¸ªèµ„æºåœ¨ç³»ç»Ÿä¸­æ˜¯å•ä¾‹çš„ (ä¾‹å¦‚ï¼Œåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼Œç»™å®šçš„ç”¨æˆ·å¸æˆ·åªæœ‰ä¸€ä¸ª)ã€‚ è¿™ç§æ–¹å¼ä¿æŒäº†ç‰¹å®šèµ„æºçš„ç»Ÿä¸€æ€§ã€‚</p>
<h5 id="u884C_u4E3A_uFF08Actions_uFF09"><a href="#u884C_u4E3A_uFF08Actions_uFF09" class="headerlink" title="è¡Œä¸ºï¼ˆActionsï¼‰"></a>è¡Œä¸ºï¼ˆActionsï¼‰</h5><p>å¥½çš„æœ«å°¾ä¸éœ€è¦ä¸ºèµ„æºæŒ‡å®šç‰¹æ®Šçš„è¡Œä¸ºï¼Œä½†åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œä¸ºæŸäº›èµ„æºæŒ‡å®šè¡Œä¸ºå´æ˜¯å¿…è¦çš„ã€‚ä¸ºäº†æè¿°æ¸…æ¥šï¼Œåœ¨è¡Œä¸ºå‰åŠ ä¸Šä¸€ä¸ªæ ‡å‡†çš„<code>actions</code>ï¼š</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/resources/<span class="symbol">:resource/actions/</span><span class="symbol">:action</span></span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/tasks/</span>&#123;taskId&#125;<span class="regexp">/actions/</span>stop</span><br></pre></td></tr></table></figure>
<h4 id="u7EDF_u4E00_u547D_u540D_2C_u91C7_u7528camelCase_u6216_u8005_u4E0B_u5212_u7EBF_u65B9_u5F0F"><a href="#u7EDF_u4E00_u547D_u540D_2C_u91C7_u7528camelCase_u6216_u8005_u4E0B_u5212_u7EBF_u65B9_u5F0F" class="headerlink" title="ç»Ÿä¸€å‘½å,é‡‡ç”¨camelCaseæˆ–è€…ä¸‹åˆ’çº¿æ–¹å¼"></a>ç»Ÿä¸€å‘½å,é‡‡ç”¨camelCaseæˆ–è€…ä¸‹åˆ’çº¿æ–¹å¼</h4><p>ä¸ç®¡é€‰æ‹©å“ªä¸€ç§ï¼Œåªè¦ä¸€æ—¦é€‰æ‹©äº†å°±åº”è¯¥å§‹ç»ˆä¿æŒåŒä¸€ä¸ªé£æ ¼ã€‚</p>
<h4 id="u6700_u5C0F_u5316_u8DEF_u5F84_u5D4C_u5957"><a href="#u6700_u5C0F_u5316_u8DEF_u5F84_u5D4C_u5957" class="headerlink" title="æœ€å°åŒ–è·¯å¾„åµŒå¥—"></a>æœ€å°åŒ–è·¯å¾„åµŒå¥—</h4><p>åœ¨ä¸€äº›æœ‰çˆ¶è·¯å¾„/å­è·¯å¾„åµŒå¥—å…³ç³»çš„èµ„æºæ•°æ®æ¨¡å—ä¸­ï¼Œè·¯å¾„å¯èƒ½æœ‰éå¸¸æ·±çš„åµŒå¥—å…³ç³»ï¼Œä¾‹å¦‚:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/orgs/</span>&#123;orgId&#125;<span class="regexp">/apps/</span>&#123;appId&#125;<span class="regexp">/dynos/</span>&#123;dynoId&#125;</span><br></pre></td></tr></table></figure>
<p>æ¨èåœ¨æ ¹(root)è·¯å¾„ä¸‹æŒ‡å®šèµ„æºæ¥é™åˆ¶è·¯å¾„çš„åµŒå¥—æ·±åº¦ã€‚ä½¿ç”¨åµŒå¥—æŒ‡å®šèŒƒå›´çš„èµ„æºã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œdynoå±äºappï¼Œappå±äºorgå¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/orgs/</span>&#123;orgId&#125;</span><br><span class="line"><span class="regexp">/orgs/</span>&#123;orgId&#125;/apps</span><br><span class="line"><span class="regexp">/apps/</span>&#123;appId&#125;</span><br><span class="line"><span class="regexp">/apps/</span>&#123;appId&#125;/dynos</span><br><span class="line"><span class="regexp">/dynos/</span>&#123;dynoId&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u54CD_u5E94_uFF08Responses_uFF09"><a href="#u54CD_u5E94_uFF08Responses_uFF09" class="headerlink" title="å“åº”ï¼ˆResponsesï¼‰"></a>å“åº”ï¼ˆResponsesï¼‰</h3><h4 id="u8FD4_u56DE_u5408_u9002_u7684_u72B6_u6001_u7801"><a href="#u8FD4_u56DE_u5408_u9002_u7684_u72B6_u6001_u7801" class="headerlink" title="è¿”å›åˆé€‚çš„çŠ¶æ€ç "></a>è¿”å›åˆé€‚çš„çŠ¶æ€ç </h4><p>ä¸ºæ¯ä¸€æ¬¡çš„å“åº”è¿”å›åˆé€‚çš„HTTPçŠ¶æ€ç ã€‚ å¥½çš„å“åº”åº”è¯¥ä½¿ç”¨å¦‚ä¸‹çš„çŠ¶æ€ç :</p>
<ul>
<li><code>200</code>: <code>GET</code>è¯·æ±‚æˆåŠŸï¼ŒåŠ<code>DELETE</code>æˆ–<code>PATCH</code>åŒæ­¥è¯·æ±‚å®Œæˆï¼Œæˆ–è€…<code>PUT</code>åŒæ­¥æ›´æ–°ä¸€ä¸ªå·²å­˜åœ¨çš„èµ„æº</li>
<li><code>201</code>: <code>POST</code> åŒæ­¥è¯·æ±‚å®Œæˆï¼Œæˆ–è€…<code>PUT</code>åŒæ­¥åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æº</li>
<li><code>202</code>: <code>POST</code>ï¼Œ<code>PUT</code>ï¼Œ<code>DELETE</code>ï¼Œæˆ–<code>PATCH</code>è¯·æ±‚æ¥æ”¶ï¼Œå°†è¢«å¼‚æ­¥å¤„ç†</li>
</ul>
<p>ä½¿ç”¨èº«ä»½è®¤è¯ï¼ˆauthenticationï¼‰å’Œæˆæƒï¼ˆauthorizationï¼‰é”™è¯¯ç æ—¶éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li><code>401 Unauthorized</code>: ç”¨æˆ·æœªè®¤è¯ï¼Œè¯·æ±‚å¤±è´¥</li>
<li><code>403 Forbidden</code>: ç”¨æˆ·æ— æƒé™è®¿é—®è¯¥èµ„æºï¼Œè¯·æ±‚å¤±è´¥</li>
</ul>
<p>å½“ç”¨æˆ·è¯·æ±‚é”™è¯¯æ—¶ï¼Œæä¾›åˆé€‚çš„çŠ¶æ€ç å¯ä»¥æä¾›é¢å¤–çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><code>422 Unprocessable Entity</code>: è¯·æ±‚è¢«æœåŠ¡å™¨æ­£ç¡®è§£æï¼Œä½†æ˜¯åŒ…å«æ— æ•ˆå­—æ®µ</li>
<li><code>429 Too Many Requests</code>: å› ä¸ºè®¿é—®é¢‘ç¹ï¼Œä½ å·²ç»è¢«é™åˆ¶è®¿é—®ï¼Œç¨åé‡è¯•</li>
<li><code>500 Internal Server Error</code>: æœåŠ¡å™¨é”™è¯¯ï¼Œç¡®è®¤çŠ¶æ€å¹¶æŠ¥å‘Šé—®é¢˜</li>
</ul>
<h4 id="u63D0_u4F9B_u5168_u90E8_u53EF_u7528_u7684_u8D44_u6E90"><a href="#u63D0_u4F9B_u5168_u90E8_u53EF_u7528_u7684_u8D44_u6E90" class="headerlink" title="æä¾›å…¨éƒ¨å¯ç”¨çš„èµ„æº"></a>æä¾›å…¨éƒ¨å¯ç”¨çš„èµ„æº</h4><p>æä¾›å…¨éƒ¨å¯æ˜¾ç°çš„èµ„æºè¡¨è¿° (ä¾‹å¦‚ï¼š è¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§) ï¼Œå½“å“åº”ç ä¸º200æˆ–æ˜¯201æ—¶è¿”å›æ‰€æœ‰å¯ç”¨èµ„æºï¼ŒåŒ…å« <code>PUT</code>/<code>PATCH</code> å’Œ <code>DELETE</code><br>è¯·æ±‚ï¼Œä¾‹å¦‚:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X DELETE \  </span><br><span class="line">  https://service.com/apps/1f9b/domains/0fd4</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json;charset=utf-8</span><br><span class="line">...</span><br><span class="line">&#123;</span><br><span class="line">  "created_at": "2012-01-01T12:00:00Z",</span><br><span class="line">  "hostname": "subdomain.example.com",</span><br><span class="line">  "id": "01234567-89ab-cdef-0123-456789abcdef",</span><br><span class="line">  "updated_at": "2012-01-01T12:00:00Z"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“è¯·æ±‚çŠ¶æ€ç ä¸º202æ—¶ï¼Œä¸è¿”å›æ‰€æœ‰å¯ç”¨èµ„æºï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X DELETE \  </span><br><span class="line">  https:<span class="comment">//service.com/apps/1f9b/dynos/05bd</span></span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">202</span> Accepted</span><br><span class="line">Content-Type: application/json;charset=utf-<span class="number">8</span></span><br><span class="line">...</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u63D0_u4F9B_u8D44_u6E90_u7684_28UU_29ID"><a href="#u63D0_u4F9B_u8D44_u6E90_u7684_28UU_29ID" class="headerlink" title="æä¾›èµ„æºçš„(UU)ID"></a>æä¾›èµ„æºçš„(UU)ID</h4><p>åœ¨é»˜è®¤æƒ…å†µç»™æ¯ä¸€ä¸ªèµ„æºä¸€ä¸ª<code>id</code>å±æ€§ã€‚é™¤éæœ‰æ›´å¥½çš„ç†ç”±ï¼Œå¦åˆ™è¯·ä½¿ç”¨UUIDã€‚ä¸è¦ä½¿ç”¨é‚£ç§åœ¨æœåŠ¡å™¨ä¸Šæˆ–æ˜¯èµ„æºä¸­ä¸æ˜¯å…¨å±€å”¯ä¸€çš„æ ‡è¯†ï¼Œå°¤å…¶æ˜¯è‡ªåŠ¨å¢é•¿çš„idã€‚</p>
<p>ç”Ÿæˆå°å†™çš„UUIDæ ¼å¼ <code>8-4-4-4-12</code>ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"id": "01234567-89ab-cdef-0123-456789abcdef"</span><br></pre></td></tr></table></figure>
<h4 id="u63D0_u4F9B_u6807_u51C6_u7684_u65F6_u95F4_u6233"><a href="#u63D0_u4F9B_u6807_u51C6_u7684_u65F6_u95F4_u6233" class="headerlink" title="æä¾›æ ‡å‡†çš„æ—¶é—´æˆ³"></a>æä¾›æ ‡å‡†çš„æ—¶é—´æˆ³</h4><p>ä¸ºèµ„æºæä¾›é»˜è®¤çš„åˆ›å»ºæ—¶é—´ <code>createdAt</code> å’Œæ›´æ–°æ—¶é—´ <code>updatedAt</code>ï¼Œä¾‹å¦‚:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  "createdAt": 1464687808,</span><br><span class="line">  "updatedAt": 1464687808,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰äº›èµ„æºä¸éœ€è¦ä½¿ç”¨æ—¶é—´æˆ³é‚£ä¹ˆå°±å¿½ç•¥è¿™ä¸¤ä¸ªå­—æ®µã€‚</p>
<h4 id="u5D4C_u5957_u5916_u952E_u5173_u7CFB"><a href="#u5D4C_u5957_u5916_u952E_u5173_u7CFB" class="headerlink" title="åµŒå¥—å¤–é”®å…³ç³»"></a>åµŒå¥—å¤–é”®å…³ç³»</h4><p>ä½¿ç”¨åµŒå¥—å¯¹è±¡åºåˆ—åŒ–å¤–é”®å…³è”ï¼Œä¾‹å¦‚:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "name": "service-production",</span><br><span class="line">  "owner": &#123;</span><br><span class="line">    "id": "5d8201b0..."</span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œä¸æ˜¯åƒè¿™æ ·:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "name": "service-production",</span><br><span class="line">  "ownerId": "5d8201b0...",</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼å°½å¯èƒ½çš„æŠŠç›¸å…³è”çš„èµ„æºä¿¡æ¯å†…è”åœ¨ä¸€èµ·ï¼Œè€Œä¸ç”¨æ”¹å˜èµ„æºçš„ç»“æ„ï¼Œæˆ–è€…å¼•å…¥æ›´å¤šçš„é¡¶å±‚å­—æ®µï¼Œä¾‹å¦‚:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "name": "service-production",</span><br><span class="line">  "owner": &#123;</span><br><span class="line">    "id": "5d8201b0...",</span><br><span class="line">    "name": "Alice",</span><br><span class="line">    "email": "alice@heroku.com"</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u751F_u6210_u7ED3_u6784_u5316_u7684_u9519_u8BEF"><a href="#u751F_u6210_u7ED3_u6784_u5316_u7684_u9519_u8BEF" class="headerlink" title="ç”Ÿæˆç»“æ„åŒ–çš„é”™è¯¯"></a>ç”Ÿæˆç»“æ„åŒ–çš„é”™è¯¯</h4><p>å“åº”é”™è¯¯çš„æ—¶ï¼Œç”Ÿæˆç»Ÿä¸€çš„ã€ç»“æ„åŒ–çš„é”™è¯¯ä¿¡æ¯ã€‚åŒ…å«ä¸€ä¸ªæœºå™¨å¯è¯»çš„é”™è¯¯ <code>id</code>ï¼Œä¸€ä¸ªäººç±»å¯è¯»çš„é”™è¯¯ä¿¡æ¯ï¼ˆ<code>message</code>ï¼‰ï¼Œæ ¹æ®æƒ…å†µå¯ä»¥æ·»åŠ ä¸€ä¸ª<code>url</code>æ¥å‘Šè¯‰å®¢æˆ·ç«¯å…³äºè¿™ä¸ªé”™è¯¯çš„æ›´å¤šä¿¡æ¯ä»¥åŠå¦‚ä½•å»è§£å†³å®ƒï¼Œä¾‹å¦‚:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">429</span> Too Many Requests</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">id</span>":      <span class="value"><span class="string">"rate_limit"</span></span>,</span><br><span class="line">  "<span class="attribute">message</span>": <span class="value"><span class="string">"Account reached its API rate limit."</span></span>,</span><br><span class="line">  "<span class="attribute">url</span>":     <span class="value"><span class="string">"https://docs.service.com/rate-limits"</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>æ–‡æ¡£åŒ–é”™è¯¯ä¿¡æ¯æ ¼å¼ï¼Œä»¥åŠå®¢æˆ·ç«¯å¯èƒ½é‡åˆ°çš„é”™è¯¯ä¿¡æ¯<code>id</code>ã€‚</p>
<h4 id="u663E_u793A_u9891_u7387_u9650_u5236_u72B6_u6001"><a href="#u663E_u793A_u9891_u7387_u9650_u5236_u72B6_u6001" class="headerlink" title="æ˜¾ç¤ºé¢‘ç‡é™åˆ¶çŠ¶æ€"></a>æ˜¾ç¤ºé¢‘ç‡é™åˆ¶çŠ¶æ€</h4><p>å®¢æˆ·ç«¯çš„è®¿é—®é€Ÿåº¦é™åˆ¶å¯ä»¥ç»´æŠ¤æœåŠ¡å™¨çš„è‰¯å¥½çŠ¶æ€ï¼Œä¿è¯ä¸ºå…¶ä»–å®¢æˆ·ç«¯è¯·æ±‚æä¾›é«˜æ€§çš„æœåŠ¡ã€‚ä½ å¯ä»¥ä½¿ç”¨<a href="http://en.wikipedia.org/wiki/Token_bucket" target="_blank" rel="external">token bucket algorithm</a>æŠ€æœ¯é‡åŒ–è¯·æ±‚é™åˆ¶ã€‚</p>
<p>ä¸ºæ¯ä¸€ä¸ªå¸¦æœ‰<code>RateLimit-Remaining</code>å“åº”å¤´çš„è¯·æ±‚ï¼Œè¿”å›é¢„ç•™çš„è¯·æ±‚tokensã€‚</p>
<h4 id="u4FDD_u8BC1_u54CD_u5E94JSON_u6700_u5C0F_u5316"><a href="#u4FDD_u8BC1_u54CD_u5E94JSON_u6700_u5C0F_u5316" class="headerlink" title="ä¿è¯å“åº”JSONæœ€å°åŒ–"></a>ä¿è¯å“åº”JSONæœ€å°åŒ–</h4><p>è¯·æ±‚ä¸­å¤šä½™çš„ç©ºæ ¼ä¼šå¢åŠ å“åº”å¤§å°ï¼Œè€Œä¸”ç°åœ¨å¾ˆå¤šçš„HTTPå®¢æˆ·ç«¯éƒ½ä¼šè‡ªå·±è¾“å‡ºå¯è¯»æ ¼å¼ï¼ˆâ€prettifyâ€ï¼‰çš„JSONã€‚æ‰€ä»¥æœ€å¥½ä¿è¯å“åº”JSONæœ€å°åŒ–ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;"<span class="attribute">beta</span>":<span class="value"><span class="literal">false</span></span>,"<span class="attribute">email</span>":<span class="value"><span class="string">"alice@heroku.com"</span></span>,"<span class="attribute">id</span>":<span class="value"><span class="string">"01234567-89ab-cdef-0123-456789abcdef"</span></span>,"<span class="attribute">lastLogin</span>":<span class="value"><span class="string">"2012-01-01T12:00:00Z"</span></span>,"<span class="attribute">createdAt</span>":<span class="value"><span class="string">"2012-01-01T12:00:00Z"</span></span>,"<span class="attribute">updatedAt</span>":<span class="value"><span class="string">"2012-01-01T12:00:00Z"</span></span>&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œä¸æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">beta</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">  "<span class="attribute">email</span>": <span class="value"><span class="string">"alice@heroku.com"</span></span>,</span><br><span class="line">  "<span class="attribute">id</span>": <span class="value"><span class="string">"01234567-89ab-cdef-0123-456789abcdef"</span></span>,</span><br><span class="line">  "<span class="attribute">lastLogin</span>": <span class="value"><span class="string">"2012-01-01T12:00:00Z"</span></span>,</span><br><span class="line">  "<span class="attribute">createdAt</span>": <span class="value"><span class="string">"2012-01-01T12:00:00Z"</span></span>,</span><br><span class="line">  "<span class="attribute">updatedAt</span>": <span class="value"><span class="string">"2012-01-01T12:00:00Z"</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥æä¾›å¯é€‰çš„æ–¹å¼ä¸ºå®¢æˆ·ç«¯æä¾›æ›´è¯¦ç»†å¯è¯»çš„å“åº”ï¼Œä½¿ç”¨æŸ¥è¯¢å‚æ•°ï¼ˆä¾‹å¦‚ï¼š<code>?pretty=true</code>ï¼‰æˆ–è€…é€šè¿‡<code>Accept</code>å¤´ä¿¡æ¯å‚æ•°ï¼ˆä¾‹å¦‚ï¼š<code>Accept: application/vnd.heroku+json; version=3; indent=4;</code>ï¼‰ã€‚</p>
<p>###å·¥ä»¶ï¼ˆArtifactsï¼‰</p>
<h4 id="u63D0_u4F9B_u673A_u5668_u53EF_u8BFB_u7684JSON_u6A21_u5F0F"><a href="#u63D0_u4F9B_u673A_u5668_u53EF_u8BFB_u7684JSON_u6A21_u5F0F" class="headerlink" title="æä¾›æœºå™¨å¯è¯»çš„JSONæ¨¡å¼"></a>æä¾›æœºå™¨å¯è¯»çš„JSONæ¨¡å¼</h4><p>æä¾›ä¸€ä¸ªæœºå™¨å¯è¯»çš„æ¨¡å¼æ¥æ°å½“çš„è¡¨ç°ä½ çš„APIã€‚ä½¿ç”¨<br><a href="https://github.com/interagent/prmd" target="_blank" rel="external">prmd</a>ç®¡ç†ä½ çš„æ¨¡å¼ï¼Œå¹¶ä¸”ç¡®ä¿ç”¨<code>prmd verify</code>éªŒè¯æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<h4 id="u63D0_u4F9B_u4EBA_u7C7B_u53EF_u8BFB_u7684_u6587_u6863"><a href="#u63D0_u4F9B_u4EBA_u7C7B_u53EF_u8BFB_u7684_u6587_u6863" class="headerlink" title="æä¾›äººç±»å¯è¯»çš„æ–‡æ¡£"></a>æä¾›äººç±»å¯è¯»çš„æ–‡æ¡£</h4><p>æä¾›äººç±»å¯è¯»çš„æ–‡æ¡£è®©å®¢æˆ·ç«¯å¼€å‘äººå‘˜å¯ä»¥ç†è§£ä½ çš„APIã€‚</p>
<p>å¦‚æœä½ ç”¨prmdåˆ›å»ºäº†ä¸€ä¸ªæ¦‚è¦å¹¶ä¸”æŒ‰ä¸Šè¿°è¦æ±‚æè¿°ï¼Œä½ å¯ä»¥ä¸ºæ‰€æœ‰èŠ‚ç‚¹å¾ˆå®¹æ˜“çš„ä½¿ç”¨<code>prmd doc</code>ç”ŸæˆMarkdownæ–‡æ¡£ã€‚</p>
<p>é™¤äº†èŠ‚ç‚¹ä¿¡æ¯ï¼Œæä¾›ä¸€ä¸ªAPIæ¦‚è¿°ä¿¡æ¯:</p>
<ul>
<li>éªŒè¯æˆæƒï¼ŒåŒ…å«å¦‚ä½•å–å¾—å’Œå¦‚ä½•ä½¿ç”¨tokenã€‚</li>
<li>APIç¨³å®šåŠç‰ˆæœ¬ç®¡ç†ï¼ŒåŒ…å«å¦‚ä½•é€‰æ‹©æ‰€éœ€è¦çš„ç‰ˆæœ¬ã€‚</li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹çš„è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ã€‚</li>
<li>é”™è¯¯çš„åºåˆ—åŒ–æ ¼å¼ã€‚</li>
<li>ä¸åŒç¼–ç¨‹è¯­è¨€å®¢æˆ·ç«¯ä½¿ç”¨APIçš„ä¾‹å­ã€‚</li>
</ul>
<h4 id="u63D0_u4F9B_u53EF_u6267_u884C_u7684_u4F8B_u5B50"><a href="#u63D0_u4F9B_u53EF_u6267_u884C_u7684_u4F8B_u5B50" class="headerlink" title="æä¾›å¯æ‰§è¡Œçš„ä¾‹å­"></a>æä¾›å¯æ‰§è¡Œçš„ä¾‹å­</h4><p>æä¾›å¯æ‰§è¡Œçš„ç¤ºä¾‹è®©ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯é‡Œé¢çœ‹åˆ°APIçš„è°ƒç”¨æƒ…å†µï¼Œæœ€å¤§ç¨‹åº¦çš„è®©è¿™äº›ç¤ºä¾‹å¯ä»¥ç®€å•çš„ä½¿ç”¨ï¼Œä»¥å‡å°‘ç”¨æˆ·å°è¯•ä½¿ç”¨APIçš„å·¥ä½œé‡ã€‚ä¾‹å¦‚:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>export <span class="constant">TOKEN</span>=... <span class="comment"># acquire from dashboard</span></span><br><span class="line"><span class="variable">$ </span>curl -is <span class="symbol">https:</span>/<span class="regexp">/$TOKEN@service.com/users</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä½¿ç”¨<a href="https://github.com/interagent/prmd" target="_blank" rel="external">prmd</a>ç”ŸæˆMarkdownæ–‡æ¡£ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè‡ªåŠ¨è·å–ä¸€äº›ç¤ºä¾‹ã€‚</p>
<h4 id="u63CF_u8FF0_u7A33_u5B9A_u6027"><a href="#u63CF_u8FF0_u7A33_u5B9A_u6027" class="headerlink" title="æè¿°ç¨³å®šæ€§"></a>æè¿°ç¨³å®šæ€§</h4><p>æè¿°æ‚¨çš„APIçš„ç¨³å®šæ€§æˆ–æ˜¯å®ƒåœ¨å„ç§å„æ ·èŠ‚ç‚¹ç¯å¢ƒä¸­çš„å®Œå¤‡æ€§å’Œç¨³å®šæ€§ï¼Œä¾‹å¦‚ï¼šåŠ ä¸Š åŸå‹ç‰ˆï¼ˆprototypeï¼‰/å¼€å‘ç‰ˆï¼ˆdevelopmentï¼‰/äº§å“ç‰ˆï¼ˆproductionï¼‰ç­‰æ ‡è®°ã€‚</p>
<p>æ›´å¤šå…³äºå¯èƒ½çš„ç¨³å®šæ€§å’Œæ”¹å˜ç®¡ç†çš„æ–¹å¼ï¼ŒæŸ¥çœ‹ <a href="https://devcenter.heroku.com/articles/api-compatibility-policy" target="_blank" rel="external">Heroku API compatibility policy</a></p>
<p>ä¸€æ—¦ä½ çš„APIå®£å¸ƒäº§å“æ­£å¼ç‰ˆæœ¬åŠç¨³å®šç‰ˆæœ¬æ—¶ï¼Œä¸è¦åœ¨å½“å‰APIç‰ˆæœ¬ä¸­åšä¸€äº›ä¸å…¼å®¹çš„æ”¹å˜ã€‚å¦‚æœä½ éœ€è¦ï¼Œè¯·åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰ˆæœ¬çš„APIã€‚</p>
<h1 id="u5B8C_u6574_u7684URL"><a href="#u5B8C_u6574_u7684URL" class="headerlink" title="å®Œæ•´çš„URL"></a>å®Œæ•´çš„URL</h1><p>APIé‡Œé¢çš„æ•°æ®ä¹Ÿä¼šæœ‰URLç±»å‹çš„ï¼Œä¸€èˆ¬æ¥è¯´å¦‚ç”¨æˆ·çš„å¤´åƒã€å„ç§å›¾ç‰‡ã€éŸ³é¢‘ç­‰èµ„æºï¼Œéƒ½æ˜¯ä»¥URLé“¾æ¥çš„å½¢å¼è¿”å›çš„ã€‚</p>
<p>è¿”å›çš„URLä¸€å®šè¦â€œå®Œæ•´â€ï¼Œä¸»è¦æŒ‡çš„æ˜¯ä¸è¦å¿˜è®°URLé‡Œé¢çš„åè®®éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯<code>scheme</code>éƒ¨åˆ†ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Why_REST_3F&quot;&gt;&lt;a href=&quot;#Why_REST_3F&quot; class=&quot;headerlink&quot; title=&quot;Why REST?&quot;&gt;&lt;/a&gt;Why REST?&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;Scalability&lt;/li&gt;
&lt;li&gt;Generality&lt;/li&gt;
&lt;li&gt;Independence&lt;/li&gt;
&lt;li&gt;Latency (Caching)&lt;/li&gt;
&lt;li&gt;Security&lt;/li&gt;
&lt;li&gt;Encapsulation&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;Why_JSON_3F&quot;&gt;&lt;a href=&quot;#Why_JSON_3F&quot; class=&quot;headerlink&quot; title=&quot;Why JSON?&quot;&gt;&lt;/a&gt;Why JSON?&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;Ubiquity&lt;/li&gt;
&lt;li&gt;Simplicity&lt;/li&gt;
&lt;li&gt;Readability&lt;/li&gt;
&lt;li&gt;Scalability&lt;/li&gt;
&lt;li&gt;Flexibility&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="REST" scheme="http://yoursite.com/tags/REST/"/>
    
  </entry>
  
  <entry>
    <title>RESTAPI-Reference</title>
    <link href="http://yoursite.com/2016/02/03/RESTAPI-Reference/"/>
    <id>http://yoursite.com/2016/02/03/RESTAPI-Reference/</id>
    <published>2016-02-03T04:00:41.000Z</published>
    <updated>2016-02-03T04:50:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç ”ç©¶RESTAPIç›¸å…³çš„ä¸€äº›æœ€ä½³å®è·µ,æœé›†åˆ°ä¸€äº›ä¸é”™çš„å‚è€ƒèµ„æ–™,å¤‡ä»½ä¸€ä¸‹ã€‚</p>
<ol>
<li>Wiki: Representational state transfer <a href="https://en.wikipedia.org/wiki/Representational_state_transfer#RESTful_web_services" target="_blank" rel="external">https://en.wikipedia.org/wiki/Representational_state_transfer#RESTful_web_services</a></li>
<li>æ¥è‡ªHeroKuçš„HTTP API è®¾è®¡æŒ‡å—(ä¸­æ–‡ç‰ˆ) <a href="http://www.kancloud.cn/thinkphp/http-api-design/31119" target="_blank" rel="external">http://www.kancloud.cn/thinkphp/http-api-design/31119</a></li>
<li>ç†è§£RESTFulæ¶æ„ <a href="http://mccxj.github.io/blog/20130530_introduce-to-rest.html" target="_blank" rel="external">http://mccxj.github.io/blog/20130530_introduce-to-rest.html</a></li>
<li>Github API Reference <a href="https://developer.github.com/v3/" target="_blank" rel="external">https://developer.github.com/v3/</a></li>
<li>Restful Web API ç³»åˆ—ç¯‡ <a href="http://www.cnblogs.com/artech/p/restful-web-api-02.html" target="_blank" rel="external">http://www.cnblogs.com/artech/p/restful-web-api-02.html</a></li>
<li>ç†è§£æœ¬çœŸçš„RESTæ¶æ„é£æ ¼-æ¥è‡ªInfoQ <a href="http://www.infoq.com/cn/articles/understanding-restful-style/" target="_blank" rel="external">http://www.infoq.com/cn/articles/understanding-restful-style/</a></li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨ç ”ç©¶RESTAPIç›¸å…³çš„ä¸€äº›æœ€ä½³å®è·µ,æœé›†åˆ°ä¸€äº›ä¸é”™çš„å‚è€ƒèµ„æ–™,å¤‡ä»½ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Wiki: Representational state transfer &lt;a href=&quot;https://en.wikipedia.org/wiki/Repres
    
    </summary>
    
    
      <category term="REST" scheme="http://yoursite.com/tags/REST/"/>
    
  </entry>
  
  <entry>
    <title>GitæŸ¥çœ‹ã€åˆ é™¤ã€é‡å‘½åè¿œç¨‹åˆ†æ”¯å’Œtag</title>
    <link href="http://yoursite.com/2016/02/02/Git%E6%9F%A5%E7%9C%8B%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E9%87%8D%E5%91%BD%E5%90%8D%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF%E5%92%8Ctag/"/>
    <id>http://yoursite.com/2016/02/02/GitæŸ¥çœ‹ã€åˆ é™¤ã€é‡å‘½åè¿œç¨‹åˆ†æ”¯å’Œtag/</id>
    <published>2016-02-02T03:49:33.000Z</published>
    <updated>2016-11-24T10:19:30.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Outline"><a href="#Outline" class="headerlink" title="Outline"></a>Outline</h1><ol>
<li>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</li>
<li>åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag</li>
<li>åˆ é™¤ä¸å­˜åœ¨å¯¹åº”è¿œç¨‹åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯</li>
<li>é‡å‘½åè¿œç¨‹åˆ†æ”¯</li>
<li>æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹</li>
<li>è·å–è¿œç¨‹tag</li>
</ol>
<a id="more"></a>
<h2 id="u67E5_u770B_u8FDC_u7A0B_u5206_u652F"><a href="#u67E5_u770B_u8FDC_u7A0B_u5206_u652F" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯"></a>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</h2><p>åŠ ä¸Š-aå‚æ•°å¯ä»¥æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼Œè¿œç¨‹åˆ†æ”¯ä¼šç”¨çº¢è‰²è¡¨ç¤ºå‡ºæ¥ï¼ˆå¦‚æœä½ å¼€äº†é¢œè‰²æ”¯æŒçš„è¯ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git branch <span class="operator">-a</span></span><br><span class="line">  master</span><br><span class="line">  remote</span><br><span class="line">  tungway</span><br><span class="line">  v1.<span class="number">52</span></span><br><span class="line">* zrong</span><br><span class="line">  remotes/origin/master</span><br><span class="line">  remotes/origin/tungway</span><br><span class="line">  remotes/origin/v1.<span class="number">52</span></span><br><span class="line">  remotes/origin/zrong</span><br></pre></td></tr></table></figure>
<h2 id="u5220_u9664_u8FDC_u7A0B_u5206_u652F_u548Ctag"><a href="#u5220_u9664_u8FDC_u7A0B_u5206_u652F_u548Ctag" class="headerlink" title="åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag"></a>åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag</h2><p>åœ¨Git v1.7.0 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --delete &lt;branchName&gt;</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤tagè¿™ä¹ˆç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --delete tag &lt;tagname&gt;</span><br></pre></td></tr></table></figure>
<!--more-->
<p>å¦åˆ™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºåˆ†æ”¯åˆ°è¿œç¨‹åˆ†æ”¯ï¼Œå…¶å®å°±ç›¸å½“äºåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :&lt;branchName&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯åˆ é™¤tagçš„æ–¹æ³•ï¼Œæ¨é€ä¸€ä¸ªç©ºtagåˆ°è¿œç¨‹tagï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag <span class="operator">-d</span> &lt;tagname&gt;</span><br><span class="line">git push origin :refs/tags/&lt;tagname&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸¤ç§è¯­æ³•ä½œç”¨å®Œå…¨ç›¸åŒã€‚</p>
<h2 id="u5220_u9664_u4E0D_u5B58_u5728_u5BF9_u5E94_u8FDC_u7A0B_u5206_u652F_u7684_u672C_u5730_u5206_u652F"><a href="#u5220_u9664_u4E0D_u5B58_u5728_u5BF9_u5E94_u8FDC_u7A0B_u5206_u652F_u7684_u672C_u5730_u5206_u652F" class="headerlink" title="åˆ é™¤ä¸å­˜åœ¨å¯¹åº”è¿œç¨‹åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯"></a>åˆ é™¤ä¸å­˜åœ¨å¯¹åº”è¿œç¨‹åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯</h2><p>å‡è®¾è¿™æ ·ä¸€ç§æƒ…å†µï¼š</p>
<ol>
<li>æˆ‘åˆ›å»ºäº†æœ¬åœ°åˆ†æ”¯b1å¹¶pullåˆ°è¿œç¨‹åˆ†æ”¯ <code>origin/b1</code>ï¼›</li>
<li>å…¶ä»–äººåœ¨æœ¬åœ°ä½¿ç”¨fetchæˆ–pullåˆ›å»ºäº†æœ¬åœ°çš„b1åˆ†æ”¯ï¼›</li>
<li>æˆ‘åˆ é™¤äº† <code>origin/b1</code> è¿œç¨‹åˆ†æ”¯ï¼›</li>
<li>å…¶ä»–äººå†æ¬¡æ‰§è¡Œfetchæˆ–è€…pullå¹¶ä¸ä¼šåˆ é™¤è¿™ä¸ªä»–ä»¬æœ¬åœ°çš„ <code>b1</code> åˆ†æ”¯ï¼Œè¿è¡Œ <code>git branch -a</code> ä¹Ÿä¸èƒ½çœ‹å‡ºè¿™ä¸ªbranchè¢«åˆ é™¤äº†ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ</li>
</ol>
<p>ä½¿ç”¨ä¸‹é¢çš„ä»£ç æŸ¥çœ‹b1çš„çŠ¶æ€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git remote show origin</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: git@github.com:xxx/xxx.git</span><br><span class="line">  Push  URL: git@github.com:xxx/xxx.git</span><br><span class="line">  HEAD branch: master</span><br><span class="line">  Remote branches:</span><br><span class="line">    master                 tracked</span><br><span class="line">    refs/remotes/origin/b1 stale (use <span class="string">'git remote prune'</span> to remove)</span><br><span class="line">  Local branch configured <span class="keyword">for</span> <span class="string">'git pull'</span>:</span><br><span class="line">    master merges with remote master</span><br><span class="line">  Local ref configured <span class="keyword">for</span> <span class="string">'git push'</span>:</span><br><span class="line">    master pushes to master (up to date)</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™èƒ½å¤Ÿçœ‹åˆ°b1æ˜¯staleçš„ï¼Œä½¿ç”¨ <code>git remote prune origin</code> å¯ä»¥å°†å…¶ä»æœ¬åœ°ç‰ˆæœ¬åº“ä¸­å»é™¤ã€‚</p>
<p>æ›´ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œå®ƒåœ¨fetchä¹‹ååˆ é™¤æ‰æ²¡æœ‰ä¸è¿œç¨‹åˆ†æ”¯å¯¹åº”çš„æœ¬åœ°åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch -p</span><br></pre></td></tr></table></figure>
<h2 id="u91CD_u547D_u540D_u8FDC_u7A0B_u5206_u652F"><a href="#u91CD_u547D_u540D_u8FDC_u7A0B_u5206_u652F" class="headerlink" title="é‡å‘½åè¿œç¨‹åˆ†æ”¯"></a>é‡å‘½åè¿œç¨‹åˆ†æ”¯</h2><p>åœ¨gitä¸­é‡å‘½åè¿œç¨‹åˆ†æ”¯ï¼Œå…¶å®å°±æ˜¯å…ˆåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼Œç„¶åé‡å‘½åæœ¬åœ°åˆ†æ”¯ï¼Œå†é‡æ–°æäº¤ä¸€ä¸ªè¿œç¨‹åˆ†æ”¯ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘éœ€è¦æŠŠ devel åˆ†æ”¯é‡å‘½åä¸º develop åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -av</span><br><span class="line">* devel                             <span class="number">752</span>bb84 Merge pull request <span class="comment">#158 from Gwill/devel</span></span><br><span class="line">  master                            <span class="number">53</span>b27b8 Merge pull request <span class="comment">#138 from tdlrobin/master</span></span><br><span class="line">  zrong                             <span class="number">2</span>ae98d8 modify CCFileUtils, <span class="built_in">export</span> getFileData</span><br><span class="line">  remotes/origin/HEAD               -&gt; origin/master</span><br><span class="line">  remotes/origin/add_build_script   d4a8c4f Merge branch <span class="string">'master'</span> into add_build_script</span><br><span class="line">  remotes/origin/devel              <span class="number">752</span>bb84 Merge pull request <span class="comment">#158 from Gwill/devel</span></span><br><span class="line">  remotes/origin/devel_qt51         <span class="number">62208</span>f1 update .gitignore</span><br><span class="line">  remotes/origin/master             <span class="number">53</span>b27b8 Merge pull request <span class="comment">#138 from tdlrobin/master</span></span><br><span class="line">  remotes/origin/zrong              <span class="number">2</span>ae98d8 modify CCFileUtils, <span class="built_in">export</span> getFileData</span><br></pre></td></tr></table></figure>
<p>åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git push --delete origin devel</span><br><span class="line">To git@github.com:zrong/quick-cocos2d-x.git</span><br><span class="line"> - [deleted]         devel</span><br></pre></td></tr></table></figure>
<p>é‡å‘½åæœ¬åœ°åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m devel develop</span><br></pre></td></tr></table></figure>
<p>æ¨é€æœ¬åœ°åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin develop</span><br><span class="line">Counting objects: <span class="number">92</span>, done.</span><br><span class="line">Delta compression using up to <span class="number">4</span> threads.</span><br><span class="line">Compressing objects: <span class="number">100</span>% (<span class="number">48</span>/<span class="number">48</span>), done.</span><br><span class="line">Writing objects: <span class="number">100</span>% (<span class="number">58</span>/<span class="number">58</span>), <span class="number">1.38</span> MiB, done.</span><br><span class="line">Total <span class="number">58</span> (delta <span class="number">34</span>), reused <span class="number">12</span> (delta <span class="number">5</span>)</span><br><span class="line">To git@github.com:zrong/quick-cocos2d-x.git</span><br><span class="line"> * [new branch]      develop -&gt; develop</span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œï¼Œåœ¨ github ä¸Šæ“ä½œçš„æ—¶å€™ï¼Œæˆ‘åœ¨åˆ é™¤è¿œç¨‹åˆ†æ”¯æ—¶ç¢°åˆ°è¿™ä¸ªé”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git push --delete origin devel</span><br><span class="line">remote: error: refusing to delete the current branch: refs/heads/devel</span><br><span class="line">To git@github.com:zrong/quick-cocos2d-x.git</span><br><span class="line"> ! [remote rejected] devel (deletion of the current branch prohibited)</span><br><span class="line">error: failed to push some refs to <span class="string">'git@github.com:zrong/quick-cocos2d-x.git'</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ç”±äºåœ¨ github ä¸­ï¼Œdevel æ˜¯é¡¹ç›®çš„é»˜è®¤åˆ†æ”¯ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¿™æ ·æ“ä½œï¼š</p>
<ol>
<li>è¿›å…¥ github ä¸­è¯¥é¡¹ç›®çš„ Settings é¡µé¢ï¼›</li>
<li>è®¾ç½® Default Branch ä¸ºå…¶ä»–çš„åˆ†æ”¯ï¼ˆä¾‹å¦‚ masterï¼‰ï¼›</li>
<li>é‡æ–°æ‰§è¡Œåˆ é™¤è¿œç¨‹åˆ†æ”¯å‘½ä»¤ã€‚</li>
</ol>
<h2 id="u628A_u672C_u5730tag_u63A8_u9001_u5230_u8FDC_u7A0B"><a href="#u628A_u672C_u5730tag_u63A8_u9001_u5230_u8FDC_u7A0B" class="headerlink" title="æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹"></a>æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --tags</span><br></pre></td></tr></table></figure>
<h2 id="u83B7_u53D6_u8FDC_u7A0Btag"><a href="#u83B7_u53D6_u8FDC_u7A0Btag" class="headerlink" title="è·å–è¿œç¨‹tag"></a>è·å–è¿œç¨‹tag</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin tag &lt;tagname&gt;</span><br></pre></td></tr></table></figure>
<h2 id="u53C2_u8003_u6587_u7AE0"><a href="#u53C2_u8003_u6587_u7AE0" class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul>
<li><a href="https://makandracards.com/makandra/621-git-delete-a-branch-local-or-remote" target="_blank" rel="external">https://makandracards.com/makandra/621-git-delete-a-branch-local-or-remote</a></li>
<li><a href="http://stackoverflow.com/questions/2003505/how-do-i-delete-a-git-branch-both-locally-and-in-github" target="_blank" rel="external">http://stackoverflow.com/questions/2003505/how-do-i-delete-a-git-branch-both-locally-and-in-github</a></li>
<li><a href="http://www.cnblogs.com/deepnighttwo/archive/2011/06/18/2084438.html" target="_blank" rel="external">http://www.cnblogs.com/deepnighttwo/archive/2011/06/18/2084438.html</a></li>
<li><a href="http://stackoverflow.com/questions/14040754/deleting-remote-master-branch-refused-due-to-being-current-branch" target="_blank" rel="external">http://stackoverflow.com/questions/14040754/deleting-remote-master-branch-refused-due-to-being-current-branch</a></li>
<li><a href="http://weli.iteye.com/blog/1441582" target="_blank" rel="external">http://weli.iteye.com/blog/1441582</a></li>
<li><a href="http://zengrong.net/post/1746.htm" target="_blank" rel="external">http://zengrong.net/post/1746.htm</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Outline&quot;&gt;&lt;a href=&quot;#Outline&quot; class=&quot;headerlink&quot; title=&quot;Outline&quot;&gt;&lt;/a&gt;Outline&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;åˆ é™¤è¿œç¨‹åˆ†æ”¯å’Œtag&lt;/li&gt;
&lt;li&gt;åˆ é™¤ä¸å­˜åœ¨å¯¹åº”è¿œç¨‹åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;é‡å‘½åè¿œç¨‹åˆ†æ”¯&lt;/li&gt;
&lt;li&gt;æŠŠæœ¬åœ°tagæ¨é€åˆ°è¿œç¨‹&lt;/li&gt;
&lt;li&gt;è·å–è¿œç¨‹tag&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="git" scheme="http://yoursite.com/categories/git/"/>
    
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
  </entry>
  
</feed>
